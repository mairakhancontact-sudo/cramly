<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Grindly | Student Mode</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<!-- Chart.js for Statistics -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
/* ===== CSS VARIABLES ===== */
:root {
  /* Light theme (default) */
  --bg: #f8fafc;
  --card: #ffffff;
  --text: #1e293b;
  --text-muted: #64748b;
  --border: #e2e8f0;
  --accent: #4f46e5;
  --accent-dark: #4338ca;
  --accent-light: #e0e7ff;
  --success: #10b981;
  --warning: #f59e0b;
  --danger: #ef4444;
  --info: #3b82f6;
  --purple: #8b5cf6;
  
  /* Spacing */
  --spacing-xs: 0.5rem;
  --spacing-sm: 0.75rem;
  --spacing-md: 1rem;
  --spacing-lg: 1.5rem;
  --spacing-xl: 2rem;
  --spacing-2xl: 3rem;
  
  /* Border Radius */
  --radius-sm: 0.5rem;
  --radius: 0.75rem;
  --radius-lg: 1rem;
  --radius-xl: 1.25rem;
  --radius-2xl: 1.5rem;
  
  /* Shadows */
  --shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
  --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.12);
  --shadow-lg: 0 10px 30px rgba(0, 0, 0, 0.15);
  --shadow-xl: 0 20px 40px rgba(0, 0, 0, 0.2);
  
  /* Transitions */
  --transition-fast: 0.2s ease;
  --transition: 0.3s ease;
  --transition-slow: 0.5s ease;
  
  /* Gradients */
  --gradient-primary: linear-gradient(135deg, var(--accent), var(--accent-dark));
  --gradient-success: linear-gradient(135deg, var(--success), #059669);
  --gradient-warning: linear-gradient(135deg, var(--warning), #d97706);
  --gradient-danger: linear-gradient(135deg, var(--danger), #dc2626);
  --gradient-info: linear-gradient(135deg, var(--info), #2563eb);
  --gradient-purple: linear-gradient(135deg, var(--purple), #7c3aed);
}

/* ===== THEMES ===== */
body.dark {
  --bg: #0f172a;
  --card: #1e293b;
  --text: #f1f5f9;
  --text-muted: #94a3b8;
  --border: #334155;
  --accent-light: rgba(79, 70, 229, 0.2);
  --shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
  --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.4);
  --shadow-lg: 0 10px 30px rgba(0, 0, 0, 0.5);
}

body.ocean {
  --bg: #0c4a6e;
  --card: #075985;
  --text: #e0f2fe;
  --text-muted: #7dd3fc;
  --border: #0369a1;
  --accent: #0891b2;
  --accent-dark: #0e7490;
  --accent-light: rgba(8, 145, 178, 0.2);
}

body.forest {
  --bg: #064e3b;
  --card: #047857;
  --text: #d1fae5;
  --text-muted: #a7f3d0;
  --border: #059669;
  --accent: #059669;
  --accent-dark: #047857;
  --accent-light: rgba(5, 150, 105, 0.2);
}

body.sunset {
  --bg: #7c2d12;
  --card: #c2410c;
  --text: #ffedd5;
  --text-muted: #fed7aa;
  --border: #ea580c;
  --accent: #ea580c;
  --accent-dark: #c2410c;
  --accent-light: rgba(234, 88, 12, 0.2);
}

body.purple {
  --bg: #1e1b4b;
  --card: #312e81;
  --text: #e0e7ff;
  --text-muted: #a5b4fc;
  --border: #4f46e5;
  --accent: #8b5cf6;
  --accent-dark: #7c3aed;
  --accent-light: rgba(139, 92, 246, 0.2);
}

/* ===== BASE STYLES ===== */
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  background: var(--bg);
  color: var(--text);
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Inter', sans-serif;
  line-height: 1.6;
  min-height: 100vh;
  transition: all var(--transition);
  overflow-x: hidden;
}

/* ===== NEW RESPONSIVE LAYOUT STRUCTURE ===== */
.app-layout {
  display: grid;
  grid-template-columns: 280px 1fr;
  min-height: 100vh;
}

/* ===== SIDEBAR ===== */
.sidebar {
  background: var(--card);
  border-right: 1px solid var(--border);
  padding: var(--spacing-xl);
  position: sticky;
  top: 0;
  height: 100vh;
  overflow-y: auto;
  z-index: 100;
}

.sidebar-header {
  text-align: center;
  margin-bottom: var(--spacing-2xl);
  padding-bottom: var(--spacing-xl);
  border-bottom: 1px solid var(--border);
}

.student-emoji {
  font-size: 3.5rem;
  margin-bottom: var(--spacing-md);
  display: block;
  animation: float 3s ease-in-out infinite;
}

@keyframes float {
  0%, 100% { transform: translateY(0) rotate(0deg); }
  50% { transform: translateY(-10px) rotate(2deg); }
}

.sidebar h2 {
  font-size: 1.5rem;
  font-weight: 700;
  color: var(--text);
  margin-bottom: var(--spacing-xs);
}

.sidebar-subtitle {
  color: var(--text-muted);
  font-size: 0.875rem;
  margin-bottom: var(--spacing-lg);
}

/* Class switcher */
.class-switcher {
  background: var(--bg);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: var(--spacing-md);
  margin-bottom: var(--spacing-xl);
}

.class-switcher select {
  width: 100%;
  padding: 0.5rem;
  border: 1px solid var(--border);
  border-radius: var(--radius-sm);
  background: var(--card);
  color: var(--text);
  font-size: 0.875rem;
}

.sidebar-nav {
  display: flex;
  flex-direction: column;
  gap: var(--spacing-xs);
  margin-bottom: var(--spacing-xl);
}

.nav-item {
  display: flex;
  align-items: center;
  gap: var(--spacing-sm);
  padding: var(--spacing-md) var(--spacing-lg);
  border-radius: var(--radius);
  color: var(--text);
  text-decoration: none;
  font-weight: 500;
  transition: all var(--transition);
  border: 1px solid transparent;
  cursor: pointer;
}

.nav-item:hover {
  background: var(--accent-light);
  border-color: var(--accent);
  transform: translateX(5px);
}

.nav-item.active {
  background: var(--gradient-primary);
  color: white;
}

.nav-item.active:hover {
  background: var(--gradient-primary);
  border-color: transparent;
}

.sidebar-stats {
  background: var(--bg);
  border: 1px solid var(--border);
  border-radius: var(--radius-lg);
  padding: var(--spacing-lg);
  margin-bottom: var(--spacing-xl);
}

.sidebar-stats h3 {
  font-size: 0.875rem;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  color: var(--text-muted);
  margin-bottom: var(--spacing-md);
}

.stat-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: var(--spacing-sm) 0;
  border-bottom: 1px solid var(--border);
}

.stat-row:last-child {
  border-bottom: none;
}

.stat-value {
  font-weight: 700;
  font-size: 1.125rem;
  color: var(--accent);
}

/* Inspiring Stories Section */
.stories-section {
  background: var(--bg);
  border: 1px solid var(--border);
  border-radius: var(--radius-lg);
  padding: var(--spacing-lg);
  margin-top: var(--spacing-xl);
  max-height: 300px;
  overflow-y: auto;
}

.stories-section h3 {
  font-size: 0.875rem;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  color: var(--text-muted);
  margin-bottom: var(--spacing-md);
  display: flex;
  align-items: center;
  gap: var(--spacing-xs);
}

.story-item {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: var(--spacing-md);
  margin-bottom: var(--spacing-sm);
  cursor: pointer;
  transition: all var(--transition);
}

.story-item:hover {
  background: var(--accent-light);
  border-color: var(--accent);
  transform: translateY(-2px);
}

.story-name {
  font-weight: 600;
  color: var(--text);
  margin-bottom: var(--spacing-xs);
  display: flex;
  align-items: center;
  gap: var(--spacing-xs);
}

.story-quote {
  font-size: 0.875rem;
  color: var(--text-muted);
  font-style: italic;
  line-height: 1.4;
}

/* Story Modal */
.story-modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.7);
  z-index: 1001;
  align-items: center;
  justify-content: center;
  padding: var(--spacing-xl);
}

.story-modal-content {
  background: var(--card);
  border-radius: var(--radius-lg);
  max-width: 600px;
  width: 100%;
  max-height: 80vh;
  overflow-y: auto;
  position: relative;
  border: 2px solid var(--accent);
}

.story-modal-header {
  padding: var(--spacing-xl);
  border-bottom: 1px solid var(--border);
  background: var(--gradient-primary);
  color: white;
  border-radius: var(--radius-lg) var(--radius-lg) 0 0;
}

.story-modal-body {
  padding: var(--spacing-xl);
}

.story-modal-close {
  position: absolute;
  top: var(--spacing-lg);
  right: var(--spacing-lg);
  background: rgba(255, 255, 255, 0.2);
  border: none;
  color: white;
  width: 36px;
  height: 36px;
  border-radius: 50%;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.25rem;
  z-index: 1002;
}

.story-modal-close:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* ===== MAIN CONTENT ===== */
.main-content {
  padding: var(--spacing-xl);
  overflow-y: auto;
  max-width: 1400px;
  margin: 0 auto;
  width: 100%;
}

/* ===== DASHBOARD HEADER ===== */
.dashboard-header {
  margin-bottom: var(--spacing-2xl);
}

.dashboard-header h1 {
  font-size: 2.5rem;
  font-weight: 800;
  margin-bottom: var(--spacing-sm);
  background: var(--gradient-primary);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.dashboard-subtitle {
  color: var(--text-muted);
  font-size: 1.125rem;
  margin-bottom: var(--spacing-xl);
}

/* UPDATED: Controls Bar - Compact and Inline */
.controls-bar {
  display: flex;
  gap: var(--spacing-sm);
  align-items: center;
  flex-wrap: nowrap;
  padding: var(--spacing-sm) var(--spacing-md);
  background: var(--card);
  border-radius: var(--radius);
  border: 1px solid var(--border);
  margin-bottom: var(--spacing-xl);
  overflow-x: auto;
  min-width: 0;
}

.controls-bar .btn {
  flex-shrink: 0;
  white-space: nowrap;
  min-width: fit-content;
  padding: 0.5rem 0.75rem;
  font-size: 0.875rem;
}

/* ===== TOP NAVIGATION FOR MOBILE ===== */
.top-nav {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  background: var(--card);
  border-bottom: 1px solid var(--border);
  z-index: 1000;
  padding: var(--spacing-sm) var(--spacing-lg);
  box-shadow: var(--shadow);
}

.top-nav-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  width: 100%;
}

.mobile-menu-toggle {
  display: none;
  background: var(--gradient-primary);
  color: white;
  border: none;
  border-radius: var(--radius);
  width: 44px;
  height: 44px;
  align-items: center;
  justify-content: center;
  font-size: 1.25rem;
  cursor: pointer;
  flex-shrink: 0;
}

.mobile-overlay {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.5);
  z-index: 99;
}

/* ===== PRO TIPS - MATCHING TEACHER MODE ===== */
.pro-tip {
  background: var(--accent-light);
  border-left: 4px solid var(--accent);
  padding: var(--spacing-md);
  border-radius: var(--radius);
  margin: var(--spacing-md) 0;
  font-size: 0.875rem;
  position: relative;
}

.pro-tip strong {
  color: var(--accent);
  display: block;
  margin-bottom: var(--spacing-xs);
  font-size: 0.9375rem;
}

.pro-tip::before {
  content: 'ðŸ’¡';
  position: absolute;
  left: -12px;
  top: 50%;
  transform: translateY(-50%);
  background: var(--accent);
  color: white;
  width: 24px;
  height: 24px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 0.75rem;
  box-shadow: var(--shadow);
}

.dark .pro-tip {
  background: rgba(79, 70, 229, 0.15);
  border-left-color: var(--accent);
}

.dark .pro-tip strong {
  color: var(--accent-light);
}

/* ===== DASHBOARD GRID ===== */
.dashboard-grid {
  display: grid;
  grid-template-columns: repeat(12, 1fr);
  gap: var(--spacing-xl);
}

/* UPDATED: Quick Stats - Smaller and Inline */
.quick-stats {
  grid-column: span 12;
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: var(--spacing-md);
}

.stat-card {
  background: var(--card);
  border-radius: var(--radius);
  padding: var(--spacing-md);
  border: 1px solid var(--border);
  transition: all var(--transition);
  display: flex;
  align-items: center;
  gap: var(--spacing-sm);
  max-width: 100%;
  overflow: hidden;
  height: auto;
  min-height: 80px;
}

.stat-card:hover {
  transform: translateY(-3px);
  box-shadow: var(--shadow);
}

.stat-icon {
  width: 40px;
  height: 40px;
  border-radius: var(--radius-sm);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.25rem;
  background: var(--gradient-primary);
  color: white;
  flex-shrink: 0;
}

.stat-card:nth-child(2) .stat-icon {
  background: var(--gradient-success);
}

.stat-card:nth-child(3) .stat-icon {
  background: var(--gradient-warning);
}

.stat-card:nth-child(4) .stat-icon {
  background: var(--gradient-info);
}

.stat-content {
  flex: 1;
  min-width: 0;
}

.stat-number {
  font-size: 1.5rem;
  font-weight: 800;
  line-height: 1;
  margin-bottom: var(--spacing-xs);
  color: var(--text);
  overflow: hidden;
  text-overflow: ellipsis;
}

.stat-label {
  font-size: 0.75rem;
  color: var(--text-muted);
  text-transform: uppercase;
  letter-spacing: 0.5px;
  font-weight: 600;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

/* Forms Section */
.forms-section {
  grid-column: span 6;
  display: flex;
  flex-direction: column;
  gap: var(--spacing-xl);
}

.form-card {
  background: var(--card);
  border-radius: var(--radius-lg);
  padding: var(--spacing-xl);
  border: 1px solid var(--border);
  transition: all var(--transition);
  max-width: 100%;
  overflow: hidden;
}

.form-card:hover {
  box-shadow: var(--shadow-md);
}

.form-card h2 {
  font-size: 1.25rem;
  font-weight: 700;
  margin-bottom: var(--spacing-lg);
  display: flex;
  align-items: center;
  gap: var(--spacing-sm);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

/* Form Elements */
.form-group {
  margin-bottom: var(--spacing-lg);
}

.form-group label {
  display: block;
  margin-bottom: var(--spacing-xs);
  font-weight: 600;
  color: var(--text);
  font-size: 0.875rem;
  white-space: nowrap;
}

input, textarea, select {
  width: 100%;
  padding: 0.875rem 1rem;
  border: 2px solid var(--border);
  border-radius: var(--radius);
  background: var(--bg);
  color: var(--text);
  font-size: 0.9375rem;
  font-family: inherit;
  transition: all var(--transition-fast);
  max-width: 100%;
}

input:focus, textarea:focus, select:focus {
  outline: none;
  border-color: var(--accent);
  box-shadow: 0 0 0 3px var(--accent-light);
  background: var(--card);
}

textarea {
  min-height: 120px;
  resize: vertical;
  line-height: 1.6;
}

.btn-submit {
  width: 100%;
  padding: 1rem;
  background: var(--gradient-primary);
  color: white;
  border: none;
  border-radius: var(--radius);
  font-weight: 700;
  font-size: 1rem;
  cursor: pointer;
  transition: all var(--transition);
  display: flex;
  align-items: center;
  justify-content: center;
  gap: var(--spacing-sm);
  white-space: nowrap;
}

.btn-submit:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(79, 70, 229, 0.4);
}

/* Task Priority Badges */
.priority-badge {
  padding: 0.25rem 0.75rem;
  border-radius: 1rem;
  font-size: 0.75rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  display: inline-flex;
  align-items: center;
  gap: 0.25rem;
  white-space: nowrap;
}

.priority-urgent {
  background: rgba(239, 68, 68, 0.1);
  color: var(--danger);
  border: 1px solid var(--danger);
}

.priority-not-urgent {
  background: rgba(245, 158, 11, 0.1);
  color: var(--warning);
  border: 1px solid var(--warning);
}

.priority-optional {
  background: rgba(156, 163, 175, 0.1);
  color: var(--text-muted);
  border: 1px solid var(--text-muted);
}

.priority-selector {
  display: flex;
  gap: var(--spacing-sm);
  margin-bottom: var(--spacing-md);
}

.priority-option {
  flex: 1;
  padding: 0.5rem;
  border: 2px solid var(--border);
  border-radius: var(--radius-sm);
  text-align: center;
  cursor: pointer;
  transition: all var(--transition);
  font-size: 0.875rem;
  font-weight: 500;
  white-space: nowrap;
}

.priority-option:hover {
  transform: translateY(-2px);
}

.priority-option.active {
  border-color: var(--accent);
  background: var(--accent-light);
}

.priority-option[data-priority="urgent"]:hover,
.priority-option[data-priority="urgent"].active {
  border-color: var(--danger);
  background: rgba(239, 68, 68, 0.1);
}

.priority-option[data-priority="not-urgent"]:hover,
.priority-option[data-priority="not-urgent"].active {
  border-color: var(--warning);
  background: rgba(245, 158, 11, 0.1);
}

.priority-option[data-priority="optional"]:hover,
.priority-option[data-priority="optional"].active {
  border-color: var(--text-muted);
  background: rgba(156, 163, 175, 0.1);
}

/* Content Section */
.content-section {
  grid-column: span 6;
  display: flex;
  flex-direction: column;
  gap: var(--spacing-xl);
}

.content-card {
  background: var(--card);
  border-radius: var(--radius-lg);
  border: 1px solid var(--border);
  overflow: hidden;
  max-width: 100%;
}

.content-header {
  padding: var(--spacing-xl);
  border-bottom: 1px solid var(--border);
  display: flex;
  justify-content: space-between;
  align-items: center;
  flex-wrap: nowrap;
  gap: var(--spacing-md);
  min-width: 0;
}

.content-header h2 {
  font-size: 1.25rem;
  font-weight: 700;
  display: flex;
  align-items: center;
  gap: var(--spacing-sm);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.content-body {
  padding: var(--spacing-xl);
  max-height: 400px;
  overflow-y: auto;
}

/* Task List */
.task-list {
  list-style: none;
  padding: 0;
  animation: fadeIn 0.8s ease-out;
}

.task-item {
  background: var(--bg);
  border: 1px solid var(--border);
  border-radius: var(--radius-lg);
  padding: var(--spacing-lg);
  margin-bottom: var(--spacing-md);
  display: flex;
  justify-content: space-between;
  align-items: center;
  flex-wrap: nowrap;
  gap: var(--spacing-md);
  transition: all var(--transition);
  position: relative;
  overflow: hidden;
  max-width: 100%;
}

.task-item::before {
  content: '';
  position: absolute;
  left: 0;
  top: 0;
  bottom: 0;
  width: 4px;
  background: var(--gradient-primary);
  opacity: 0;
  transition: var(--transition);
}

.task-item:hover {
  border-color: var(--accent);
  transform: translateX(10px);
  box-shadow: var(--shadow);
  background: var(--accent-light);
}

.task-item:hover::before {
  opacity: 1;
}

.task-item.completed {
  opacity: 0.7;
  border-left: 4px solid var(--success);
}

.task-item.completed .task-text {
  text-decoration: line-through;
  color: var(--text-muted);
}

.task-item.urgent {
  border-left: 4px solid var(--danger);
}

.task-item.not-urgent {
  border-left: 4px solid var(--warning);
}

.task-item.optional {
  border-left: 4px solid var(--text-muted);
}

.task-text {
  flex: 1;
  min-width: 0;
  font-size: 1.1rem;
  font-weight: 500;
  cursor: pointer;
  padding: 0.5rem 0;
  transition: var(--transition);
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.task-text:hover {
  color: var(--accent);
}

.task-actions {
  display: flex;
  gap: var(--spacing-sm);
  flex-wrap: nowrap;
  align-items: center;
  flex-shrink: 0;
}

/* Assignment List */
.assignment-list {
  display: flex;
  flex-direction: column;
  gap: var(--spacing-md);
}

.assignment-item {
  background: var(--bg);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: var(--spacing-lg);
  transition: all var(--transition);
  max-width: 100%;
  overflow: hidden;
}

.assignment-item:hover {
  transform: translateX(5px);
  border-color: var(--accent);
  box-shadow: var(--shadow);
}

.assignment-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  margin-bottom: var(--spacing-sm);
  flex-wrap: nowrap;
  gap: var(--spacing-sm);
  min-width: 0;
}

.assignment-title {
  font-weight: 600;
  color: var(--text);
  font-size: 1.125rem;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.assignment-date {
  color: var(--text-muted);
  font-size: 0.8125rem;
  font-weight: 500;
  background: var(--card);
  padding: 0.25rem 0.75rem;
  border-radius: 1rem;
  border: 1px solid var(--border);
  white-space: nowrap;
  flex-shrink: 0;
}

.assignment-content {
  color: var(--text);
  margin-bottom: var(--spacing-md);
  line-height: 1.7;
  padding: 0.5rem 0;
  overflow: hidden;
}

.assignment-actions {
  display: flex;
  justify-content: flex-end;
  gap: var(--spacing-sm);
  flex-wrap: nowrap;
}

/* Classroom Announcements & Resources */
.classroom-item {
  background: var(--bg);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: var(--spacing-lg);
  margin-bottom: var(--spacing-md);
  transition: all var(--transition);
  max-width: 100%;
  overflow: hidden;
}

.classroom-item:hover {
  transform: translateX(5px);
  border-color: var(--accent);
  box-shadow: var(--shadow);
}

.classroom-item-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  margin-bottom: var(--spacing-sm);
  flex-wrap: nowrap;
  gap: var(--spacing-sm);
  min-width: 0;
}

.classroom-item-title {
  font-weight: 600;
  color: var(--text);
  font-size: 1.125rem;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.classroom-item-date {
  color: var(--text-muted);
  font-size: 0.8125rem;
  font-weight: 500;
  background: var(--card);
  padding: 0.25rem 0.75rem;
  border-radius: 1rem;
  border: 1px solid var(--border);
  white-space: nowrap;
  flex-shrink: 0;
}

.classroom-item-content {
  color: var(--text);
  margin-bottom: var(--spacing-md);
  line-height: 1.7;
  overflow: hidden;
}

.classroom-item-link {
  color: var(--accent);
  text-decoration: none;
  font-weight: 600;
  display: flex;
  align-items: center;
  gap: 0.5rem;
  white-space: nowrap;
}

.classroom-item-link:hover {
  text-decoration: underline;
}

/* Tools Grid */
.tools-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: var(--spacing-lg);
  margin-top: var(--spacing-lg);
}

.tool-item {
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: var(--radius-lg);
  padding: var(--spacing-xl);
  text-align: center;
  transition: all var(--transition);
  cursor: pointer;
  text-decoration: none;
  color: var(--text);
  display: block;
  max-width: 100%;
  overflow: hidden;
}

.tool-item:hover {
  border-color: var(--accent);
  transform: translateY(-8px);
  box-shadow: var(--shadow-xl);
  background: var(--accent-light);
}

.tool-icon {
  font-size: 3rem;
  margin-bottom: var(--spacing-md);
  display: inline-block;
  animation: iconBounce 2s ease-in-out infinite;
}

@keyframes iconBounce {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-10px); }
}

.tool-name {
  font-size: 1.25rem;
  font-weight: 700;
  margin-bottom: var(--spacing-xs);
  color: var(--accent);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.tool-desc {
  font-size: 0.875rem;
  color: var(--text-muted);
  line-height: 1.4;
  overflow: hidden;
  text-overflow: ellipsis;
  display: -webkit-box;
  
  -webkit-box-orient: vertical;
}

/* ===== BUTTONS ===== */
.btn {
  padding: 0.5rem 0.75rem;
  border-radius: var(--radius);
  border: none;
  font-weight: 600;
  font-size: 0.875rem;
  cursor: pointer;
  transition: all var(--transition);
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 0.5rem;
  white-space: nowrap;
  flex-shrink: 0;
}

.btn-primary {
  background: var(--gradient-primary);
  color: white;
  border: 1px solid rgba(255, 255, 255, 0.2);
}

.btn-primary:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(79, 70, 229, 0.4);
}

.btn-success {
  background: var(--gradient-success);
  color: white;
  border: 1px solid rgba(255, 255, 255, 0.2);
}

.btn-success:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(16, 185, 129, 0.4);
}

.btn-warning {
  background: var(--gradient-warning);
  color: white;
  border: 1px solid rgba(255, 255, 255, 0.2);
}

.btn-warning:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(245, 158, 11, 0.4);
}

.btn-danger {
  background: var(--gradient-danger);
  color: white;
  border: 1px solid rgba(255, 255, 255, 0.2);
}

.btn-danger:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(239, 68, 68, 0.4);
}

.btn-secondary {
  background: var(--card);
  color: var(--text);
  border: 1px solid var(--border);
}

.btn-secondary:hover {
  background: var(--accent-light);
  border-color: var(--accent);
  transform: translateY(-2px);
  box-shadow: var(--shadow);
}

.btn-icon {
  width: 40px;
  height: 40px;
  padding: 0;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
}

/* ===== TOAST NOTIFICATIONS ===== */
.toast-container {
  position: fixed;
  top: 24px;
  right: 24px;
  z-index: 1000;
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.toast {
  min-width: 300px;
  padding: 1.125rem 1.5rem;
  border-radius: var(--radius);
  background: var(--card);
  color: var(--text);
  box-shadow: var(--shadow-xl);
  display: flex;
  align-items: center;
  gap: 0.875rem;
  animation: slideIn 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
  border-left: 4px solid var(--accent);
  border: 1px solid var(--border);
}

@keyframes slideIn {
  from { 
    opacity: 0; 
    transform: translateY(20px) scale(0.95); 
  }
  to { 
    opacity: 1; 
    transform: translateY(0) scale(1); 
  }
}

.toast.success { border-left-color: var(--success); }
.toast.error { border-left-color: var(--danger); }
.toast.warning { border-left-color: var(--warning); }
.toast.info { border-left-color: var(--info); }

/* ===== IMPROVED STREAK CARD ===== */
.streak-card {
  background: var(--gradient-warning);
  color: white;
  text-align: center;
  padding: var(--spacing-xl);
  border-radius: var(--radius-lg);
  position: relative;
  overflow: hidden;
}

.streak-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(45deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0) 50%, rgba(255,255,255,0.1) 100%);
  animation: shimmer 2s infinite;
}

@keyframes shimmer {
  0% { transform: translateX(-100%); }
  100% { transform: translateX(100%); }
}

.streak-number {
  font-size: 4rem;
  font-weight: 900;
  line-height: 1;
  margin: var(--spacing-md) 0;
  text-shadow: 0 4px 20px rgba(0,0,0,0.3);
  position: relative;
  z-index: 1;
}

.streak-label {
  font-size: 1.25rem;
  opacity: 0.9;
  margin-bottom: var(--spacing-lg);
  position: relative;
  z-index: 1;
  white-space: nowrap;
}

.streak-milestones {
  display: flex;
  justify-content: center;
  gap: var(--spacing-sm);
  margin: var(--spacing-md) 0;
  position: relative;
  z-index: 1;
  flex-wrap: wrap;
}

.milestone {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background: rgba(255, 255, 255, 0.3);
}

.milestone.active {
  background: white;
  box-shadow: 0 0 10px rgba(255, 255, 255, 0.8);
}

.streak-btn {
  background: rgba(255, 255, 255, 0.2);
  color: white;
  border: 2px solid rgba(255, 255, 255, 0.3);
  padding: 1rem 2rem;
  border-radius: var(--radius);
  font-size: 1.1rem;
  font-weight: 700;
  cursor: pointer;
  transition: var(--transition);
  display: inline-flex;
  align-items: center;
  gap: 0.75rem;
  width: 100%;
  justify-content: center;
  position: relative;
  z-index: 1;
  white-space: nowrap;
}

.streak-btn:hover:not(:disabled) {
  background: rgba(255, 255, 255, 0.3);
  transform: translateY(-2px);
  box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
}

.streak-btn:disabled {
  opacity: 0.6;
  cursor: not-allowed;
}

.streak-progress {
  height: 6px;
  background: rgba(255, 255, 255, 0.2);
  border-radius: 3px;
  margin: var(--spacing-md) 0;
  position: relative;
  z-index: 1;
  overflow: hidden;
}

.streak-progress-fill {
  height: 100%;
  background: white;
  border-radius: 3px;
  transition: width 0.5s ease;
  position: relative;
}

.streak-progress-fill::after {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
  animation: progressShimmer 2s infinite;
}

@keyframes progressShimmer {
  0% { transform: translateX(-100%); }
  100% { transform: translateX(100%); }
}

/* ===== MOTIVATION CARD ===== */
.motivation-card {
  background: var(--gradient-purple);
  color: white;
  position: relative;
  overflow: hidden;
}

.motivation-card::before {
  content: '';
  position: absolute;
  top: -50%;
  left: -50%;
  width: 200%;
  height: 200%;
  background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0) 70%);
}

.quote-text {
  font-size: 1.5rem;
  font-style: italic;
  line-height: 1.6;
  margin-bottom: var(--spacing-md);
  position: relative;
  z-index: 1;
  text-shadow: 0 2px 4px rgba(0,0,0,0.3);
}

.quote-author {
  font-size: 1.1rem;
  opacity: 0.9;
  position: relative;
  z-index: 1;
  text-shadow: 0 1px 2px rgba(0,0,0,0.3);
}

/* ===== CLASS CODE DISPLAY ===== */
.class-code-display {
  background: var(--gradient-primary);
  color: white;
  padding: var(--spacing-xl);
  border-radius: var(--radius-lg);
  margin: var(--spacing-xl) 0;
  text-align: center;
  position: relative;
  overflow: hidden;
}

.class-code-display::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(45deg, rgba(255,255,255,0.1) 25%, transparent 25%, transparent 50%, rgba(255,255,255,0.1) 50%, rgba(255,255,255,0.1) 75%, transparent 75%);
  background-size: 20px 20px;
}

.class-code-display .code {
  font-size: 3rem;
  font-weight: 900;
  letter-spacing: 0.5rem;
  font-family: 'Courier New', monospace;
  margin: var(--spacing-md) 0;
  text-shadow: 0 4px 20px rgba(0,0,0,0.3);
  position: relative;
  z-index: 1;
  word-break: break-all;
}

/* ===== MULTIPLE CLASSES VIEW ===== */
.classes-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: var(--spacing-lg);
  margin-top: var(--spacing-lg);
}

.class-card {
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: var(--radius-lg);
  padding: var(--spacing-xl);
  transition: all var(--transition);
  position:relative;
  overflow: hidden;
  max-width: 100%;
}

.class-card:hover {
  border-color: var(--accent);
  transform: translateY(-5px);
  box-shadow: var(--shadow-lg);
}

.class-card-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: var(--spacing-md);
  flex-wrap: nowrap;
  gap: var(--spacing-sm);
  min-width: 0;
}

.class-card-title {
  font-size: 1.25rem;
  font-weight: 700;
  color: var(--text);
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.class-card-code {
  background: var(--accent);
  color: white;
  padding: 0.25rem 0.75rem;
  border-radius: 1rem;
  font-family: 'Courier New', monospace;
  font-size: 0.875rem;
  font-weight: 700;
  white-space: nowrap;
  flex-shrink: 0;
}

.class-card-stats {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: var(--spacing-sm);
  margin-top: var(--spacing-md);
}

.class-card-stat {
  text-align: center;
  padding: var(--spacing-sm);
  background: var(--bg);
  border-radius: var(--radius);
  border: 1px solid var(--border);
  overflow: hidden;
}

.class-card-stat .value {
  font-size: 1.25rem;
  font-weight: 700;
  color: var(--accent);
  overflow: hidden;
  text-overflow: ellipsis;
}

.class-card-stat .label {
  font-size: 0.75rem;
  color: var(--text-muted);
  text-transform: uppercase;
  letter-spacing: 0.5px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.class-card-actions {
  display: flex;
  gap: var(--spacing-sm);
  margin-top: var(--spacing-md);
  flex-wrap: nowrap;
}

.class-card-actions .btn {
  flex: 1;
  min-width: 0;
  overflow: hidden;
  text-overflow: ellipsis;
}

/* ===== LEADERBOARD STYLES ===== */
.leaderboard-container {
  display: flex;
  flex-direction: column;
  gap: var(--spacing-md);
}

.leaderboard-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding-bottom: var(--spacing-md);
  border-bottom: 1px solid var(--border);
  flex-wrap: nowrap;
  gap: var(--spacing-sm);
}

.leaderboard-stats {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: var(--spacing-sm);
  margin-bottom: var(--spacing-md);
}

.leaderboard-stat {
  text-align: center;
  padding: var(--spacing-sm);
  background: var(--bg);
  border-radius: var(--radius);
  border: 1px solid var(--border);
  overflow: hidden;
}

.leaderboard-stat .value {
  font-size: 1.5rem;
  font-weight: 700;
  color: var(--accent);
  margin-bottom: 0.25rem;
  overflow: hidden;
  text-overflow: ellipsis;
}

.leaderboard-stat .label {
  font-size: 0.75rem;
  color: var(--text-muted);
  text-transform: uppercase;
  letter-spacing: 0.5px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.leaderboard-list {
  display: flex;
  flex-direction: column;
  gap: var(--spacing-xs);
}

.leaderboard-item {
  display: flex;
  align-items: center;
  gap: var(--spacing-md);
  padding: var(--spacing-md);
  background: var(--bg);
  border-radius: var(--radius);
  border: 1px solid var(--border);
  transition: all var(--transition);
  flex-wrap: nowrap;
  max-width: 100%;
  overflow: hidden;
}

.leaderboard-item:hover {
  transform: translateX(5px);
  border-color: var(--accent);
  background: var(--accent-light);
}

.leaderboard-item.you {
  background: var(--gradient-primary);
  color: white;
  border-color: var(--accent-dark);
}

.leaderboard-item.you .rank,
.leaderboard-item.you .score,
.leaderboard-item.you .name {
  color: white;
}

.leaderboard-rank {
  font-size: 1.5rem;
  font-weight: 900;
  width: 40px;
  text-align: center;
  color: var(--accent);
  flex-shrink: 0;
}

.rank-1 .leaderboard-rank { color: #FFD700; }
.rank-2 .leaderboard-rank { color: #C0C0C0; }
.rank-3 .leaderboard-rank { color: #CD7F32; }

.leaderboard-avatar {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  background: var(--gradient-primary);
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 700;
  color: white;
  font-size: 1.25rem;
  flex-shrink: 0;
}

.leaderboard-info {
  flex: 1;
  min-width: 0;
  overflow: hidden;
}

.leaderboard-name {
  font-weight: 700;
  font-size: 1.125rem;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.leaderboard-subtitle {
  font-size: 0.875rem;
  color: var(--text-muted);
  margin-top: 0.25rem;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.leaderboard-item.you .leaderboard-subtitle {
  color: rgba(255, 255, 255, 0.8);
}

.leaderboard-score {
  font-weight: 700;
  font-size: 1.25rem;
  color: var(--accent);
  text-align: right;
  min-width: 80px;
  flex-shrink: 0;
}

.leaderboard-stats-row {
  display: flex;
  gap: var(--spacing-sm);
  margin-top: var(--spacing-sm);
  flex-wrap: nowrap;
}

.stats-badge {
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: 1rem;
  padding: 0.25rem 0.75rem;
  font-size: 0.75rem;
  color: var(--text-muted);
  display: flex;
  align-items: center;
  gap: 0.25rem;
  white-space: nowrap;
  flex-shrink: 0;
}

.stats-badge.fire { color: var(--warning); }
.stats-badge.time { color: var(--info); }
.stats-badge.points { color: var(--success); }

.leaderboard-empty {
  text-align: center;
  padding: var(--spacing-2xl);
  color: var(--text-muted);
}

/* ===== UPDATED STATISTICS SECTION ===== */
.statistics-grid {
  display: grid;
  grid-template-columns: repeat(12, 1fr);
  gap: var(--spacing-lg);
  margin-top: var(--spacing-xl);
}

.statistics-header {
  grid-column: span 12;
  background: var(--card);
  border-radius: var(--radius-lg);
  padding: var(--spacing-xl);
  border: 1px solid var(--border);
  margin-bottom: var(--spacing-lg);
}

.statistics-header h2 {
  font-size: 1.5rem;
  font-weight: 700;
  margin-bottom: var(--spacing-sm);
  color: var(--text);
}

.statistics-subtitle {
  color: var(--text-muted);
  font-size: 1rem;
  margin-bottom: var(--spacing-lg);
}

.stats-overview-cards {
  grid-column: span 12;
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: var(--spacing-lg);
  margin-bottom: var(--spacing-xl);
}

.stats-overview-card {
  background: var(--card);
  border-radius: var(--radius);
  padding: var(--spacing-lg);
  border: 1px solid var(--border);
  transition: var(--transition);
  text-align: center;
  position: relative;
  overflow: hidden;
}

.stats-overview-card:hover {
  transform: translateY(-3px);
  box-shadow: var(--shadow);
  border-color: var(--accent);
}

.stats-overview-icon {
  font-size: 2rem;
  margin-bottom: var(--spacing-sm);
  display: block;
}

.stats-overview-number {
  font-size: 2rem;
  font-weight: 800;
  color: var(--accent);
  margin-bottom: var(--spacing-xs);
  line-height: 1;
}

.stats-overview-label {
  font-size: 0.875rem;
  color: var(--text-muted);
  text-transform: uppercase;
  letter-spacing: 0.5px;
  margin-bottom: var(--spacing-sm);
}

.stats-overview-trend {
  font-size: 0.75rem;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: var(--spacing-xs);
  margin-top: var(--spacing-sm);
}

.stats-overview-trend.up {
  color: var(--success);
}

.stats-overview-trend.down {
  color: var(--danger);
}

.stats-overview-trend.neutral {
  color: var(--text-muted);
}

/* Charts Container - Improved for Mobile */
.charts-container {
  grid-column: span 12;
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
  gap: var(--spacing-lg);
  margin-bottom: var(--spacing-xl);
}

.chart-card {
  background: var(--card);
  border-radius: var(--radius-lg);
  padding: var(--spacing-xl);
  border: 1px solid var(--border);
  transition: all var(--transition);
  overflow: hidden;
  display: flex;
  flex-direction: column;
}

.chart-card:hover {
  box-shadow: var(--shadow-md);
  border-color: var(--accent);
}

.chart-header {
  margin-bottom: var(--spacing-lg);
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  flex-wrap: wrap;
  gap: var(--spacing-sm);
}

.chart-header h3 {
  font-size: 1.125rem;
  font-weight: 700;
  color: var(--text);
  display: flex;
  align-items: center;
  gap: var(--spacing-sm);
}

.chart-description {
  font-size: 0.875rem;
  color: var(--text-muted);
  margin-top: var(--spacing-xs);
  line-height: 1.4;
}

.chart-wrapper {
  position: relative;
  height: 250px;
  width: 100%;
  flex: 1;
  min-height: 200px;
}

/* Detailed Statistics */
.stats-detailed-container {
  grid-column: span 12;
  background: var(--card);
  border-radius: var(--radius-lg);
  padding: var(--spacing-xl);
  border: 1px solid var(--border);
  margin-top: var(--spacing-lg);
}

.stats-detailed-container h3 {
  font-size: 1.25rem;
  font-weight: 700;
  margin-bottom: var(--spacing-lg);
  color: var(--text);
  display: flex;
  align-items: center;
  gap: var(--spacing-sm);
}

.stats-detailed-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: var(--spacing-lg);
  margin-bottom: var(--spacing-xl);
}

.stats-detailed-section {
  padding: var(--spacing-lg);
  background: var(--bg);
  border-radius: var(--radius);
  border: 1px solid var(--border);
}

.stats-detailed-section h4 {
  font-size: 0.9375rem;
  font-weight: 600;
  color: var(--text-muted);
  margin-bottom: var(--spacing-md);
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.stats-detailed-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: var(--spacing-sm) 0;
  border-bottom: 1px solid rgba(var(--border-rgb), 0.2);
}

.stats-detailed-row:last-child {
  border-bottom: none;
}

.stats-detailed-label {
  font-size: 0.875rem;
  color: var(--text);
}

.stats-detailed-value {
  font-size: 1rem;
  font-weight: 700;
  color: var(--accent);
}

/* Chart Legends - Theme Adaptive */
.chart-legend {
  display: flex;
  flex-wrap: wrap;
  gap: var(--spacing-sm);
  margin-top: var(--spacing-md);
  padding-top: var(--spacing-md);
  border-top: 1px solid var(--border);
}

.legend-item {
  display: flex;
  align-items: center;
  gap: var(--spacing-xs);
  font-size: 0.75rem;
  color: var(--text-muted);
}

.legend-color {
  width: 12px;
  height: 12px;
  border-radius: 2px;
}

/* Statistics Controls */
.stats-controls {
  display: flex;
  gap: var(--spacing-sm);
  flex-wrap: wrap;
  margin-top: var(--spacing-lg);
  padding-top: var(--spacing-lg);
  border-top: 1px solid var(--border);
}

.stats-controls .btn {
  font-size: 0.875rem;
  padding: 0.5rem 1rem;
}

/* Performance Metrics */
.performance-metrics {
  grid-column: span 12;
  background: var(--card);
  border-radius: var(--radius-lg);
  padding: var(--spacing-xl);
  border: 1px solid var(--border);
  margin-top: var(--spacing-lg);
}

.performance-metrics h3 {
  font-size: 1.25rem;
  font-weight: 700;
  margin-bottom: var(--spacing-lg);
  color: var(--text);
}

.metrics-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: var(--spacing-lg);
}

.metric-card {
  background: var(--bg);
  border-radius: var(--radius);
  padding: var(--spacing-lg);
  border: 1px solid var(--border);
  text-align: center;
  transition: var(--transition);
}

.metric-card:hover {
  transform: translateY(-2px);
  box-shadow: var(--shadow);
}

.metric-icon {
  font-size: 1.5rem;
  margin-bottom: var(--spacing-sm);
  display: block;
}

.metric-value {
  font-size: 1.75rem;
  font-weight: 800;
  color: var(--accent);
  margin-bottom: var(--spacing-xs);
  line-height: 1;
}

.metric-label {
  font-size: 0.875rem;
  color: var(--text-muted);
  margin-bottom: var(--spacing-xs);
}

.metric-details {
  font-size: 0.75rem;
  color: var(--text);
  opacity: 0.8;
}

/* Study Session Button */
.study-session-btn {
  margin-top: var(--spacing-lg);
  width: 100%;
}

/* ===== FOOTER WITH COPYRIGHT ===== */
.footer {
  grid-column: span 12;
  text-align: center;
  padding: var(--spacing-xl);
  margin-top: var(--spacing-2xl);
  color: var(--text-muted);
  font-size: 0.875rem;
  border-top: 1px solid var(--border);
}

.footer a {
  color: var(--accent);
  text-decoration: none;
}

.footer a:hover {
  text-decoration: underline;
}

/* ===== SCROLLBAR ===== */
::-webkit-scrollbar { 
  width: 8px; 
  height: 8px;
}

::-webkit-scrollbar-track { 
  background: var(--bg); 
  border-radius: 4px;
}

::-webkit-scrollbar-thumb { 
  background: var(--accent); 
  border-radius: 4px;
  border: 2px solid var(--bg);
}

::-webkit-scrollbar-thumb:hover { 
  background: var(--accent-dark); 
}

/* ===== LOADING STATES ===== */
.loading {
  text-align: center;
  padding: var(--spacing-2xl);
  color: var(--text-muted);
  font-size: 1.125rem;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: var(--spacing-md);
}

.loading::after {
  content: '';
  width: 40px;
  height: 40px;
  border: 3px solid var(--border);
  border-top-color: var(--accent);
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

/* ===== EMPTY STATES ===== */
.empty-state {
  text-align: center;
  padding: var(--spacing-2xl);
  color: var(--text-muted);
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: var(--spacing-md);
}

.empty-state-icon {
  font-size: 4rem;
  margin-bottom: var(--spacing-lg);
  opacity: 0.5;
}

.empty-state-title {
  font-size: 1.5rem;
  margin-bottom: var(--spacing-sm);
  color: var(--text);
}

.empty-state-description {
  font-size: 1rem;
  line-height: 1.6;
}

/* ===== SYNC STATUS ===== */
.sync-status {
  position: fixed;
  top: 80px;
  right: 20px;
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid var(--border);
  border-radius: var(--radius-lg);
  padding: var(--spacing-sm) var(--spacing-md);
  font-size: 0.875rem;
  z-index: 999;
  box-shadow: var(--shadow);
  display: flex;
  align-items: center;
  gap: 0.5rem;
  backdrop-filter: blur(10px);
  animation: fadeIn 0.5s ease-out;
  white-space: nowrap;
}

/* ===== EXTREME RESPONSIVENESS ===== */

/* Desktop (1200px and above) */
@media (min-width: 1200px) {
  .app-layout {
    grid-template-columns: 280px 1fr;
  }
  
  .forms-section,
  .content-section {
    grid-column: span 6;
  }
  
  .quick-stats {
    grid-template-columns: repeat(4, 1fr);
  }
  
  .charts-container {
    grid-template-columns: repeat(2, 1fr);
  }
}

/* Tablet (768px to 1199px) */
@media (max-width: 1199px) and (min-width: 768px) {
  .app-layout {
    grid-template-columns: 240px 1fr;
  }
  
  .forms-section,
  .content-section {
    grid-column: span 6;
  }
  
  .quick-stats {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .charts-container {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-overview-cards {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stats-detailed-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .tools-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .classes-grid {
    grid-template-columns: repeat(2, 1fr);
  }
}

/* Mobile (below 768px) */
@media (max-width: 767px) {
  .app-layout {
    grid-template-columns: 1fr;
  }
  
  .top-nav {
    display: block;
  }
  
  .sidebar {
    position: fixed;
    top: 60px;
    left: -280px;
    width: 280px;
    height: calc(100vh - 60px);
    transition: left 0.3s ease;
    z-index: 100;
    padding: var(--spacing-lg);
  }
  
  .sidebar.active {
    left: 0;
  }
  
  .mobile-menu-toggle {
    display: flex;
  }
  
  .mobile-overlay.active {
    display: block;
  }
  
  .main-content {
    margin-top: 60px;
    padding: var(--spacing-md);
  }
  
  .forms-section,
  .content-section {
    grid-column: span 12;
  }
  
  .quick-stats {
    grid-template-columns: repeat(2, 1fr);
    gap: var(--spacing-sm);
  }
  
  .dashboard-header h1 {
    font-size: 1.75rem;
    text-align: center;
  }
  
  .dashboard-subtitle {
    text-align: center;
  }
  
  .controls-bar {
    flex-wrap: wrap;
    padding: var(--spacing-sm);
    gap: var(--spacing-sm);
    justify-content: center;
  }
  
  .controls-bar .btn {
    font-size: 0.75rem;
    padding: 0.375rem 0.625rem;
    flex: 1;
    min-width: calc(50% - 0.375rem);
  }
  
  /* UPDATED: Statistics Section for Mobile */
  .statistics-grid {
    gap: var(--spacing-md);
  }
  
  .statistics-header {
    padding: var(--spacing-lg);
    text-align: center;
  }
  
  .statistics-header h2 {
    font-size: 1.25rem;
  }
  
  .stats-overview-cards {
    grid-template-columns: repeat(2, 1fr);
    gap: var(--spacing-md);
  }
  
  .stats-overview-card {
    padding: var(--spacing-md);
  }
  
  .stats-overview-number {
    font-size: 1.5rem;
  }
  
  .stats-overview-icon {
    font-size: 1.5rem;
  }
  
  .charts-container {
    grid-template-columns: 1fr;
    gap: var(--spacing-md);
  }
  
  .chart-card {
    padding: var(--spacing-lg);
  }
  
  .chart-header {
    flex-direction: column;
    align-items: flex-start;
    gap: var(--spacing-sm);
    margin-bottom: var(--spacing-md);
  }
  
  .chart-header h3 {
    font-size: 1rem;
  }
  
  .chart-wrapper {
    height: 200px;
    min-height: 150px;
  }
  
  .chart-description {
    font-size: 0.8125rem;
  }
  
  .stats-detailed-container {
    padding: var(--spacing-lg);
  }
  
  .stats-detailed-grid {
    grid-template-columns: 1fr;
    gap: var(--spacing-md);
  }
  
  .stats-detailed-section {
    padding: var(--spacing-md);
  }
  
  .stats-detailed-row {
    padding: var(--spacing-xs) 0;
  }
  
  .performance-metrics {
    padding: var(--spacing-lg);
  }
  
  .metrics-grid {
    grid-template-columns: repeat(2, 1fr);
    gap: var(--spacing-md);
  }
  
  .metric-card {
    padding: var(--spacing-md);
  }
  
  .metric-value {
    font-size: 1.5rem;
  }
  
  .stats-controls {
    flex-direction: column;
    gap: var(--spacing-sm);
  }
  
  .stats-controls .btn {
    width: 100%;
    justify-content: center;
  }
  
  .content-header {
    flex-direction: column;
    align-items: flex-start;
    gap: var(--spacing-sm);
  }
  
  .content-header h2 {
    font-size: 1.125rem;
  }
  
  .stat-card {
    flex-direction: column;
    text-align: center;
    gap: var(--spacing-sm);
    padding: var(--spacing-sm);
  }
  
  .stat-icon {
    width: 32px;
    height: 32px;
    font-size: 1rem;
  }
  
  .stat-number {
    font-size: 1.25rem;
  }
  
  .stat-label {
    font-size: 0.65rem;
  }
  
  .task-item {
    flex-direction: column;
    align-items: flex-start;
    gap: var(--spacing-md);
  }
  
  .task-actions {
    width: 100%;
    justify-content: flex-end;
  }
  
  .assignment-header {
    flex-direction: column;
    align-items: flex-start;
  }
  
  .class-card-header {
    flex-direction: column;
    align-items: flex-start;
  }
  
  .leaderboard-item {
    flex-direction: column;
    align-items: flex-start;
    gap: var(--spacing-sm);
  }
  
  .leaderboard-score {
    align-self: flex-end;
    margin-top: var(--spacing-sm);
  }
}

/* Small Mobile (below 480px) */
@media (max-width: 479px) {
  .quick-stats {
    grid-template-columns: 1fr;
  }
  
  .stats-overview-cards {
    grid-template-columns: 1fr;
  }
  
  .charts-container {
    grid-template-columns: 1fr;
  }
  
  .stats-detailed-grid {
    grid-template-columns: 1fr;
  }
  
  .metrics-grid {
    grid-template-columns: 1fr;
  }
  
  .controls-bar .btn {
    font-size: 0.7rem;
    padding: 0.375rem 0.5rem;
    min-width: 100%;
  }
  
  .priority-selector {
    flex-direction: column;
  }
  
  .class-code-display .code {
    font-size: 2rem;
    letter-spacing: 0.25rem;
  }
  
  .streak-number {
    font-size: 3rem;
  }
  
  .dashboard-header h1 {
    font-size: 1.5rem;
  }
  
  .toast {
    min-width: 250px;
    padding: 1rem;
  }
  
  .stat-card {
    padding: 0.75rem;
    min-height: 70px;
  }
  
  .stat-number {
    font-size: 1.1rem;
  }
  
  .chart-wrapper {
    height: 180px;
  }
}

/* Orientation-specific adjustments */
@media (max-height: 600px) and (orientation: landscape) {
  .sidebar {
    padding-top: var(--spacing-lg);
    height: 100vh;
    overflow-y: auto;
  }
  
  .main-content {
    padding: var(--spacing-md);
  }
  
  .chart-wrapper {
    height: 150px;
  }
}

/* Print Styles */
@media print {
  .sidebar,
  .mobile-menu-toggle,
  .controls-bar,
  .btn,
  .task-actions,
  .assignment-actions,
  .class-card-actions {
    display: none !important;
  }
  
  .app-layout {
    grid-template-columns: 1fr;
  }
  
  .main-content {
    padding: 0;
    margin: 0;
  }
  
  .content-card {
    border: 1px solid #000;
    box-shadow: none;
  }
  
  .task-item,
  .assignment-item,
  .classroom-item {
    break-inside: avoid;
  }
  
  .chart-wrapper {
    height: 200px !important;
  }
}
</style>
</head>

<body>

<!-- Top Navigation for Mobile -->
<nav class="top-nav" id="topNav">
  <div class="top-nav-header">
    <h2 style="font-size: 1.25rem; font-weight: 700; margin: 0;">Student Dashboard</h2>
    <button class="mobile-menu-toggle" id="mobileMenuToggle">â˜°</button>
  </div>
</nav>
<div class="mobile-overlay" id="mobileOverlay"></div>

<div class="app-layout">
  
  <!-- Sidebar -->
  <aside class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <div class="student-emoji">ðŸ‘¨â€ðŸŽ“</div>
      <h2>Student Dashboard</h2>
      <p class="sidebar-subtitle">Track Your Learning Journey</p>
    </div>
    
    <!-- Class Switcher -->
    <div class="class-switcher">
      <select id="classSelector" onchange="switchClass(this.value)">
        <option value="">Select a Class</option>
      </select>
    </div>
    
    <nav class="sidebar-nav">
      <div class="nav-item active" onclick="showSection('dashboard'); closeMobileMenu();">
        ðŸ“Š Dashboard
      </div>
      <div class="nav-item" onclick="showSection('tasks'); closeMobileMenu();">
        ðŸ“ Tasks
      </div>
      <div class="nav-item" onclick="showSection('assignments'); closeMobileMenu();">
        ðŸ“š Assignments
      </div>
      <div class="nav-item" onclick="showSection('classroom'); closeMobileMenu();">
        ðŸ« Classroom
      </div>
      <div class="nav-item" onclick="showSection('myclasses'); closeMobileMenu();">
        ðŸŽ“ My Classes
      </div>
      <div class="nav-item" onclick="showSection('statistics'); closeMobileMenu();">
        ðŸ“ˆ Statistics
      </div>
      <div class="nav-item" onclick="showSection('tools'); closeMobileMenu();">
        ðŸ› ï¸ Study Tools
      </div>
      <div class="nav-item" onclick="showSection('ai'); closeMobileMenu();">
        ðŸ¤– AI Help
      </div>
      <div class="nav-item" onclick="showSection('profile'); closeMobileMenu();">
        ðŸ‘¤ Profile
      </div>
      <!-- New Study Group Button -->
      <div class="nav-item" onclick="window.location.href='studygroup.html'; closeMobileMenu();">
        ðŸ‘¥ Study Group
      </div>
    </nav>
    
    <div class="sidebar-stats">
      <h3>Today's Stats</h3>
      <div class="stat-row">
        <span>Study Streak</span>
        <span class="stat-value" id="sidebarStreak">0</span>
      </div>
      <div class="stat-row">
        <span>Total Hours</span>
        <span class="stat-value" id="sidebarHours">0</span>
      </div>
      <div class="stat-row">
        <span>Tasks Done</span>
        <span class="stat-value" id="sidebarTasks">0</span>
      </div>
      <div class="stat-row">
        <span>Focus Score</span>
        <span class="stat-value" id="sidebarFocus">0%</span>
      </div>
    </div>
    
    <!-- Inspiring Stories Section -->
    <div class="stories-section">
      <h3>ðŸŒŸ Inspiring Stories</h3>
      <div id="storiesList">
        <!-- Stories will be loaded here -->
      </div>
    </div>
    
    <div style="margin-top: var(--spacing-xl);">
      <select class="theme-selector" onchange="changeTheme(this.value)" style="width: 100%; padding: 0.875rem; background: var(--bg); border: 1px solid var(--border); border-radius: var(--radius); color: var(--text);">
        <option value="light">â˜€ï¸ Light Theme</option>
        <option value="dark">ðŸŒ™ Dark Theme</option>
        <option value="ocean">ðŸŒŠ Ocean Theme</option>
        <option value="forest">ðŸŒ² Forest Theme</option>
        <option value="sunset">ðŸŒ… Sunset Theme</option>
        <option value="purple">ðŸ’œ Purple Theme</option>
      </select>
    </div>
  </aside>
  
  <!-- Story Modal -->
  <div id="storyModal" class="story-modal">
    <div class="story-modal-content">
      <button class="story-modal-close" onclick="closeStoryModal()">Ã—</button>
      <div class="story-modal-header">
        <h2 id="storyModalTitle"></h2>
      </div>
      <div class="story-modal-body">
        <div id="storyModalContent"></div>
      </div>
    </div>
  </div>
  
  <!-- Main Content -->
  <main class="main-content">
    
    <!-- Dashboard Header -->
    <div class="dashboard-header" id="dashboardHeader">
      <h1>Welcome to Your Learning Dashboard</h1>
      <p class="dashboard-subtitle" id="dashboardSubtitle">Track your progress, manage tasks, and achieve your study goals</p>
      
      <!-- UPDATED: Compact Controls Bar -->
      <div class="controls-bar">
        <button class="btn btn-success" onclick="window.location.href='index.html'">
          Home
        </button>
        <button class="btn btn-success" onclick="showSection('myclasses')">ðŸŽ“ Manage Classes</button>
        <button class="btn btn-secondary" onclick="refreshData()">ðŸ”„ Refresh</button>
        <button class="btn btn-warning" onclick="exportData()">ðŸ“¤ Export Data</button>
      </div>
    </div>
    
    <!-- Toast Container -->
    <div id="toastContainer" class="toast-container"></div>
    
    <!-- Sync Status -->
    <div id="syncStatus" class="sync-status" style="display: none;">
      <span class="sync-icon"></span>
      <span class="sync-text"></span>
    </div>
    
    <!-- Dashboard Grid -->
    <div class="dashboard-grid">
      
      <!-- Dashboard Section -->
      <div id="dashboard" class="dashboard-content" style="grid-column: span 12; display: block;">
        
        <!-- Pro Tip - Matching Teacher Mode Style -->
        <div class="pro-tip">
          <strong>ðŸ’¡ Daily Habit Building</strong>
          Mark your study streak daily! Consistency beats intensity. Even 15 minutes of focused study each day builds a strong habit and improves retention by 60% compared to cramming.
        </div>
        
        <!-- UPDATED: Compact Quick Stats -->
        <div class="quick-stats">
          <div class="stat-card">
            <div class="stat-icon">ðŸ”¥</div>
            <div class="stat-content">
              <div class="stat-number" id="streakDisplay">0</div>
              <div class="stat-label">Study Streak</div>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon">â°</div>
            <div class="stat-content">
              <div class="stat-number" id="totalHoursDisplay">0</div>
              <div class="stat-label">Study Hours</div>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon">âœ…</div>
            <div class="stat-content">
              <div class="stat-number" id="tasksCompletedDisplay">0</div>
              <div class="stat-label">Tasks Done</div>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon">ðŸŽ¯</div>
            <div class="stat-content">
              <div class="stat-number" id="focusScoreDisplay">0%</div>
              <div class="stat-label">Focus Score</div>
            </div>
          </div>
        </div>
        
        <!-- Main Content Area -->
        <div class="dashboard-grid" style="margin-top: var(--spacing-xl);">
          
          <!-- Left Column: Forms & Motivation -->
          <div class="forms-section">
            <!-- Profile Form -->
            <div class="form-card">
              <h2>ðŸ‘¤ My Profile</h2>
              <div class="pro-tip" style="margin: 0 0 var(--spacing-lg) 0;">
                <strong>Tip:</strong> Complete your profile to personalize your learning experience and track progress accurately.
              </div>
              <div class="form-group">
                <label for="studentName">Your Name</label>
                <input type="text" id="studentName" placeholder="Enter your name">
              </div>
              <div class="form-group">
                <label for="studentEmail">Email (Optional)</label>
                <input type="email" id="studentEmail" placeholder="your@email.com">
              </div>
              <div class="form-group">
                <label for="studentBio">Bio</label>
                <textarea id="studentBio" placeholder="Tell us about yourself..." rows="3"></textarea>
              </div>
              <button class="btn-submit" onclick="saveProfile()">
                ðŸ’¾ Save Profile
              </button>
            </div>
            
            <!-- IMPROVED Streak Card -->
            <div class="form-card streak-card">
              <h2 style="color: white; position: relative; z-index: 1;">ðŸ”¥ Daily Study Streak</h2>
              <div class="streak-number" id="streakNumber">0</div>
              <div class="streak-label" id="streakLabel">DAY STREAK</div>
              
              <!-- Streak Milestones -->
              <div class="streak-milestones" id="streakMilestones">
                <!-- Milestones will be added by JavaScript -->
              </div>
              
              <!-- Streak Progress -->
              <div class="streak-progress">
                <div class="streak-progress-fill" id="streakProgressFill" style="width: 0%"></div>
              </div>
              
              <button class="streak-btn" id="streakButton" onclick="markStudyToday()">
                <span>ðŸ”¥ Mark Study Today</span>
              </button>
              <div id="streakMessage" style="margin-top: var(--spacing-md); font-weight: 600; min-height: 24px; position: relative; z-index: 1;"></div>
              <div id="streakInfo" style="margin-top: var(--spacing-sm); font-size: 0.875rem; opacity: 0.8; position: relative; z-index: 1;">
                Last studied: <span id="lastStudyDate">Never</span>
              </div>
              <div id="streakReward" style="margin-top: var(--spacing-sm); font-size: 0.75rem; opacity: 0.7; position: relative; z-index: 1;">
                Next milestone: <span id="nextMilestone">7 days</span>
              </div>
            </div>
            
            <!-- Motivation Card -->
            <div class="form-card motivation-card">
              <h2 style="color: white; position: relative; z-index: 1;">ðŸ’« Daily Inspiration</h2>
              <div class="quote-text" id="dailyQuote">"The only way to do great work is to love what you do."</div>
              <div class="quote-author" id="quoteAuthor">â€” Steve Jobs</div>
              <button class="btn" onclick="newQuote()" style="margin-top: var(--spacing-lg); background: rgba(255,255,255,0.2); border: 2px solid rgba(255,255,255,0.3); color: white; width: 100%; position: relative; z-index: 1;">
                ðŸ”„ New Inspiration
              </button>
            </div>
          </div>
          
          <!-- Right Column: Tasks & Assignments -->
          <div class="content-section">
            <!-- Tasks Card -->
            <div class="content-card">
              <div class="content-header">
                <h2>ðŸ“ My Tasks</h2>
                <button class="btn btn-primary" onclick="showSection('tasks')">View All</button>
              </div>
              <div class="content-body">
                <div class="pro-tip" style="margin: 0 0 var(--spacing-lg) 0;">
                  <strong>Tip:</strong> Break large tasks into smaller, manageable chunks. This reduces overwhelm and increases completion rates by 40%.
                </div>

                <div class="task-input-container" style="display: flex; gap: var(--spacing-sm); margin-bottom: var(--spacing-lg);">
                  <input type="text" id="taskInput" placeholder="Add a new task..." style="flex: 1; min-width: 0;">
                  <button class="btn btn-success" onclick="addTask()">âž• Add</button>
                </div>
                <!-- Add this AFTER the task input container in the Dashboard section -->
<div class="priority-selector" style="margin-bottom: var(--spacing-md);">
    <div class="priority-option active" data-priority="urgent" onclick="selectPriority('urgent')">
        ðŸ”´ Urgent
    </div>
    <div class="priority-option" data-priority="not-urgent" onclick="selectPriority('not-urgent')">
        ðŸŸ¡ Not Urgent
    </div>
    <div class="priority-option" data-priority="optional" onclick="selectPriority('optional')">
        âšª Optional
    </div>
</div>
                <ul class="task-list" id="taskList">
                  <!-- Tasks will appear here -->
                </ul>
              </div>
            </div>
            
            <!-- Assignments Card -->
            <div class="content-card">
              <div class="content-header">
                <h2>ðŸ“š My Assignments</h2>
                <button class="btn btn-primary" onclick="showSection('assignments')">View All</button>
              </div>
              <div class="content-body">
                <div class="pro-tip" style="margin: 0 0 var(--spacing-lg) 0;">
                  <strong>Tip:</strong> Start assignments early! Students who begin assignments 3 days before the due date score 15% higher on average.
                </div>
                <div class="assignment-list" id="assignmentList">
                  <!-- Assignments will appear here -->
                </div>
              </div>
            </div>
            
            <!-- Study Hours Input -->
            <div class="content-card">
              <div class="content-header">
                <h2>â° Add Study Hours</h2>
              </div>
              <div class="content-body">
                <div class="pro-tip" style="margin: 0 0 var(--spacing-lg) 0;">
                  <strong>Tip:</strong> Use the Pomodoro Technique: 25 minutes of focused study followed by a 5-minute break improves concentration and retention.
                </div>
                <div class="form-group">
                  <label for="hoursInput">Study Hours (e.g., 2.5)</label>
                  <input type="number" id="hoursInput" placeholder="Enter study hours" step="0.25" min="0.25" max="12">
                </div>
                <button class="btn-submit" onclick="addStudyHours()">
                  â° Add Hours
                </button>
                <div style="font-size: 0.875rem; color: var(--text-muted); text-align: center; margin-top: var(--spacing-md);">
                  Track your study sessions to see your progress!
                </div>
              </div>
            </div>
          </div>
          
        </div>
        
        <!-- Footer with Copyright -->
        <div class="footer">
          <p>Â© 2024 Student Learning Dashboard. All rights reserved. Made with â¤ï¸ for students everywhere.</p>
          <p style="margin-top: var(--spacing-sm); font-size: 0.75rem; opacity: 0.7;">
            Education is the most powerful weapon which you can use to change the world. â€” Nelson Mandela
          </p>
        </div>
      </div>
      
      <!-- Tasks Section -->
      <div id="tasks" class="dashboard-content" style="grid-column: span 12; display: none;">
        <div class="content-card">
          <div class="content-header">
            <h2>ðŸ“ Task Manager</h2>
            <div style="display: flex; gap: var(--spacing-sm); flex-wrap: wrap;">
              <button class="btn btn-secondary" onclick="filterTasks('all')">All</button>
              <button class="btn btn-secondary" onclick="filterTasks('urgent')">Urgent</button>
              <button class="btn btn-secondary" onclick="filterTasks('not-urgent')">Not Urgent</button>
              <button class="btn btn-secondary" onclick="filterTasks('optional')">Optional</button>
              <button class="btn btn-secondary" onclick="filterTasks('active')">Active</button>
              <button class="btn btn-secondary" onclick="filterTasks('completed')">Completed</button>
            </div>
          </div>
          <div class="content-body">
            <div class="pro-tip">
              <strong>ðŸ’¡ Task Management Strategy</strong>
              Prioritize tasks using the Eisenhower Matrix: Urgent & Important (do first), Important but Not Urgent (schedule), Urgent but Not Important (delegate if possible), Neither (eliminate).
            </div>
            
            <!-- Simplified - tasks are already added from dashboard -->
<div style="text-align: center; margin-bottom: var(--spacing-xl); padding: var(--spacing-lg); background: var(--bg); border-radius: var(--radius); border: 1px solid var(--border);">
    <p style="margin-bottom: var(--spacing-md);">Tasks are added from the Dashboard section above.</p>
    <button class="btn btn-primary" onclick="showSection('dashboard')">
        â† Back to Dashboard to Add Tasks
    </button>
</div>
            
            <div class="task-filters" style="display: flex; gap: var(--spacing-sm); margin-bottom: var(--spacing-xl); flex-wrap: wrap;">
              <button class="btn btn-warning" onclick="clearCompletedTasks()">Clear Completed</button>
              <button class="btn btn-secondary" onclick="exportTasks()">Export Tasks</button>
            </div>
            
            <ul class="task-list" id="fullTaskList">
              <!-- Full task list will appear here -->
            </ul>
            
            <div class="task-stats" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: var(--spacing-lg); margin-top: var(--spacing-xl); padding: var(--spacing-lg); background: var(--bg); border-radius: var(--radius); border: 1px solid var(--border);">
              <div class="stat-display">
                <div class="number" id="totalTasks">0</div>
                <div class="label">Total Tasks</div>
              </div>
              <div class="stat-display">
                <div class="number" id="pendingTasks">0</div>
                <div class="label">Pending</div>
              </div>
              <div class="stat-display">
                <div class="number" id="completedTasks">0</div>
                <div class="label">Completed</div>
              </div>
              <div class="stat-display">
                <div class="number" id="completionRate">0%</div>
                <div class="label">Completion Rate</div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Assignments Section -->
      <div id="assignments" class="dashboard-content" style="grid-column: span 12; display: none;">
        <div class="content-card">
          <div class="content-header">
            <h2>ðŸ“š Assignment Tracker</h2>
            <button class="btn btn-primary" onclick="showAssignmentForm()">âž• Add Assignment</button>
          </div>
          <div class="content-body">
            <!-- Pro Tip -->
            <div class="pro-tip">
              <strong>ðŸ’¡ Assignment Strategy</strong>
              Use backward planning: Start from the due date and work backwards, scheduling research, drafting, editing, and final review stages. This prevents last-minute rushing and improves quality.
            </div>
            
            <!-- Assignment Form -->
            <div id="assignmentForm" style="display: none; margin-bottom: var(--spacing-xl); padding: var(--spacing-lg); background: var(--bg); border-radius: var(--radius); border: 1px solid var(--border);">
              <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: var(--spacing-md); margin-bottom: var(--spacing-lg);">
                <div class="form-group">
                  <label for="assignmentName">Assignment Name</label>
                  <input type="text" id="assignmentName" placeholder="Math Chapter 5">
                </div>
                <div class="form-group">
                  <label for="assignmentSubject">Subject</label>
                  <input type="text" id="assignmentSubject" placeholder="Mathematics">
                </div>
                <div class="form-group">
                  <label for="assignmentDueDate">Due Date</label>
                  <input type="date" id="assignmentDueDate">
                </div>
              </div>
              <div class="form-group">
                <label for="assignmentDescription">Description (Optional)</label>
                <textarea id="assignmentDescription" placeholder="Assignment details, requirements, notes..." rows="3"></textarea>
              </div>
              <div style="display: flex; gap: var(--spacing-sm); flex-wrap: wrap;">
                <button class="btn btn-success" onclick="addAssignment()" style="flex: 1;">âž• Add Assignment</button>
                <button class="btn btn-secondary" onclick="hideAssignmentForm()">Cancel</button>
              </div>
            </div>
            
            <div class="assignment-list" id="fullAssignmentList">
              <!-- Full assignment list will appear here -->
            </div>
          </div>
        </div>
      </div>
      
      <!-- Classroom Section -->
      <div id="classroom" class="dashboard-content" style="grid-column: span 12; display: none;">
        <!-- Not in Class View -->
        <div id="notInClassView" class="content-card" style="text-align: center; padding: var(--spacing-2xl);">
          <div class="empty-state">
            <div class="empty-state-icon">ðŸ«</div>
            <div class="empty-state-title">Not in a Classroom</div>
            <div class="empty-state-description" style="margin-bottom: var(--spacing-lg);">
              Join your teacher's classroom to access announcements, resources, and track your progress together.
            </div>
            <div class="pro-tip" style="margin: var(--spacing-lg) 0; max-width: 500px;">
              <strong>ðŸ’¡ Why Join a Classroom?</strong>
              Classrooms provide structure, access to teacher resources, peer motivation through leaderboards, and organized announcements. Students in classrooms show 30% higher engagement.
            </div>
            <button class="btn btn-primary" onclick="showSection('myclasses')" style="padding: 1rem 2rem; font-size: 1.125rem;">
              ðŸŽ“ Join a Classroom
            </button>
            <p style="margin-top: var(--spacing-lg); color: var(--text-muted);">
              Ask your teacher for the class code!
            </p>
          </div>
        </div>
        
        <!-- In Class View -->
        <div id="inClassView" style="display: none;">
          <!-- Class Header -->
          <div class="content-card">
            <div class="class-code-display">
              <div style="font-size: 1rem; opacity: 0.9; letter-spacing: 1px; position: relative; z-index: 1;">CLASS CODE</div>
              <div class="code" id="currentClassCode">LOADING...</div>
              <div style="display: flex; gap: var(--spacing-md); justify-content: center; margin-top: var(--spacing-lg); flex-wrap: wrap; position: relative; z-index: 1;">
                <button class="btn btn-secondary" onclick="copyClassCode()">ðŸ“‹ Copy Code</button>
                <button class="btn btn-danger" onclick="leaveClass()">ðŸšª Leave Class</button>
                <button class="btn btn-success" onclick="refreshClassroom()">ðŸ”„ Refresh</button>
              </div>
            </div>
          </div>
          
          <!-- Pro Tip -->
          <div class="pro-tip">
            <strong>ðŸ’¡ Active Classroom Participation</strong>
            Regularly check announcements and resources. Engage with the leaderboard - healthy competition increases motivation. Students who actively participate in classrooms complete 40% more assignments.
          </div>
          
          <!-- Announcements -->
          <div class="content-card">
            <div class="content-header">
              <h2>ðŸ“¢ Teacher's Announcements</h2>
              <span class="badge" id="announcementCount" style="background: var(--accent); color: white; padding: 0.25rem 0.75rem; border-radius: 1rem; font-size: 0.875rem;">0</span>
            </div>
            <div class="content-body">
              <div id="teacherAnnouncements" style="min-height: 200px;">
                <div class="loading">Loading announcements...</div>
              </div>
            </div>
          </div>
          
          <!-- Resources -->
          <div class="content-card">
            <div class="content-header">
              <h2>ðŸ“š Learning Resources</h2>
              <span class="badge" id="resourceCount" style="background: var(--success); color: white; padding: 0.25rem 0.75rem; border-radius: 1rem; font-size: 0.875rem;">0</span>
            </div>
            <div class="content-body">
              <div id="teacherResources" style="min-height: 200px;">
                <div class="loading">Loading resources...</div>
              </div>
            </div>
          </div>
          
          <!-- Leaderboard -->
          <div class="content-card">
            <div class="content-header">
              <h2>ðŸ† Class Leaderboard</h2>
              <button class="btn btn-secondary" onclick="refreshLeaderboard()">ðŸ”„ Refresh</button>
            </div>
            <div class="content-body">
              <div class="leaderboard-container" id="classLeaderboard">
                <div class="loading">Loading leaderboard...</div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- My Classes Section -->
      <div id="myclasses" class="dashboard-content" style="grid-column: span 12; display: none;">
        <div class="content-card">
          <div class="content-header">
            <h2>ðŸŽ“ My Classes</h2>
            <button class="btn btn-primary" onclick="showJoinClassForm()">âž• Join Class</button>
          </div>
          <div class="content-body">
            <!-- Pro Tip -->
            <div class="pro-tip">
              <strong>ðŸ’¡ Multiple Classes Strategy</strong>
              Join relevant classes for different subjects. Organize your study time by dedicating specific days to each class. Students in 2-3 balanced classes show the best performance outcomes.
            </div>
            
            <!-- Join Class Form -->
            <div id="joinClassForm" style="display: none; margin-bottom: var(--spacing-xl); padding: var(--spacing-lg); background: var(--bg); border-radius: var(--radius); border: 1px solid var(--border);">
              <h3 style="margin-bottom: var(--spacing-lg);">Join a New Class</h3>
              <div class="form-group">
                <label for="joinClassCode">Class Code</label>
                <input type="text" id="joinClassCode" placeholder="Enter 6-digit class code" maxlength="6" style="text-transform: uppercase; font-family: 'Courier New', monospace; letter-spacing: 0.5rem; font-size: 1.5rem; text-align: center;">
              </div>
              <div style="display: flex; gap: var(--spacing-sm); flex-wrap: wrap;">
                <button class="btn btn-success" onclick="joinClass()" style="flex: 1;">ðŸŽ“ Join Class</button>
                <button class="btn btn-secondary" onclick="hideJoinClassForm()">Cancel</button>
              </div>
            </div>
            
            <div class="classes-grid" id="classesList">
              <!-- Classes will appear here -->
            </div>
            
            <div id="noClassesMessage" class="empty-state" style="display: none;">
              <div class="empty-state-icon">ðŸ«</div>
              <div class="empty-state-title">No Classes Yet</div>
              <div class="empty-state-description">
                Join your first classroom to start tracking your progress with classmates!
              </div>
              <button class="btn btn-primary" onclick="showJoinClassForm()" style="margin-top: var(--spacing-lg);">
                ðŸŽ“ Join Your First Class
              </button>
            </div>
          </div>
        </div>
      </div>
      
      <!-- UPDATED: Enhanced Statistics Section -->
      <div id="statistics" class="dashboard-content" style="grid-column: span 12; display: none;">
        <div class="statistics-grid">
          <!-- Statistics Header -->
          <div class="statistics-header">
            <h2>ðŸ“ˆ Learning Statistics</h2>
            <div class="statistics-subtitle">Visualize your progress with detailed charts and insights</div>
            <div class="stats-controls">
              <button class="btn btn-primary" onclick="refreshCharts()">
                ðŸ”„ Refresh Charts
              </button>
              <button class="btn btn-secondary" onclick="exportStatistics()">
                ðŸ“¥ Export Stats
              </button>
              <button class="btn btn-success" onclick="markStudySession()">
                ðŸ“ Mark Study Session
              </button>
            </div>
          </div>
          
          <!-- Pro Tip -->
          <div class="pro-tip" style="grid-column: span 12;">
            <strong>ðŸ’¡ Data-Driven Learning</strong>
            Review your statistics weekly to identify patterns. Track what study methods work best for you and adjust accordingly. Students who review their data improve 25% faster than those who don't.
          </div>
          
          <!-- Overview Cards -->
          <div class="stats-overview-cards">
            <div class="stats-overview-card">
              <div class="stats-overview-icon">ðŸ”¥</div>
              <div class="stats-overview-number" id="overviewStreak">0</div>
              <div class="stats-overview-label">Study Streak</div>
              <div class="stats-overview-trend neutral" id="streakTrend">
                <span>âž¡ï¸</span>
                <span>Maintain daily study</span>
              </div>
            </div>
            <div class="stats-overview-card">
              <div class="stats-overview-icon">â°</div>
              <div class="stats-overview-number" id="overviewHours">0</div>
              <div class="stats-overview-label">Study Hours</div>
              <div class="stats-overview-trend neutral" id="hoursTrend">
                <span>âž¡ï¸</span>
                <span>Track your sessions</span>
              </div>
            </div>
            <div class="stats-overview-card">
              <div class="stats-overview-icon">âœ…</div>
              <div class="stats-overview-number" id="overviewTasks">0</div>
              <div class="stats-overview-label">Tasks Completed</div>
              <div class="stats-overview-trend neutral" id="tasksTrend">
                <span>âž¡ï¸</span>
                <span>Complete more tasks</span>
              </div>
            </div>
            <div class="stats-overview-card">
              <div class="stats-overview-icon">ðŸŽ¯</div>
              <div class="stats-overview-number" id="overviewFocus">0%</div>
              <div class="stats-overview-label">Focus Score</div>
              <div class="stats-overview-trend neutral" id="focusTrend">
                <span>âž¡ï¸</span>
                <span>Improve consistency</span>
              </div>
            </div>
          </div>
          
          <!-- Performance Metrics -->
          <div class="performance-metrics">
            <h3>ðŸ“Š Performance Metrics</h3>
            <div class="metrics-grid">
              <div class="metric-card">
                <div class="metric-icon">ðŸ“…</div>
                <div class="metric-value" id="metricSessions">0</div>
                <div class="metric-label">Study Sessions</div>
                <div class="metric-details">This week</div>
              </div>
              <div class="metric-card">
                <div class="metric-icon">âš¡</div>
                <div class="metric-value" id="metricAvgHours">0h</div>
                <div class="metric-label">Avg. Daily Hours</div>
                <div class="metric-details">Based on last 7 days</div>
              </div>
              <div class="metric-card">
                <div class="metric-icon">ðŸ†</div>
                <div class="metric-value" id="metricLongestStreak">0</div>
                <div class="metric-label">Longest Streak</div>
                <div class="metric-details">All-time record</div>
              </div>
              <div class="metric-card">
                <div class="metric-icon">ðŸ“ˆ</div>
                <div class="metric-value" id="metricConsistency">0%</div>
                <div class="metric-label">Consistency</div>
                <div class="metric-details">Study regularity</div>
              </div>
            </div>
          </div>
          
          <!-- Charts Section -->
          <div class="charts-container">
            <!-- Study Hours Chart -->
            <div class="chart-card">
              <div class="chart-header">
                <h3>â° Study Hours Distribution</h3>
                <div class="chart-description">Daily study hours over the past week</div>
              </div>
              <div class="chart-wrapper">
                <canvas id="hoursChart"></canvas>
              </div>
              <div class="chart-legend" id="hoursLegend"></div>
            </div>
            
            <!-- Focus Score Chart -->
            <div class="chart-card">
              <div class="chart-header">
                <h3>ðŸŽ¯ Daily Focus Score</h3>
                <div class="chart-description">Daily focus scores based on consistency</div>
              </div>
              <div class="chart-wrapper">
                <canvas id="focusChart"></canvas>
              </div>
              <div class="chart-legend" id="focusLegend"></div>
            </div>
            
            <!-- Task Completion Chart -->
            <div class="chart-card">
              <div class="chart-header">
                <h3>âœ… Task Completion</h3>
                <div class="chart-description">Task completion rate and progress</div>
              </div>
              <div class="chart-wrapper">
                <canvas id="tasksChart"></canvas>
              </div>
              <div class="chart-legend" id="tasksLegend"></div>
            </div>
            
            <!-- Weekly Pattern Chart -->
            <div class="chart-card">
              <div class="chart-header">
                <h3>ðŸ“… Weekly Study Pattern</h3>
                <div class="chart-description">Study distribution across days of the week</div>
              </div>
              <div class="chart-wrapper">
                <canvas id="weeklyChart"></canvas>
              </div>
              <div class="chart-legend" id="weeklyLegend"></div>
            </div>
            
            <!-- Assignment Status Chart -->
            <div class="chart-card">
              <div class="chart-header">
                <h3>ðŸ“š Assignment Status</h3>
                <div class="chart-description">Current assignment completion status</div>
              </div>
              <div class="chart-wrapper">
                <canvas id="assignmentsChart"></canvas>
              </div>
              <div class="chart-legend" id="assignmentsLegend"></div>
            </div>
            
            <!-- Streak History Chart -->
            <div class="chart-card">
              <div class="chart-header">
                <h3>ðŸ”¥ Streak History</h3>
                <div class="chart-description">Daily streak progression over time</div>
              </div>
              <div class="chart-wrapper">
                <canvas id="streakChart"></canvas>
              </div>
              <div class="chart-legend" id="streakLegend"></div>
            </div>
          </div>
          
          <!-- Detailed Statistics -->
          <div class="stats-detailed-container">
            <h3>ðŸ“‹ Detailed Performance Analysis</h3>
            <div class="stats-detailed-grid">
              <div class="stats-detailed-section">
                <h4>Productivity Metrics</h4>
                <div class="stats-detailed-row">
                  <span class="stats-detailed-label">Total Study Hours</span>
                  <span class="stats-detailed-value" id="detailTotalHours">0</span>
                </div>
                <div class="stats-detailed-row">
                  <span class="stats-detailed-label">Study Sessions</span>
                  <span class="stats-detailed-value" id="detailTotalSessions">0</span>
                </div>
                <div class="stats-detailed-row">
                  <span class="stats-detailed-label">Avg. Session Length</span>
                  <span class="stats-detailed-value" id="detailAvgSession">0h</span>
                </div>
                <div class="stats-detailed-row">
                  <span class="stats-detailed-label">Longest Session</span>
                  <span class="stats-detailed-value" id="detailLongestSession">0h</span>
                </div>
              </div>
              
              <div class="stats-detailed-section">
                <h4>Task Metrics</h4>
                <div class="stats-detailed-row">
                  <span class="stats-detailed-label">Total Tasks</span>
                  <span class="stats-detailed-value" id="detailTotalTasks">0</span>
                </div>
                <div class="stats-detailed-row">
                  <span class="stats-detailed-label">Completed Tasks</span>
                  <span class="stats-detailed-value" id="detailCompletedTasks">0</span>
                </div>
                <div class="stats-detailed-row">
                  <span class="stats-detailed-label">Completion Rate</span>
                  <span class="stats-detailed-value" id="detailCompletionRate">0%</span>
                </div>
                <div class="stats-detailed-row">
                  <span class="stats-detailed-label">Active Tasks</span>
                  <span class="stats-detailed-value" id="detailActiveTasks">0</span>
                </div>
              </div>
              
              <div class="stats-detailed-section">
                <h4>Achievement Metrics</h4>
                <div class="stats-detailed-row">
                  <span class="stats-detailed-label">Current Streak</span>
                  <span class="stats-detailed-value" id="detailCurrentStreak">0</span>
                </div>
                <div class="stats-detailed-row">
                  <span class="stats-detailed-label">Longest Streak</span>
                  <span class="stats-detailed-value" id="detailLongestStreak">0</span>
                </div>
                <div class="stats-detailed-row">
                  <span class="stats-detailed-label">Focus Score</span>
                  <span class="stats-detailed-value" id="detailFocusScore">0%</span>
                </div>
                <div class="stats-detailed-row">
                  <span class="stats-detailed-label">Consistency Score</span>
                  <span class="stats-detailed-value" id="detailConsistencyScore">0%</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Tools Section -->
      <div id="tools" class="dashboard-content" style="grid-column: span 12; display: none;">
        <div class="content-card">
          <div class="content-header">
            <h2>ðŸ› ï¸ Study Tools</h2>
          </div>
          <div class="content-body">
            <!-- Pro Tip -->
            <div class="pro-tip">
              <strong>ðŸ’¡ Tool Integration</strong>
              Combine different tools for maximum effectiveness. Use Pomodoro timer for focus, flashcards for memorization, and habit tracker for consistency. Integrated tool users show 35% better results.
            </div>
            
            <div class="tools-grid">
              <div class="tool-item" onclick="window.open('https://mairakhancontact-sudo.github.io/javascript-projects/ai-tic-tac-toe.html', '_blank')">
                <div class="tool-icon">ðŸŽ®</div>
                <div class="tool-name">AI Tic Tac Toe</div>
                <div class="tool-desc">Challenge AI in this classic game</div>
              </div>
              
              <div class="tool-item" onclick="window.open('https://mairakhancontact-sudo.github.io/javascript-projects/countdown-timer.html', '_blank')">
                <div class="tool-icon">â³</div>
                <div class="tool-name">Countdown Timer</div>
                <div class="tool-desc">Track study sessions and breaks</div>
              </div>
              
              <div class="tool-item" onclick="window.open('https://mairakhancontact-sudo.github.io/javascript-projects/habit-tracker.html', '_blank')">
                <div class="tool-icon">ðŸ“Š</div>
                <div class="tool-name">Habit Tracker</div>
                <div class="tool-desc">Build and maintain good habits</div>
              </div>
              
              <div class="tool-item" onclick="window.open('https://mairakhancontact-sudo.github.io/javascript-projects/todolist.html', '_blank')">
                <div class="tool-icon">ðŸ“</div>
                <div class="tool-name">To-Do List</div>
                <div class="tool-desc">Advanced task management</div>
              </div>
              
              <div class="tool-item" onclick="window.open('https://mairakhancontact-sudo.github.io/javascript-projects/notesapp.html', '_blank')">
                <div class="tool-icon">ðŸ“’</div>
                <div class="tool-name">Notes App</div>
                <div class="tool-desc">Take organized notes</div>
              </div>
              
              <div class="tool-item" onclick="window.open('https://mairakhancontact-sudo.github.io/javascript-projects/numberguess.html', '_blank')">
                <div class="tool-icon">ðŸŽ¯</div>
                <div class="tool-name">Number Guess</div>
                <div class="tool-desc">Brain training game</div>
              </div>
              
              <div class="tool-item" onclick="window.open('pomodoro.html', '_blank')">
                <div class="tool-icon">ðŸ…</div>
                <div class="tool-name">Pomodoro Timer</div>
                <div class="tool-desc">Boost productivity with intervals</div>
              </div>
              
              <div class="tool-item" onclick="window.open('flashcard-generator.html', '_blank')">
                <div class="tool-icon">ðŸ“‡</div>
                <div class="tool-name">Flashcards</div>
                <div class="tool-desc">Create and study flashcards</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- AI Help Section -->
      <div id="ai" class="dashboard-content" style="grid-column: span 12; display: none;">
        <div class="content-card">
          <div class="content-header">
            <h2>ðŸ¤– AI Learning Resources</h2>
          </div>
          <div class="content-body">
            <!-- Pro Tip -->
            <div class="pro-tip">
              <strong>ðŸ’¡ AI Learning Strategy</strong>
              Use AI to explain difficult concepts, generate practice questions, or get writing feedback. Combine AI explanations with traditional resources for comprehensive understanding.
            </div>
            
            <div class="tools-grid">
              <div class="tool-item" onclick="window.open('https://chat.openai.com', '_blank')">
                <div class="tool-icon">ðŸ’¬</div>
                <div class="tool-name">ChatGPT</div>
                <div class="tool-desc">AI assistant for learning and research</div>
              </div>
              
              <div class="tool-item" onclick="window.open('https://gemini.google.com', '_blank')">
                <div class="tool-icon">ðŸ”®</div>
                <div class="tool-name">Google Gemini</div>
                <div class="tool-desc">AI-powered research and answers</div>
              </div>
              
              <div class="tool-item" onclick="window.open('https://www.perplexity.ai', '_blank')">
                <div class="tool-icon">ðŸ”</div>
                <div class="tool-name">Perplexity AI</div>
                <div class="tool-desc">Answer engine with citations</div>
              </div>
              
              <div class="tool-item" onclick="window.open('https://www.khanacademy.org', '_blank')">
                <div class="tool-icon">ðŸŽ“</div>
                <div class="tool-name">Khan Academy</div>
                <div class="tool-desc">Free online courses and lessons</div>
              </div>
              
              <div class="tool-item" onclick="window.open('https://www.coursera.org', '_blank')">
                <div class="tool-icon">ðŸ›ï¸</div>
                <div class="tool-name">Coursera</div>
                <div class="tool-desc">University courses and certificates</div>
              </div>
              
              <div class="tool-item" onclick="window.open('https://www.youtube.com', '_blank')">
                <div class="tool-icon">ðŸ“º</div>
                <div class="tool-name">YouTube</div>
                <div class="tool-desc">Educational videos and tutorials</div>
              </div>
              
              <div class="tool-item" onclick="window.open('https://quizlet.com', '_blank')">
                <div class="tool-icon">ðŸ§ </div>
                <div class="tool-name">Quizlet</div>
                <div class="tool-desc">Study tools and flashcards</div>
              </div>
              
              <div class="tool-item" onclick="window.open('https://duolingo.com', '_blank')">
                <div class="tool-icon">ðŸ¦‰</div>
                <div class="tool-name">Duolingo</div>
                <div class="tool-desc">Language learning made fun</div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Profile Section -->
      <div id="profile" class="dashboard-content" style="grid-column: span 12; display: none;">
        <div class="content-card">
          <div class="content-header">
            <h2>ðŸ‘¤ Profile Settings</h2>
          </div>
          <div class="content-body">
            <div style="max-width: 600px; margin: 0 auto;">
              <!-- Pro Tip -->
              <div class="pro-tip">
                <strong>ðŸ’¡ Personalized Learning</strong>
                Customize your preferences based on your learning style. Morning person? Schedule study then. Visual learner? Use more diagrams and charts in your notes.
              </div>
              
              <div class="form-group">
                <label for="profileName">Your Name</label>
                <input type="text" id="profileName" placeholder="Enter your name">
              </div>
              <div class="form-group">
                <label for="profileEmail">Email (Optional)</label>
                <input type="email" id="profileEmail" placeholder="your@email.com">
              </div>
              <div class="form-group">
                <label for="profileBio">Bio</label>
                <textarea id="profileBio" placeholder="Tell us about yourself..." rows="4"></textarea>
              </div>
              <div class="form-group">
                <label>Study Preferences</label>
                <div style="display: flex; gap: var(--spacing-md); flex-wrap: wrap; margin-top: var(--spacing-sm);">
                  <label style="display: flex; align-items: center; gap: var(--spacing-xs);">
                    <input type="checkbox" id="prefPomodoro"> Pomodoro Timer
                  </label>
                  <label style="display: flex; align-items: center; gap: var(--spacing-xs);">
                    <input type="checkbox" id="prefReminders"> Study Reminders
                  </label>
                  <label style="display: flex; align-items: center; gap: var(--spacing-xs);">
                    <input type="checkbox" id="prefLeaderboard"> Show Leaderboard
                  </label>
                </div>
              </div>
              <button class="btn-submit" onclick="saveProfileSettings()" style="margin-top: var(--spacing-lg);">
                ðŸ’¾ Save Profile Settings
              </button>
              
              <div style="margin-top: var(--spacing-xl); padding-top: var(--spacing-xl); border-top: 1px solid var(--border);">
                <h3>ðŸ“Š Data Management</h3>
                <div style="display: flex; gap: var(--spacing-md); margin-top: var(--spacing-md); flex-wrap: wrap;">
                  <button class="btn btn-warning" onclick="exportData()">ðŸ“¤ Export All Data</button>
                  <button class="btn btn-danger" onclick="clearAllData()">ðŸ—‘ï¸ Clear All Data</button>
                </div>
                <p style="font-size: 0.875rem; color: var(--text-muted); margin-top: var(--spacing-sm);">
                  Export your data for backup or clear all data to start fresh.
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>
      
    </div>
  </main>
</div>

<script>
// ========== MOBILE MENU FUNCTIONALITY ==========
function toggleMobileMenu() {
    const sidebar = document.getElementById('sidebar');
    const overlay = document.getElementById('mobileOverlay');
    sidebar.classList.toggle('active');
    overlay.classList.toggle('active');
}

function closeMobileMenu() {
    const sidebar = document.getElementById('sidebar');
    const overlay = document.getElementById('mobileOverlay');
    sidebar.classList.remove('active');
    overlay.classList.remove('active');
}

// Add mobile menu toggle listener
document.getElementById('mobileMenuToggle').addEventListener('click', toggleMobileMenu);
document.getElementById('mobileOverlay').addEventListener('click', closeMobileMenu);

// Close menu when clicking outside on mobile
document.addEventListener('click', function(event) {
    const sidebar = document.getElementById('sidebar');
    const toggleBtn = document.getElementById('mobileMenuToggle');
    const overlay = document.getElementById('mobileOverlay');
    
    if (window.innerWidth <= 991 && 
        !sidebar.contains(event.target) && 
        !toggleBtn.contains(event.target) && 
        sidebar.classList.contains('active')) {
        closeMobileMenu();
    }
});

// Close menu on escape key
document.addEventListener('keydown', function(event) {
    if (event.key === 'Escape') {
        closeMobileMenu();
    }
});

// ========== FIREBASE CONFIGURATION ==========
const firebaseConfig = {
    apiKey: "AIzaSyBAIPxgXPZmGdPvB98TLFRfTAClgXWEIM0",
    authDomain: "student-teacher-app-4e7c9.firebaseapp.com",
    databaseURL: "https://student-teacher-app-4e7c9-default-rtdb.firebaseio.com",
    projectId: "student-teacher-app-4e7c9",
    storageBucket: "student-teacher-app-4e7c9.firebasestorage.app",
    messagingSenderId: "737621420458",
    appId: "1:737621420458:web:74c873869a1a47c2ce23d3"
};

// ========== GLOBAL VARIABLES ==========
let currentUser = null;
let currentUserId = null;
let currentUserName = "Student";
let database = null;
let auth = null;
let userClasses = [];
let currentClassCode = null;
let selectedClassIndex = 0;

// Initialize with proper default values to prevent undefined errors
let studyData = {
    streak: 0,
    lastStudyDate: "",
    totalMinutes: 0,
    totalStudyDays: 0,
    totalStudyHours: 0,
    studySessions: [],
    weeklyPattern: [0, 0, 0, 0, 0, 0, 0],
    streakHistory: [],
    streakMilestones: [3, 7, 14, 30, 60, 90],
    currentMilestone: 0,
    dailyStats: [],
    focusScores: [],
    consistencyScores: []
};

let tasks = [];
let assignments = [];
let currentTaskFilter = 'all';
let currentSection = 'dashboard';
let selectedPriority = 'urgent';

// Chart instances
let hoursChart = null;
let tasksChart = null;
let weeklyChart = null;
let assignmentsChart = null;
let streakChart = null;
let focusChart = null;

// Chart auto-refresh interval
let chartRefreshInterval = null;

// ========== INSPIRING QUOTES DATABASE ==========
const inspiringQuotes = [
    { text: "Education is the most powerful weapon which you can use to change the world.", author: "Nelson Mandela" },
    { text: "The beautiful thing about learning is that no one can take it away from you.", author: "B.B. King" },
    { text: "Don't let what you cannot do interfere with what you can do.", author: "John Wooden" },
    { text: "The more that you read, the more things you will know. The more that you learn, the more places you'll go.", author: "Dr. Seuss" },
    { text: "The capacity to learn is a gift; the ability to learn is a skill; the willingness to learn is a choice.", author: "Brian Herbert" },
    { text: "Knowledge is power. Information is liberating. Education is the premise of progress, in every society, in every family.", author: "Kofi Annan" },
    { text: "The roots of education are bitter, but the fruit is sweet.", author: "Aristotle" },
    { text: "Education is not preparation for life; education is life itself.", author: "John Dewey" },
    { text: "The mind is not a vessel to be filled, but a fire to be kindled.", author: "Plutarch" },
    { text: "Live as if you were to die tomorrow. Learn as if you were to live forever.", author: "Mahatma Gandhi" },
    { text: "You don't have to be great to start, but you have to start to be great.", author: "Zig Ziglar" },
    { text: "The only person who is educated is the one who has learned how to learn and change.", author: "Carl Rogers" },
    { text: "Education is the key to unlocking the world, a passport to freedom.", author: "Oprah Winfrey" },
    { text: "Learning is a treasure that will follow its owner everywhere.", author: "Chinese Proverb" },
    { text: "The expert in anything was once a beginner.", author: "Helen Hayes" },
    { text: "Success is not the key to happiness. Happiness is the key to success. If you love what you are doing, you will be successful.", author: "Albert Schweitzer" },
    { text: "The future belongs to those who believe in the beauty of their dreams.", author: "Eleanor Roosevelt" },
    { text: "What lies behind us and what lies before us are tiny matters compared to what lies within us.", author: "Ralph Waldo Emerson" },
    { text: "You are never too old to set another goal or to dream a new dream.", author: "C.S. Lewis" },
    { text: "Believe you can and you're halfway there.", author: "Theodore Roosevelt" },
    { text: "The only way to do great work is to love what you do.", author: "Steve Jobs" },
    { text: "Don't watch the clock; do what it does. Keep going.", author: "Sam Levenson" },
    { text: "Success is not final, failure is not fatal: it is the courage to continue that counts.", author: "Winston Churchill" },
    { text: "The future depends on what you do today.", author: "Mahatma Gandhi" },
    { text: "You miss 100% of the shots you don't take.", author: "Wayne Gretzky" },
    { text: "It does not matter how slowly you go as long as you do not stop.", author: "Confucius" },
    { text: "The secret of getting ahead is getting started.", author: "Mark Twain" },
    { text: "Optimism is the faith that leads to achievement. Nothing can be done without hope and confidence.", author: "Helen Keller" },
    { text: "Your time is limited, don't waste it living someone else's life.", author: "Steve Jobs" },
    { text: "The only limit to our realization of tomorrow will be our doubts of today.", author: "Franklin D. Roosevelt" },
    { text: "Start where you are. Use what you have. Do what you can.", author: "Arthur Ashe" },
    { text: "I can't change the direction of the wind, but I can adjust my sails to always reach my destination.", author: "Jimmy Dean" },
    { text: "You are braver than you believe, stronger than you seem, and smarter than you think.", author: "A.A. Milne" },
    { text: "The difference between a successful person and others is not a lack of strength, not a lack of knowledge, but rather a lack in will.", author: "Vince Lombardi" },
    { text: "The harder I work, the more luck I seem to have.", author: "Thomas Jefferson" },
    { text: "Don't be pushed around by the fears in your mind. Be led by the dreams in your heart.", author: "Roy T. Bennett" },
    { text: "Strength doesn't come from what you can do. It comes from overcoming the things you once thought you couldn't.", author: "Rikki Rogers" },
    { text: "Every accomplishment starts with the decision to try.", author: "John F. Kennedy" },
    { text: "You don't have to see the whole staircase, just take the first step.", author: "Martin Luther King Jr." },
    { text: "The only thing standing between you and your goal is the story you keep telling yourself as to why you can't achieve it.", author: "Jordan Belfort" },
    { text: "Small daily improvements are the key to staggering long-term results.", author: "Darren Hardy" },
    { text: "The journey of a thousand miles begins with one step.", author: "Lao Tzu" },
    { text: "What you get by achieving your goals is not as important as what you become by achieving your goals.", author: "Zig Ziglar" },
    { text: "Your potential is endless. Go do what you were created to do.", author: "Unknown" },
    { text: "The moment you give up is the moment you let someone else win.", author: "Kobe Bryant" },
    { text: "Challenges are what make life interesting and overcoming them is what makes life meaningful.", author: "Joshua J. Marine" },
    { text: "Don't limit your challenges. Challenge your limits.", author: "Unknown" },
    { text: "The pain of discipline weighs ounces, the pain of regret weighs tons.", author: "Jim Rohn" },
    { text: "Success is stumbling from failure to failure with no loss of enthusiasm.", author: "Winston Churchill" },
    { text: "You are never too old to set another goal or to dream a new dream.", author: "C.S. Lewis" }
];

// ========== INSPIRING STORIES DATABASE ==========
const inspiringStories = [
    {
        id: 1,
        name: "Albert Einstein",
        icon: "ðŸ§ ",
        quote: "Imagination is more important than knowledge.",
        story: "Albert Einstein, one of the greatest physicists of all time, faced numerous struggles in his early life. He didn't speak until he was four years old and was considered a slow learner by his teachers. He failed his first entrance exam to the Swiss Federal Polytechnic School. Despite these early challenges, Einstein's curiosity and persistence led him to develop the theory of relativity, which revolutionized our understanding of space, time, and gravity. He was awarded the Nobel Prize in Physics in 1921.",
        struggles: [
            "Late development in speech and learning",
            "Failed university entrance exam",
            "Worked as a patent clerk while developing groundbreaking theories",
            "Faced skepticism from the scientific community"
        ],
        lessons: "Never give up on your curiosity. What others see as weaknesses might be your greatest strengths."
    },
    {
        id: 2,
        name: "Oprah Winfrey",
        icon: "ðŸŽ¤",
        quote: "Turn your wounds into wisdom.",
        story: "Oprah Winfrey overcame a childhood of poverty and abuse to become one of the most influential media personalities in the world. Born into poverty in rural Mississippi, she was molested by relatives and became pregnant at 14 (the child died in infancy). Despite these traumatic experiences, she excelled in school and won a scholarship to Tennessee State University. Her breakthrough came when she moved to Chicago to host a morning talk show, which eventually became 'The Oprah Winfrey Show' - the highest-rated talk show in American history.",
        struggles: [
            "Poverty and childhood abuse",
            "Teen pregnancy and loss of child",
            "Racial and gender discrimination",
            "Battled with weight and self-esteem issues"
        ],
        lessons: "Your past doesn't define your future. Use your experiences to empower yourself and others."
    },
    {
        id: 3,
        name: "Stephen Hawking",
        icon: "ðŸŒŒ",
        quote: "However difficult life may seem, there is always something you can do and succeed at.",
        story: "Stephen Hawking was diagnosed with ALS (amyotrophic lateral sclerosis) at age 21 and given just two years to live. Despite being confined to a wheelchair and losing his ability to speak, he became one of the most brilliant theoretical physicists of our time. Using a speech-generating device, he continued his research on black holes and the origins of the universe. His book 'A Brief History of Time' sold over 25 million copies worldwide, making complex scientific concepts accessible to the general public.",
        struggles: [
            "Diagnosed with ALS at 21",
            "Gradual loss of mobility and speech",
            "Confined to wheelchair for most of his life",
            "Medical complications including pneumonia"
        ],
        lessons: "Physical limitations cannot constrain the human mind. Focus on what you can do, not what you can't."
    },
    {
        id: 4,
        name: "J.K. Rowling",
        icon: "âœï¸",
        quote: "Rock bottom became the solid foundation on which I rebuilt my life.",
        story: "Before publishing Harry Potter, J.K. Rowling was a single mother living on welfare in Edinburgh, Scotland. She wrote the first Harry Potter book in cafes while her baby daughter slept. The manuscript was rejected by 12 publishers before Bloomsbury accepted it. Today, the Harry Potter series has sold over 500 million copies worldwide, making Rowling one of the most successful authors in history. She went from being on government assistance to becoming a billionaire (though she has since donated much of her wealth to charity).",
        struggles: [
            "Single mother living on welfare",
            "Clinical depression and suicidal thoughts",
            "12 publishers rejected Harry Potter",
            "Struggled with poverty for years"
        ],
        lessons: "Failure is not permanent. Persistence can turn your biggest dreams into reality."
    },
    {
        id: 5,
        name: "Thomas Edison",
        icon: "ðŸ’¡",
        quote: "I have not failed. I've just found 10,000 ways that won't work.",
        story: "Thomas Edison, one of America's greatest inventors, was told by his teachers that he was 'too stupid to learn anything.' He was fired from his first two jobs for being 'non-productive.' Despite these setbacks, he went on to hold 1,093 patents, including the phonograph, the motion picture camera, and perhaps most famously, the practical electric light bulb. His invention of the light bulb required thousands of experiments with different materials before finding one that worked.",
        struggles: [
            "Teachers said he was 'too stupid to learn'",
            "Fired from early jobs",
            "Thousands of failed experiments",
            "Lost his hearing as a child"
        ],
        lessons: "Persistence and learning from failure are keys to innovation and success."
    },
    {
        id: 6,
        name: "Malala Yousafzai",
        icon: "ðŸ“š",
        quote: "One child, one teacher, one book, one pen can change the world.",
        story: "Malala Yousafzai was shot in the head by the Taliban at age 15 for advocating for girls' education in Pakistan. She survived the attack and continued her activism, becoming the youngest-ever Nobel Prize laurete at age 17. Her recovery involved multiple surgeries and rehabilitation in the UK. Today, she continues to fight for education rights through the Malala Fund, which supports education programs around the world.",
        struggles: [
            "Shot by Taliban at age 15",
            "Faced death threats for advocating education",
            "Multiple surgeries and long recovery",
            "Forced to leave her home country"
        ],
        lessons: "Courage means standing up for what you believe in, even in the face of extreme danger."
    },
    {
        id: 7,
        name: "Walt Disney",
        icon: "ðŸ°",
        quote: "All our dreams can come true if we have the courage to pursue them.",
        story: "Walt Disney was fired from a newspaper for 'lacking imagination' and 'having no good ideas.' His first animation company went bankrupt. He was turned down 302 times before getting financing for Disney World. Despite these failures, he created Mickey Mouse and built the Disney empire, which has brought joy to millions of people worldwide. His theme parks and films continue to be beloved by generations.",
        struggles: [
            "Fired from newspaper for 'no imagination'",
            "First animation company bankrupt",
            "302 rejections for Disney World financing",
            "Struggled with financial problems"
        ],
        lessons: "Believe in your vision even when others don't. Persistence can create magic."
    },
    {
        id: 8,
        name: "Bethany Hamilton",
        icon: "ðŸ„â€â™€ï¸",
        quote: "Courage doesn't mean you don't get afraid. Courage means you don't let fear stop you.",
        story: "At age 13, professional surfer Bethany Hamilton lost her left arm to a shark attack. Just one month after the attack, she returned to surfing. She went on to win her first national surfing title two years later and became a professional surfer. Her story was made into the movie 'Soul Surfer.' She continues to surf competitively and inspires people worldwide with her determination.",
        struggles: [
            "Lost arm in shark attack at 13",
            "Learned to surf with one arm",
            "Faced physical and emotional challenges",
            "Overcame fear of returning to ocean"
        ],
        lessons: "Life's challenges can become opportunities for growth and inspiration."
    }
];

// ========== DATA PERSISTENCE HELPER ==========
function persistData() {
    try {
        const dataToSave = {
            version: "2.5", // Updated version
            lastSaved: new Date().toISOString(),
            userId: currentUserId,
            userName: currentUserName,
            studyData: studyData,
            tasks: tasks,
            assignments: assignments,
            userClasses: userClasses,
            currentClassCode: currentClassCode,
            selectedClassIndex: selectedClassIndex,
            currentSection: currentSection
        };
        
        // Clean up any undefined arrays before saving
        if (!studyData.studySessions) studyData.studySessions = [];
        if (!studyData.dailyStats) studyData.dailyStats = [];
        if (!studyData.focusScores) studyData.focusScores = [];
        if (!studyData.consistencyScores) studyData.consistencyScores = [];
        
        localStorage.setItem('studentPersistentData', JSON.stringify(dataToSave));
        console.log("ðŸ’¾ Data persisted to localStorage");
    } catch (e) {
        console.error("Error persisting data:", e);
    }
}

function loadPersistedData() {
    try {
        const savedData = localStorage.getItem('studentPersistentData');
        if (savedData) {
            const data = JSON.parse(savedData);
            
            // Check version compatibility
            if (data.version && (data.version === "2.5" || data.version === "2.4" || data.version === "2.3" || data.version === "2.2" || data.version === "2.1" || data.version === "2.0")) {
                console.log("ðŸ“‚ Loading persisted data version:", data.version);
                
                // Load study data with safety checks
                if (data.studyData) {
                    studyData = data.studyData;
                    // Initialize arrays if they don't exist
                    if (!studyData.studySessions) studyData.studySessions = [];
                    if (!studyData.dailyStats) studyData.dailyStats = [];
                    if (!studyData.focusScores) studyData.focusScores = [];
                    if (!studyData.consistencyScores) studyData.consistencyScores = [];
                    if (!studyData.streakHistory) studyData.streakHistory = [];
                    if (!studyData.weeklyPattern) studyData.weeklyPattern = [0, 0, 0, 0, 0, 0, 0];
                    if (!studyData.streakMilestones) studyData.streakMilestones = [3, 7, 14, 30, 60, 90];
                    
                    console.log("ðŸ“Š Loaded study data:", {
                        streak: studyData.streak,
                        hours: studyData.totalStudyHours,
                        sessions: studyData.studySessions?.length || 0,
                        dailyStats: studyData.dailyStats?.length || 0
                    });
                }
                
                // Load tasks with safety check
                if (data.tasks && Array.isArray(data.tasks)) {
                    tasks = data.tasks;
                    console.log("ðŸ“ Loaded tasks:", tasks.length);
                } else {
                    tasks = [];
                }
                
                // Load assignments with safety check
                if (data.assignments && Array.isArray(data.assignments)) {
                    assignments = data.assignments;
                    console.log("ðŸ“š Loaded assignments:", assignments.length);
                } else {
                    assignments = [];
                }
                
                // Load classes with safety check
                if (data.userClasses && Array.isArray(data.userClasses)) {
                    userClasses = data.userClasses;
                    console.log("ðŸ« Loaded classes:", userClasses.length);
                } else {
                    userClasses = [];
                }
                
                // Load current class
                if (data.currentClassCode) {
                    currentClassCode = data.currentClassCode;
                }
                
                if (data.selectedClassIndex !== undefined) {
                    selectedClassIndex = data.selectedClassIndex;
                }
                
                // Load current section
                if (data.currentSection) {
                    currentSection = data.currentSection;
                }
                
                // Load user info
                if (data.userName) {
                    currentUserName = data.userName;
                }
                
                if (data.userId && data.userId.startsWith('student_')) {
                    currentUserId = data.userId;
                    localStorage.setItem('studentUserId', currentUserId);
                    console.log("ðŸ‘¤ Loaded user ID from persisted data:", currentUserId);
                }
                
                console.log("âœ… Persisted data loaded successfully");
                return true;
            } else {
                console.log("âš ï¸ No compatible version found in persisted data");
            }
        }
    } catch (e) {
        console.error("âŒ Error loading persisted data:", e);
    }
    
    console.log("âš ï¸ No persisted data found, using defaults");
    return false;
}

// ========== FIREBASE DATABASE HELPERS ==========
function getDatabaseRef(path) {
    if (!database) return null;
    return database.ref(path);
}

async function firebaseGet(refPath) {
    if (!database || !currentUser) {
        console.log("âš ï¸ Firebase not available or user not authenticated, using localStorage");
        return null;
    }
    
    try {
        const ref = getDatabaseRef(refPath);
        const snapshot = await ref.once('value');
        return snapshot.exists() ? snapshot.val() : null;
    } catch (error) {
        console.error(`âŒ Firebase get error at ${refPath}:`, error);
        return null;
    }
}

async function firebaseSet(refPath, data) {
    if (!database || !currentUser) {
        console.log("âš ï¸ Firebase not available or user not authenticated, data saved locally only");
        return false;
    }
    
    try {
        const ref = getDatabaseRef(refPath);
        await ref.set(data);
        return true;
    } catch (error) {
        console.error(`âŒ Firebase set error at ${refPath}:`, error);
        return false;
    }
}

async function firebaseUpdate(refPath, data) {
    if (!database || !currentUser) {
        console.log("âš ï¸ Firebase not available or user not authenticated, data saved locally only");
        return false;
    }
    
    try {
        const ref = getDatabaseRef(refPath);
        await ref.update(data);
        return true;
    } catch (error) {
        console.error(`âŒ Firebase update error at ${refPath}:`, error);
        return false;
    }
}

async function firebaseRemove(refPath) {
    if (!database || !currentUser) {
        console.log("âš ï¸ Firebase not available or user not authenticated");
        return false;
    }
    
    try {
        const ref = getDatabaseRef(refPath);
        await ref.remove();
        return true;
    } catch (error) {
        console.error(`âŒ Firebase remove error at ${refPath}:`, error);
        return false;
    }
}

// ========== INITIALIZATION ==========
document.addEventListener('DOMContentLoaded', async function() {
    console.log("ðŸŽ“ Student Mode initializing...");
    
    // FIRST: Load persisted data BEFORE Firebase initialization
    const dataLoaded = loadPersistedData();
    console.log("ðŸ“‚ Data loaded from localStorage:", dataLoaded);
    
    try {
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        database = firebase.database();
        auth = firebase.auth();
        
        console.log("âœ… Firebase initialized successfully");
        
        // Check if we have a user ID from persisted data
        if (!currentUserId) {
            const savedUserId = localStorage.getItem('studentUserId');
            if (savedUserId && savedUserId.startsWith('student_')) {
                currentUserId = savedUserId;
                console.log("ðŸ†” Loaded user ID from localStorage:", currentUserId);
            } else {
                currentUserId = `student_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
                localStorage.setItem('studentUserId', currentUserId);
                console.log("ðŸ†• Generated new persistent user ID:", currentUserId);
            }
        }
        
        // Set user name from persisted data or localStorage
        const savedName = localStorage.getItem('studentName');
        if (savedName) {
            currentUserName = savedName;
        }
        
        console.log("ðŸ‘¤ Current user info:", {
            id: currentUserId,
            name: currentUserName,
            streak: studyData.streak,
            hours: studyData.totalStudyHours
        });
        
        try {
            // Try anonymous authentication
            console.log("ðŸ” Attempting anonymous sign-in...");
            const userCredential = await auth.signInAnonymously();
            currentUser = userCredential.user;
            
            console.log("âœ… Anonymous authentication successful");
            console.log("ðŸ“ Firebase UID:", currentUser.uid);
            console.log("ðŸ“ Our Student ID:", currentUserId);
            
            localStorage.setItem('studentFirebaseUid', currentUser.uid);
            
        } catch (authError) {
            console.error("âŒ Anonymous sign-in failed:", authError);
            console.log("âš ï¸ Using offline mode only");
            showNotification("âš ï¸ Working in offline mode. Data saved locally.", "warning");
        }
        
        // Initialize the app
        initUI();
        loadAllData();
        setupEventListeners();
        setupAutoSave();
        setupChartAutoRefresh();
        
        // Update UI with loaded data
        updateUI();
        updateStreakUI();
        updateAllStatistics();
        
        console.log("ðŸŽ“ Student Mode ready!");
        console.log("ðŸ“Š Loaded data:", {
            streak: studyData.streak,
            hours: studyData.totalStudyHours,
            tasks: tasks.length,
            assignments: assignments.length,
            classes: userClasses.length
        });
        
        setTimeout(() => {
            showNotification(`Welcome back, ${currentUserName}! ðŸ“š Streak: ${studyData.streak} days`, "success");
        }, 1000);
        
    } catch (error) {
        console.error("âŒ Initialization error:", error);
        
        // Fallback: Ensure we have a user ID even if everything fails
        if (!currentUserId) {
            const savedUserId = localStorage.getItem('studentUserId');
            if (savedUserId && savedUserId.startsWith('student_')) {
                currentUserId = savedUserId;
            } else {
                currentUserId = `student_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
                localStorage.setItem('studentUserId', currentUserId);
            }
        }
        
        // Initialize in offline mode
        initUI();
        loadAllData();
        setupEventListeners();
        setupAutoSave();
        setupChartAutoRefresh();
        
        updateUI();
        updateStreakUI();
        updateAllStatistics();
        
        showNotification("âš ï¸ Working in offline mode. Data saved locally.", "warning");
    }
});

// ========== AUTO-SAVE SYSTEM ==========
function setupAutoSave() {
    document.addEventListener('visibilitychange', function() {
        if (document.visibilityState === 'hidden') {
            persistData();
        }
    });
    
    window.addEventListener('beforeunload', function() {
        persistData();
    });
    
    setInterval(persistData, 30000);
    
    console.log("ðŸ’¾ Auto-save system initialized");
}

// ========== CHART AUTO-REFRESH ==========
function setupChartAutoRefresh() {
    if (chartRefreshInterval) {
        clearInterval(chartRefreshInterval);
    }
    
    chartRefreshInterval = setInterval(() => {
        if (currentSection === 'statistics') {
            console.log("ðŸ”„ Auto-refreshing charts...");
            refreshChartsSilently();
        }
    }, 300000);
    
    console.log("ðŸ“ˆ Chart auto-refresh system initialized");
}

function refreshChartsSilently() {
    if (currentSection === 'statistics') {
        updateCharts();
        updateSyncStatus("Charts updated", "success");
    }
}

// ========== USER DATA MANAGEMENT ==========
function loadUserData() {
    const savedUserId = localStorage.getItem('studentUserId');
    if (savedUserId && savedUserId.startsWith('student_')) {
        currentUserId = savedUserId;
    } else if (!currentUserId) {
        currentUserId = `student_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
        localStorage.setItem('studentUserId', currentUserId);
    }
    
    currentUserName = localStorage.getItem('studentName') || 'Student';
    
    const savedClasses = localStorage.getItem('studentUserClasses');
    if (savedClasses) {
        try {
            userClasses = JSON.parse(savedClasses);
            console.log(`ðŸ“š Loaded ${userClasses.length} classes from localStorage`);
            
            if (userClasses.length > 0 && !currentClassCode) {
                currentClassCode = userClasses[0].code;
                selectedClassIndex = 0;
            }
        } catch (e) {
            console.error("Error parsing user classes:", e);
            userClasses = [];
        }
    }
    
    const nameField = document.getElementById('studentName');
    if (nameField) nameField.value = currentUserName;
    
    const profileNameField = document.getElementById('profileName');
    if (profileNameField) profileNameField.value = currentUserName;
}

function saveUserData() {
    if (currentUserId) {
        localStorage.setItem('studentUserId', currentUserId);
    }
    
    if (currentUserName) {
        localStorage.setItem('studentName', currentUserName);
    }
    
    if (userClasses.length > 0) {
        localStorage.setItem('studentUserClasses', JSON.stringify(userClasses));
    }
    
    persistData();
    
    console.log("ðŸ’¾ User data saved:", {
        userId: currentUserId,
        name: currentUserName,
        classesCount: userClasses.length
    });
}

// ========== IMPROVED STREAK SYSTEM ==========
function updateStreakUI() {
    const streakNumber = document.getElementById('streakNumber');
    const streakLabel = document.getElementById('streakLabel');
    const streakProgressFill = document.getElementById('streakProgressFill');
    const streakMilestones = document.getElementById('streakMilestones');
    const nextMilestone = document.getElementById('nextMilestone');
    
    if (!streakNumber) return;
    
    streakNumber.textContent = studyData.streak || 0;
    
    let streakEmoji = "ðŸ“ˆ";
    if (studyData.streak >= 30) streakEmoji = "ðŸ†";
    else if (studyData.streak >= 14) streakEmoji = "ðŸ”¥";
    else if (studyData.streak >= 7) streakEmoji = "âœ¨";
    else if (studyData.streak >= 3) streakEmoji = "â­";
    
    streakLabel.textContent = `${streakEmoji} ${studyData.streak || 0} DAY STREAK`;
    
    let nextMilestoneDay = studyData.streakMilestones.find(milestone => milestone > studyData.streak) || studyData.streakMilestones[studyData.streakMilestones.length - 1];
    let currentMilestoneIndex = studyData.streakMilestones.findIndex(milestone => milestone > studyData.streak) - 1;
    
    if (currentMilestoneIndex < 0) {
        currentMilestoneIndex = studyData.streakMilestones.length - 1;
    }
    
    let progressPercentage = 0;
    if (nextMilestoneDay) {
        progressPercentage = ((studyData.streak || 0) / nextMilestoneDay) * 100;
        if (progressPercentage > 100) progressPercentage = 100;
    }
    streakProgressFill.style.width = `${progressPercentage}%`;
    
    let milestonesHTML = '';
    studyData.streakMilestones.forEach((milestone, index) => {
        const isActive = studyData.streak >= milestone;
        const isCurrent = index === currentMilestoneIndex;
        milestonesHTML += `<div class="milestone ${isActive ? 'active' : ''} ${isCurrent ? 'current' : ''}" title="${milestone} days"></div>`;
    });
    streakMilestones.innerHTML = milestonesHTML;
    
    if (nextMilestoneDay) {
        const daysLeft = nextMilestoneDay - (studyData.streak || 0);
        nextMilestone.textContent = `${nextMilestoneDay} days (${daysLeft} to go)`;
    } else {
        nextMilestone.textContent = "Maximum milestone reached! ðŸŽ‰";
    }
    
    updateStreakButton();
}

function getTodayKey() {
    const today = new Date();
    return today.toDateString();
}

function isConsecutiveDay(lastDateString, currentDateString) {
    if (!lastDateString) return false;
    
    const lastDate = new Date(lastDateString);
    const currentDate = new Date(currentDateString);
    
    const diffTime = Math.abs(currentDate - lastDate);
    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
    
    return diffDays === 1;
}

async function markStudyToday() {
    console.log("ðŸ”¥ markStudyToday() called");
    
    const todayKey = getTodayKey();
    const yesterday = new Date();
    yesterday.setDate(yesterday.getDate() - 1);
    const yesterdayKey = yesterday.toDateString();
    
    if (studyData.lastStudyDate === todayKey) {
        showNotification("You've already marked study for today! Come back tomorrow.", "info");
        updateStreakButton();
        return;
    }
    
    let message = "";
    let messageType = "success";
    
    if (!studyData.lastStudyDate) {
        studyData.streak = 1;
        message = "ðŸŽ‰ First study day! Starting your streak!";
    } else if (studyData.lastStudyDate === yesterdayKey || isConsecutiveDay(studyData.lastStudyDate, todayKey)) {
        studyData.streak = (studyData.streak || 0) + 1;
        message = `ðŸ”¥ Streak continued! Now at ${studyData.streak} days!`;
        
        const milestoneAchieved = studyData.streakMilestones.find(milestone => milestone === studyData.streak);
        if (milestoneAchieved) {
            message = `ðŸ† MILESTONE ACHIEVED! ${milestoneAchieved}-day streak! Keep going!`;
            messageType = "warning";
        }
    } else {
        const lastDate = new Date(studyData.lastStudyDate);
        const today = new Date();
        const diffTime = Math.abs(today - lastDate);
        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
        
        if (diffDays > 1) {
            message = `â° You missed ${diffDays - 1} day(s). Starting new streak.`;
            messageType = "warning";
        } else {
            message = "ðŸ”„ Starting new streak today!";
        }
        studyData.streak = 1;
    }
    
    studyData.lastStudyDate = todayKey;
    studyData.totalStudyDays = (studyData.totalStudyDays || 0) + 1;
    
    if (!studyData.streakHistory) studyData.streakHistory = [];
    studyData.streakHistory.push({
        date: todayKey,
        streak: studyData.streak
    });
    
    const dayOfWeek = new Date().getDay();
    if (!studyData.weeklyPattern) studyData.weeklyPattern = [0, 0, 0, 0, 0, 0, 0];
    studyData.weeklyPattern[dayOfWeek] = (studyData.weeklyPattern[dayOfWeek] || 0) + 1;
    
    // Add a study session
    const sessionHours = 1.0; // Default 1 hour for daily streak
    const focusScore = calculateFocusScore();
    const consistencyScore = calculateConsistencyScore();
    
    if (!studyData.studySessions) studyData.studySessions = [];
    studyData.studySessions.push({
        date: new Date().toISOString(),
        hours: sessionHours,
        baseHours: sessionHours,
        bonusHours: 0,
        streak: studyData.streak
    });
    
    // Update daily stats
    if (!studyData.dailyStats) studyData.dailyStats = [];
    const todayStats = studyData.dailyStats.find(s => s.date === todayKey);
    if (todayStats) {
        todayStats.sessions = (todayStats.sessions || 0) + 1;
        todayStats.hours = (todayStats.hours || 0) + sessionHours;
        todayStats.focusScore = focusScore;
        todayStats.consistencyScore = consistencyScore;
    } else {
        studyData.dailyStats.unshift({
            date: todayKey,
            sessions: 1,
            hours: sessionHours,
            focusScore: focusScore,
            consistencyScore: consistencyScore
        });
        
        if (!studyData.focusScores) studyData.focusScores = [];
        studyData.focusScores.unshift({
            date: todayKey,
            score: focusScore
        });
        
        if (!studyData.consistencyScores) studyData.consistencyScores = [];
        studyData.consistencyScores.unshift({
            date: todayKey,
            score: consistencyScore
        });
        
        // Keep only last 30 days
        if (studyData.dailyStats.length > 30) {
            studyData.dailyStats = studyData.dailyStats.slice(0, 30);
        }
        if (studyData.focusScores.length > 30) {
            studyData.focusScores = studyData.focusScores.slice(0, 30);
        }
        if (studyData.consistencyScores.length > 30) {
            studyData.consistencyScores = studyData.consistencyScores.slice(0, 30);
        }
    }
    
    // Update total hours
    studyData.totalMinutes = (studyData.totalMinutes || 0) + sessionHours * 60;
    studyData.totalStudyHours = (studyData.totalMinutes / 60).toFixed(1);
    
    persistData();
    updateUI();
    updateSidebarStats();
    updateStreakUI();
    updateAllStatistics();
    
    updateSyncStatus("Saving to all classes...", "syncing");
    await saveStudyDataToFirebase();
    
    showNotification(message, messageType);
    
    if (currentSection === 'statistics') {
        updateCharts();
    }
    
    setTimeout(() => {
        updateSyncStatus("Saved successfully!", "success");
    }, 1500);
}

function updateStreakButton() {
    const streakBtn = document.getElementById('streakButton');
    const streakMessage = document.getElementById('streakMessage');
    const lastStudyDate = document.getElementById('lastStudyDate');
    
    if (!streakBtn) return;
    
    const todayKey = getTodayKey();
    
    if (studyData.lastStudyDate === todayKey) {
        streakBtn.disabled = true;
        streakBtn.innerHTML = '<span>âœ… Already Marked Today</span>';
        streakBtn.style.background = 'var(--success)';
        streakBtn.style.opacity = '0.8';
        
        if (streakMessage) {
            streakMessage.textContent = `Come back tomorrow to continue your ${studyData.streak || 0}-day streak!`;
            streakMessage.style.color = 'white';
        }
        
        if (lastStudyDate) {
            lastStudyDate.textContent = studyData.lastStudyDate || 'Never';
        }
    } else {
        streakBtn.disabled = false;
        streakBtn.innerHTML = '<span>ðŸ”¥ Mark Study Today</span>';
        streakBtn.style.background = '';
        streakBtn.style.opacity = '1';
        
        if (streakMessage) {
            if (studyData.streak > 0) {
                streakMessage.textContent = `Current streak: ${studyData.streak} days. Keep it going!`;
            } else {
                streakMessage.textContent = `Start a new study streak today!`;
            }
            streakMessage.style.color = 'white';
        }
        
        if (lastStudyDate) {
            if (studyData.lastStudyDate) {
                lastStudyDate.textContent = studyData.lastStudyDate;
            } else {
                lastStudyDate.textContent = 'Never';
            }
        }
    }
}

// ========== STUDY DATA MANAGEMENT ==========
function loadStudyData() {
    updateUI();
    updateStreakUI();
}

async function saveStudyDataToFirebase() {
    if (!currentUserId || !currentUser) return;
    
    const studentData = {
        name: currentUserName,
        userId: currentUserId,
        firebaseUid: currentUser.uid,
        streak: studyData.streak || 0,
        totalMinutes: studyData.totalMinutes || 0,
        totalStudyHours: (studyData.totalMinutes / 60).toFixed(1),
        points: Math.floor(studyData.totalMinutes / 60) * 100 || 0,
        lastActive: new Date().toISOString(),
        updatedAt: new Date().toISOString(),
        isStudentEntry: true,
        isTeacherAccount: false,
        isSameBrowserIssue: false
    };
    
    console.log(`ðŸ’¾ Saving student data. Student ID: ${currentUserId}, Firebase UID: ${currentUser.uid}`);
    
    for (const classInfo of userClasses) {
        try {
            await firebaseSet(`classes/${classInfo.code}/students/${currentUserId}`, studentData);
            console.log(`âœ… Updated data in class: ${classInfo.code} with student ID: ${currentUserId}`);
            
        } catch (error) {
            console.error(`Error updating class ${classInfo.code}:`, error);
            
            try {
                await firebaseSet(`classStudents/${classInfo.code}/${currentUserId}`, studentData);
                console.log(`âœ… Updated data in classStudents: ${classInfo.code}`);
            } catch (altError) {
                console.error(`Both paths failed for ${classInfo.code}:`, altError);
            }
        }
    }
}

async function addStudyHours() {
    const input = document.getElementById('hoursInput');
    if (!input) {
        showNotification("Study hours input not found", "error");
        return;
    }
    
    const hours = parseFloat(input.value);
    
    if (!hours || hours <= 0) {
        showNotification("Please enter valid study hours (minimum 0.25)", "error");
        return;
    }
    
    const addButton = event.target;
    const originalText = addButton.innerHTML;
    
    addButton.innerHTML = 'â³ Saving...';
    addButton.disabled = true;
    
    const baseHours = hours;
    const streakBonus = (studyData.streak || 0) > 7 ? 0.2 : (studyData.streak || 0) > 3 ? 0.1 : 0;
    const bonusHours = baseHours * streakBonus;
    const totalHours = baseHours + bonusHours;
    
    studyData.totalMinutes = (studyData.totalMinutes || 0) + totalHours * 60;
    studyData.totalStudyHours = (studyData.totalMinutes / 60).toFixed(1);
    
    if (!studyData.studySessions) studyData.studySessions = [];
    studyData.studySessions.push({
        date: new Date().toISOString(),
        hours: totalHours,
        baseHours: baseHours,
        bonusHours: bonusHours,
        streak: studyData.streak || 0
    });
    
    // Update daily stats
    const todayKey = getTodayKey();
    if (!studyData.dailyStats) studyData.dailyStats = [];
    const todayStats = studyData.dailyStats.find(s => s.date === todayKey);
    const focusScore = calculateFocusScore();
    const consistencyScore = calculateConsistencyScore();
    
    if (todayStats) {
        todayStats.sessions = (todayStats.sessions || 0) + 1;
        todayStats.hours = (todayStats.hours || 0) + totalHours;
        todayStats.focusScore = focusScore;
        todayStats.consistencyScore = consistencyScore;
    } else {
        studyData.dailyStats.unshift({
            date: todayKey,
            sessions: 1,
            hours: totalHours,
            focusScore: focusScore,
            consistencyScore: consistencyScore
        });
        
        if (!studyData.focusScores) studyData.focusScores = [];
        studyData.focusScores.unshift({
            date: todayKey,
            score: focusScore
        });
        
        if (!studyData.consistencyScores) studyData.consistencyScores = [];
        studyData.consistencyScores.unshift({
            date: todayKey,
            score: consistencyScore
        });
        
        // Keep only last 30 days
        if (studyData.dailyStats.length > 30) {
            studyData.dailyStats = studyData.dailyStats.slice(0, 30);
        }
        if (studyData.focusScores.length > 30) {
            studyData.focusScores = studyData.focusScores.slice(0, 30);
        }
        if (studyData.consistencyScores.length > 30) {
            studyData.consistencyScores = studyData.consistencyScores.slice(0, 30);
        }
    }
    
    persistData();
    updateUI();
    updateSidebarStats();
    updateAllStatistics();
    input.value = "";
    
    updateSyncStatus("Syncing to all classes...", "syncing");
    await saveStudyDataToFirebase();
    
    setTimeout(() => {
        addButton.innerHTML = originalText;
        addButton.disabled = false;
    }, 1000);
    
    let message = `â° Added ${baseHours.toFixed(1)} study hours!`;
    if (bonusHours > 0) {
        message += ` (+${bonusHours.toFixed(1)} streak bonus)`;
    }
    message += ` Total: ${studyData.totalStudyHours} hours`;
    message += ` | Streak: ${studyData.streak || 0} days ðŸ”¥`;
    
    showNotification(message, "success");
    
    if (currentSection === 'statistics') {
        updateCharts();
    }
    
    setTimeout(() => {
        updateSyncStatus("Saved to all classes!", "success");
    }, 1500);
}

// ========== TASK MANAGEMENT WITH PRIORITIES ==========
function addTask() {
    let taskInput = document.getElementById('taskInput');
    if (!taskInput) taskInput = document.getElementById('taskInputFull');
    
    const text = taskInput.value.trim();
    
    if (!text) {
        showNotification("Please enter a task", "error");
        return;
    }
    
    const task = {
        id: Date.now().toString(),
        text: text,
        completed: false,
        createdAt: new Date().toISOString(),
        priority: selectedPriority,
        completedAt: null
    };
    
    tasks.unshift(task);
    taskInput.value = '';
    
    saveTasks();
    renderTasks();
    renderDashboardTasks();
    updateAllStatistics();
    
    const priorityText = {
        'urgent': 'ðŸ”´ Urgent',
        'not-urgent': 'ðŸŸ¡ Not Urgent',
        'optional': 'âšª Optional'
    }[selectedPriority];
    
    showNotification(`Task added as ${priorityText}!`, "success");
}

function selectPriority(priority) {
    selectedPriority = priority;
    
    document.querySelectorAll('.priority-option').forEach(option => {
        option.classList.remove('active');
        if (option.dataset.priority === priority) {
            option.classList.add('active');
        }
    });
}

function getPriorityClass(priority) {
    switch(priority) {
        case 'urgent': return 'urgent';
        case 'not-urgent': return 'not-urgent';
        case 'optional': return 'optional';
        default: return '';
    }
}

function getPriorityBadge(priority) {
    switch(priority) {
        case 'urgent': return '<span class="priority-badge priority-urgent">ðŸ”´ Urgent</span>';
        case 'not-urgent': return '<span class="priority-badge priority-not-urgent">ðŸŸ¡ Not Urgent</span>';
        case 'optional': return '<span class="priority-badge priority-optional">âšª Optional</span>';
        default: return '';
    }
}

function toggleTask(taskId) {
    const task = tasks.find(t => t.id === taskId);
    if (task) {
        task.completed = !task.completed;
        task.completedAt = task.completed ? new Date().toISOString() : null;
        saveTasks();
        renderTasks();
        renderDashboardTasks();
        updateAllStatistics();
        
        if (task.completed) {
            showNotification("Task completed! âœ…", "success");
        }
    }
}

function deleteTask(taskId) {
    tasks = tasks.filter(t => t.id !== taskId);
    saveTasks();
    renderTasks();
    renderDashboardTasks();
    updateAllStatistics();
    showNotification("Task deleted", "info");
}

function saveTasks() {
    persistData();
}

function renderTasks() {
    const fullTaskList = document.getElementById('fullTaskList');
    if (!fullTaskList) return;
    
    let filteredTasks = tasks;
    
    switch(currentTaskFilter) {
        case 'urgent':
            filteredTasks = tasks.filter(t => t.priority === 'urgent');
            break;
        case 'not-urgent':
            filteredTasks = tasks.filter(t => t.priority === 'not-urgent');
            break;
        case 'optional':
            filteredTasks = tasks.filter(t => t.priority === 'optional');
            break;
        case 'active':
            filteredTasks = tasks.filter(t => !t.completed);
            break;
        case 'completed':
            filteredTasks = tasks.filter(t => t.completed);
            break;
        case 'all':
        default:
            filteredTasks = tasks;
    }
    
    if (filteredTasks.length === 0) {
        fullTaskList.innerHTML = `
            <div class="empty-state">
                <div class="empty-state-icon">ðŸ“</div>
                <div class="empty-state-title">No tasks found</div>
                <div class="empty-state-description">
                    ${currentTaskFilter === 'all' ? 'Add your first task above!' : 
                      currentTaskFilter === 'active' ? 'All tasks are completed! ðŸŽ‰' : 
                      currentTaskFilter === 'completed' ? 'No completed tasks yet' :
                      `No ${currentTaskFilter.replace('-', ' ')} tasks`}
                </div>
            </div>
        `;
    } else {
        fullTaskList.innerHTML = filteredTasks.map((task, index) => `
            <li class="task-item ${task.completed ? 'completed' : ''} ${getPriorityClass(task.priority)}">
                <div class="task-text" onclick="toggleTask('${task.id}')">
                    ${task.text}
                    <div style="margin-top: var(--spacing-xs);">
                        ${getPriorityBadge(task.priority)}
                    </div>
                </div>
                <div class="task-actions">
                    <button class="btn ${task.completed ? 'btn-success' : 'btn-warning'}" 
                            onclick="toggleTask('${task.id}')">
                        ${task.completed ? 'âœ… Completed' : 'â¬œ Mark Done'}
                    </button>
                    <button class="btn btn-danger" onclick="deleteTask('${task.id}')">ðŸ—‘ï¸ Delete</button>
                </div>
            </li>
        `).join('');
    }
    
    updateTaskStats();
}

function renderDashboardTasks() {
    const taskList = document.getElementById('taskList');
    if (!taskList) return;
    
    const urgentTasks = tasks.filter(t => t.priority === 'urgent' && !t.completed);
    const notUrgentTasks = tasks.filter(t => t.priority === 'not-urgent' && !t.completed);
    const optionalTasks = tasks.filter(t => t.priority === 'optional' && !t.completed);
    
    const recentTasks = [...urgentTasks, ...notUrgentTasks, ...optionalTasks].slice(0, 5);
    
    if (recentTasks.length === 0) {
        taskList.innerHTML = `
            <div class="empty-state" style="padding: var(--spacing-lg);">
                <div class="empty-state-icon" style="font-size: 2rem;">ðŸ“</div>
                <div class="empty-state-description">No tasks yet. Add your first task!</div>
            </div>
        `;
    } else {
        taskList.innerHTML = recentTasks.map(task => `
            <li class="task-item ${getPriorityClass(task.priority)}" style="padding: var(--spacing-md); margin-bottom: var(--spacing-sm);">
                <div class="task-text" onclick="toggleTask('${task.id}')" style="font-size: 1rem;">
                    ${task.text}
                    <div style="margin-top: var(--spacing-xs); font-size: 0.75rem;">
                        ${getPriorityBadge(task.priority)}
                    </div>
                </div>
                <div class="task-actions">
                    <button class="btn ${task.completed ? 'btn-success' : 'btn-secondary'}" 
                            onclick="toggleTask('${task.id}')" style="padding: 0.5rem 1rem; font-size: 0.875rem;">
                        ${task.completed ? 'âœ…' : 'â¬œ'}
                    </button>
                </div>
            </li>
        `).join('');
    }
}

function filterTasks(filter) {
    currentTaskFilter = filter;
    renderTasks();
}

function updateTaskStats() {
    const totalTasks = tasks.length;
    const completedTasks = tasks.filter(t => t.completed).length;
    const pendingTasks = totalTasks - completedTasks;
    const completionRate = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;
    
    const totalTasksEl = document.getElementById('totalTasks');
    const pendingTasksEl = document.getElementById('pendingTasks');
    const completedTasksEl = document.getElementById('completedTasks');
    const completionRateEl = document.getElementById('completionRate');
    
    if (totalTasksEl) totalTasksEl.textContent = totalTasks;
    if (pendingTasksEl) pendingTasksEl.textContent = pendingTasks;
    if (completedTasksEl) completedTasksEl.textContent = completedTasks;
    if (completionRateEl) completionRateEl.textContent = `${completionRate}%`;
}

function clearCompletedTasks() {
    if (tasks.length === 0) {
        showNotification("No tasks to clear", "info");
        return;
    }
    
    const completedCount = tasks.filter(t => t.completed).length;
    if (completedCount === 0) {
        showNotification("No completed tasks to clear", "info");
        return;
    }
    
    if (confirm(`Clear ${completedCount} completed task${completedCount === 1 ? '' : 's'}?`)) {
        tasks = tasks.filter(t => !t.completed);
        saveTasks();
        renderTasks();
        renderDashboardTasks();
        updateAllStatistics();
        showNotification(`Cleared ${completedCount} completed task${completedCount === 1 ? '' : 's'}`, "success");
    }
}

// ========== ASSIGNMENT MANAGEMENT ==========
function loadAssignments() {
    renderAssignments();
    renderDashboardAssignments();
}

function addAssignment() {
    const name = document.getElementById('assignmentName').value.trim();
    const subject = document.getElementById('assignmentSubject').value.trim();
    const dueDate = document.getElementById('assignmentDueDate').value;
    const description = document.getElementById('assignmentDescription').value.trim();
    
    if (!name || !subject || !dueDate) {
        showNotification("Please fill all required fields", "error");
        return;
    }
    
    const assignment = {
        id: Date.now().toString(),
        name,
        subject,
        dueDate,
        description,
        createdAt: new Date().toISOString(),
        completed: false
    };
    
    assignments.unshift(assignment);
    saveAssignments();
    renderAssignments();
    renderDashboardAssignments();
    
    showNotification("Assignment added!", "success");
    hideAssignmentForm();
}

function renderAssignments() {
    const fullAssignmentList = document.getElementById('fullAssignmentList');
    if (!fullAssignmentList) return;
    
    if (assignments.length === 0) {
        fullAssignmentList.innerHTML = `
            <div class="empty-state">
                <div class="empty-state-icon">ðŸ“š</div>
                <div class="empty-state-title">No assignments yet</div>
                <div class="empty-state-description">Add your first assignment!</div>
            </div>
        `;
    } else {
        fullAssignmentList.innerHTML = assignments.map((assignment, index) => {
            const dueDate = new Date(assignment.dueDate);
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            const diffTime = dueDate - today;
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            
            let urgencyClass = 'normal';
            if (diffDays < 0) urgencyClass = 'overdue';
            else if (diffDays === 0) urgencyClass = 'today';
            else if (diffDays <= 3) urgencyClass = 'due-soon';
            
            return `
                <div class="assignment-item ${assignment.completed ? 'completed' : ''}">
                    <div class="assignment-header">
                        <div class="assignment-title">${assignment.name}</div>
                        <div class="assignment-date ${urgencyClass}">
                            ${urgencyClass === 'overdue' ? 'âš ï¸ Overdue' : 
                              urgencyClass === 'today' ? 'ðŸ”¥ Due Today' : 
                              urgencyClass === 'due-soon' ? 'â° Due Soon' : `ðŸ“… ${dueDate.toLocaleDateString()}`}
                        </div>
                    </div>
                    <div class="assignment-content">
                        <div style="color: var(--text-muted); margin-bottom: var(--spacing-sm);">
                            ðŸ“š ${assignment.subject}
                        </div>
                        ${assignment.description ? `<p>${assignment.description}</p>` : ''}
                    </div>
                    <div class="assignment-actions">
                        <button class="btn ${assignment.completed ? 'btn-success' : 'btn-secondary'}" onclick="toggleAssignment('${assignment.id}')">
                            ${assignment.completed ? 'âœ… Completed' : 'â¬œ Mark Complete'}
                        </button>
                        <button class="btn btn-danger" onclick="deleteAssignment('${assignment.id}')">ðŸ—‘ï¸ Delete</button>
                    </div>
                </div>
            `;
        }).join('');
    }
}

function renderDashboardAssignments() {
    const assignmentList = document.getElementById('assignmentList');
    if (!assignmentList) return;
    
    const recentAssignments = assignments.slice(0, 3);
    
    if (recentAssignments.length === 0) {
        assignmentList.innerHTML = `
            <div class="empty-state" style="padding: var(--spacing-lg);">
                <div class="empty-state-icon" style="font-size: 2rem;">ðŸ“š</div>
                <div class="empty-state-description">No assignments yet</div>
            </div>
        `;
    } else {
        assignmentList.innerHTML = recentAssignments.map(assignment => {
            const dueDate = new Date(assignment.dueDate);
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            const diffTime = dueDate - today;
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            
            let urgencyClass = 'normal';
            if (diffDays < 0) urgencyClass = 'overdue';
            else if (diffDays === 0) urgencyClass = 'today';
            else if (diffDays <= 3) urgencyClass = 'due-soon';
            
            return `
                <div class="assignment-item" style="padding: var(--spacing-md); margin-bottom: var(--spacing-sm);">
                    <div class="assignment-header">
                        <div class="assignment-title" style="font-size: 1rem;">${assignment.name}</div>
                        <div class="assignment-date" style="font-size: 0.75rem; padding: 0.25rem 0.5rem;">
                            ${urgencyClass === 'overdue' ? 'âš ï¸' : 
                              urgencyClass === 'today' ? 'ðŸ”¥' : 
                              urgencyClass === 'due-soon' ? 'â°' : 'ðŸ“…'}
                        </div>
                    </div>
                    <div style="color: var(--text-muted); font-size: 0.875rem;">
                        ðŸ“š ${assignment.subject}
                    </div>
                    <div style="margin-top: var(--spacing-sm);">
                        <button class="btn ${assignment.completed ? 'btn-success' : 'btn-secondary'}" 
                                onclick="toggleAssignment('${assignment.id}')" style="padding: 0.5rem 1rem; font-size: 0.875rem;">
                            ${assignment.completed ? 'âœ…' : 'â¬œ'}
                        </button>
                    </div>
                </div>
            `;
        }).join('');
    }
}

function toggleAssignment(assignmentId) {
    const assignment = assignments.find(a => a.id === assignmentId);
    if (assignment) {
        assignment.completed = !assignment.completed;
        saveAssignments();
        renderAssignments();
        renderDashboardAssignments();
        showNotification(assignment.completed ? "Assignment marked as completed!" : "Assignment marked as incomplete", "success");
    }
}

function deleteAssignment(assignmentId) {
    assignments = assignments.filter(a => a.id !== assignmentId);
    saveAssignments();
    renderAssignments();
    renderDashboardAssignments();
    showNotification("Assignment deleted", "info");
}

function saveAssignments() {
    persistData();
}

function showAssignmentForm() {
    const form = document.getElementById('assignmentForm');
    if (form) form.style.display = 'block';
}

function hideAssignmentForm() {
    const form = document.getElementById('assignmentForm');
    if (form) form.style.display = 'none';
}

// ========== UPDATED STATISTICS SECTION ==========
function markStudySession() {
    const today = new Date().toDateString();
    
    const hours = parseFloat(prompt("How many hours did you study? (e.g., 2.5)", "1"));
    
    if (isNaN(hours) || hours <= 0) {
        showNotification("Please enter a valid number of hours", "error");
        return;
    }
    
    const focusScore = Math.min(100, Math.floor(Math.random() * 30) + 70);
    const consistencyScore = calculateConsistencyScore();
    
    // Initialize arrays if they don't exist
    if (!studyData.studySessions) studyData.studySessions = [];
    if (!studyData.dailyStats) studyData.dailyStats = [];
    
    // Update study sessions
    studyData.studySessions.unshift({
        date: new Date().toISOString(),
        hours: hours,
        baseHours: hours,
        bonusHours: 0,
        streak: studyData.streak || 0
    });
    
    // Update daily stats
    const todayStats = studyData.dailyStats.find(s => s.date === today);
    if (todayStats) {
        todayStats.sessions = (todayStats.sessions || 0) + 1;
        todayStats.hours = (todayStats.hours || 0) + hours;
        todayStats.focusScore = focusScore;
        todayStats.consistencyScore = consistencyScore;
    } else {
        studyData.dailyStats.unshift({
            date: today,
            sessions: 1,
            hours: hours,
            focusScore: focusScore,
            consistencyScore: consistencyScore
        });
        
        if (studyData.dailyStats.length > 30) {
            studyData.dailyStats = studyData.dailyStats.slice(0, 30);
        }
    }
    
    // Update total hours
    studyData.totalMinutes = (studyData.totalMinutes || 0) + hours * 60;
    studyData.totalStudyHours = (studyData.totalMinutes / 60).toFixed(1);
    
    persistData();
    updateCharts();
    updateAllStatistics();
    
    showNotification(`Study session recorded! ${hours} hours studied.`, "success");
}

function calculateConsistencyScore() {
    if (!studyData.dailyStats || studyData.dailyStats.length === 0) return 100;
    
    const last7Days = studyData.dailyStats.slice(0, 7);
    const daysStudied = last7Days.length;
    const totalDays = Math.min(7, studyData.dailyStats.length);
    
    return Math.min(100, Math.floor((daysStudied / totalDays) * 100));
}

function updateCharts() {
    // Destroy existing charts
    if (hoursChart) hoursChart.destroy();
    if (tasksChart) tasksChart.destroy();
    if (weeklyChart) weeklyChart.destroy();
    if (assignmentsChart) assignmentsChart.destroy();
    if (streakChart) streakChart.destroy();
    if (focusChart) focusChart.destroy();
    
    updateOverviewCards();
    updatePerformanceMetrics();
    updateDetailedStats();
    createHoursChart();
    createTasksChart();
    createWeeklyChart();
    createAssignmentsChart();
    createStreakChart();
    createFocusChart();
}

function updateOverviewCards() {
    document.getElementById('overviewStreak').textContent = studyData.streak || 0;
    document.getElementById('overviewHours').textContent = parseFloat(studyData.totalStudyHours || 0).toFixed(1);
    document.getElementById('overviewTasks').textContent = tasks.filter(t => t.completed).length;
    document.getElementById('overviewFocus').textContent = `${calculateFocusScore()}%`;
    
    updateTrends();
}

function updateTrends() {
    if (!studyData.dailyStats || studyData.dailyStats.length < 2) return;
    
    const today = studyData.dailyStats[0] || {};
    const yesterday = studyData.dailyStats[1] || {};
    
    // Update streak trend
    const streakTrend = document.getElementById('streakTrend');
    const streakDiff = (studyData.streak || 0) - (yesterday.streak || 0);
    updateTrendElement(streakTrend, streakDiff, "days streak");
    
    // Update hours trend
    const hoursTrend = document.getElementById('hoursTrend');
    const hoursDiff = (today.hours || 0) - (yesterday.hours || 0);
    updateTrendElement(hoursTrend, hoursDiff, "hours");
    
    // Update tasks trend
    const tasksTrend = document.getElementById('tasksTrend');
    const todayCompleted = tasks.filter(t => {
        if (!t.completedAt) return false;
        const completedDate = new Date(t.completedAt).toDateString();
        return completedDate === new Date().toDateString();
    }).length;
    const yesterdayCompleted = tasks.filter(t => {
        if (!t.completedAt) return false;
        const completedDate = new Date(t.completedAt).toDateString();
        const yesterday = new Date();
        yesterday.setDate(yesterday.getDate() - 1);
        return completedDate === yesterday.toDateString();
    }).length;
    const tasksDiff = todayCompleted - yesterdayCompleted;
    updateTrendElement(tasksTrend, tasksDiff, "tasks");
    
    // Update focus trend
    const focusTrend = document.getElementById('focusTrend');
    const focusDiff = (today.focusScore || calculateFocusScore()) - (yesterday.focusScore || calculateFocusScore());
    updateTrendElement(focusTrend, focusDiff, "% focus");
}

function updateTrendElement(element, diff, label) {
    if (!element) return;
    
    let trendClass = 'neutral';
    let icon = 'âž¡ï¸';
    let text = 'No change';
    
    if (diff > 0) {
        trendClass = 'up';
        icon = 'ðŸ“ˆ';
        text = `+${diff} ${label}`;
    } else if (diff < 0) {
        trendClass = 'down';
        icon = 'ðŸ“‰';
        text = `${diff} ${label}`;
    }
    
    element.className = `stats-overview-trend ${trendClass}`;
    element.innerHTML = `<span>${icon}</span><span>${text}</span>`;
}

function updatePerformanceMetrics() {
    // Study sessions this week
    const thisWeekSessions = studyData.dailyStats ? 
        studyData.dailyStats.slice(0, 7).reduce((sum, day) => sum + (day.sessions || 0), 0) : 0;
    document.getElementById('metricSessions').textContent = thisWeekSessions;
    
    // Average daily hours
    const avgDailyHours = studyData.totalStudyDays > 0 ? 
        (parseFloat(studyData.totalStudyHours || 0) / studyData.totalStudyDays).toFixed(1) : 0;
    document.getElementById('metricAvgHours').textContent = `${avgDailyHours}h`;
    
    // Longest streak
    const longestStreak = studyData.streakHistory ? 
        Math.max(...studyData.streakHistory.map(s => s.streak || 0), studyData.streak || 0) : studyData.streak || 0;
    document.getElementById('metricLongestStreak').textContent = longestStreak;
    
    // Consistency score
    const consistencyScore = calculateConsistencyScore();
    document.getElementById('metricConsistency').textContent = `${consistencyScore}%`;
}

function updateDetailedStats() {
    // Productivity Metrics
    document.getElementById('detailTotalHours').textContent = parseFloat(studyData.totalStudyHours || 0).toFixed(1);
    document.getElementById('detailTotalSessions').textContent = studyData.studySessions ? studyData.studySessions.length : 0;
    
    const avgSessionLength = studyData.studySessions && studyData.studySessions.length > 0 ? 
        (parseFloat(studyData.totalStudyHours || 0) / studyData.studySessions.length).toFixed(1) : 0;
    document.getElementById('detailAvgSession').textContent = `${avgSessionLength}h`;
    
    const longestSession = studyData.studySessions && studyData.studySessions.length > 0 ? 
        Math.max(...studyData.studySessions.map(s => s.hours || 0)) : 0;
    document.getElementById('detailLongestSession').textContent = `${longestSession.toFixed(1)}h`;
    
    // Task Metrics
    document.getElementById('detailTotalTasks').textContent = tasks.length;
    document.getElementById('detailCompletedTasks').textContent = tasks.filter(t => t.completed).length;
    
    const completionRate = tasks.length > 0 ? 
        Math.round((tasks.filter(t => t.completed).length / tasks.length) * 100) : 0;
    document.getElementById('detailCompletionRate').textContent = `${completionRate}%`;
    
    document.getElementById('detailActiveTasks').textContent = tasks.filter(t => !t.completed).length;
    
    // Achievement Metrics
    document.getElementById('detailCurrentStreak').textContent = studyData.streak || 0;
    
    const longestStreak = studyData.streakHistory ? 
        Math.max(...studyData.streakHistory.map(s => s.streak || 0), studyData.streak || 0) : studyData.streak || 0;
    document.getElementById('detailLongestStreak').textContent = longestStreak;
    
    document.getElementById('detailFocusScore').textContent = `${calculateFocusScore()}%`;
    document.getElementById('detailConsistencyScore').textContent = `${calculateConsistencyScore()}%`;
}

function createHoursChart() {
    const ctx = document.getElementById('hoursChart');
    if (!ctx) return;
    
    const last7Days = Array.from({length: 7}, (_, i) => {
        const date = new Date();
        date.setDate(date.getDate() - i);
        return date.toDateString();
    }).reverse();
    
    if (!studyData.studySessions) studyData.studySessions = [];
    
    const dailyHours = last7Days.map(day => {
        const daySessions = studyData.studySessions.filter(s => {
            const sessionDate = new Date(s.date).toDateString();
            return sessionDate === day;
        });
        return daySessions.reduce((sum, session) => sum + (session.hours || 0), 0);
    });
    
    // Theme-adaptive colors
    const barColor = getComputedStyle(document.documentElement).getPropertyValue('--accent');
    const borderColor = getComputedStyle(document.documentElement).getPropertyValue('--accent-dark');
    
    hoursChart = new Chart(ctx.getContext('2d'), {
        type: 'bar',
        data: {
            labels: last7Days.map(date => {
                const d = new Date(date);
                return d.toLocaleDateString('en-US', { weekday: 'short' });
            }),
            datasets: [{
                label: 'Study Hours',
                data: dailyHours,
                backgroundColor: barColor + '80', // 50% opacity
                borderColor: borderColor,
                borderWidth: 1,
                borderRadius: 4
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: true,
                    position: 'top',
                    labels: {
                        color: getComputedStyle(document.documentElement).getPropertyValue('--text'),
                        font: {
                            size: 12
                        }
                    }
                },
                tooltip: {
                    backgroundColor: getComputedStyle(document.documentElement).getPropertyValue('--card'),
                    titleColor: getComputedStyle(document.documentElement).getPropertyValue('--text'),
                    bodyColor: getComputedStyle(document.documentElement).getPropertyValue('--text-muted'),
                    borderColor: getComputedStyle(document.documentElement).getPropertyValue('--border'),
                    borderWidth: 1
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    grid: {
                        color: getComputedStyle(document.documentElement).getPropertyValue('--border') + '40'
                    },
                    ticks: {
                        color: getComputedStyle(document.documentElement).getPropertyValue('--text-muted'),
                        font: {
                            size: 11
                        }
                    },
                    title: {
                        display: true,
                        text: 'Hours',
                        color: getComputedStyle(document.documentElement).getPropertyValue('--text-muted'),
                        font: {
                            size: 12
                        }
                    }
                },
                x: {
                    grid: {
                        color: getComputedStyle(document.documentElement).getPropertyValue('--border') + '40'
                    },
                    ticks: {
                        color: getComputedStyle(document.documentElement).getPropertyValue('--text-muted'),
                        font: {
                            size: 11
                        }
                    }
                }
            }
        }
    });
    
    // Update legend
    const legend = document.getElementById('hoursLegend');
    if (legend) {
        legend.innerHTML = `
            <div class="legend-item">
                <div class="legend-color" style="background: ${barColor};"></div>
                <span>Daily Study Hours</span>
            </div>
        `;
    }
}

function createTasksChart() {
    const ctx = document.getElementById('tasksChart');
    if (!ctx) return;
    
    const completedTasks = tasks.filter(t => t.completed).length;
    const pendingTasks = tasks.filter(t => !t.completed).length;
    
    // Theme-adaptive colors
    const successColor = getComputedStyle(document.documentElement).getPropertyValue('--success');
    const warningColor = getComputedStyle(document.documentElement).getPropertyValue('--warning');
    
    tasksChart = new Chart(ctx.getContext('2d'), {
        type: 'doughnut',
        data: {
            labels: ['Completed', 'Pending'],
            datasets: [{
                data: [completedTasks, pendingTasks],
                backgroundColor: [
                    successColor + '80',
                    warningColor + '80'
                ],
                borderColor: [
                    successColor,
                    warningColor
                ],
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            cutout: '70%',
            plugins: {
                legend: {
                    position: 'bottom',
                    labels: {
                        color: getComputedStyle(document.documentElement).getPropertyValue('--text'),
                        font: {
                            size: 11
                        },
                        padding: 15
                    }
                },
                tooltip: {
                    backgroundColor: getComputedStyle(document.documentElement).getPropertyValue('--card'),
                    titleColor: getComputedStyle(document.documentElement).getPropertyValue('--text'),
                    bodyColor: getComputedStyle(document.documentElement).getPropertyValue('--text-muted'),
                    borderColor: getComputedStyle(document.documentElement).getPropertyValue('--border'),
                    borderWidth: 1
                }
            }
        }
    });
    
    // Update legend
    const legend = document.getElementById('tasksLegend');
    if (legend) {
        legend.innerHTML = `
            <div class="legend-item">
                <div class="legend-color" style="background: ${successColor};"></div>
                <span>Completed Tasks</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: ${warningColor};"></div>
                <span>Pending Tasks</span>
            </div>
        `;
    }
}

function createWeeklyChart() {
    const ctx = document.getElementById('weeklyChart');
    if (!ctx) return;
    
    const daysOfWeek = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
    
    if (!studyData.weeklyPattern) studyData.weeklyPattern = [0, 0, 0, 0, 0, 0, 0];
    
    // Theme-adaptive colors
    const lineColor = getComputedStyle(document.documentElement).getPropertyValue('--purple');
    const fillColor = lineColor + '20';
    
    weeklyChart = new Chart(ctx.getContext('2d'), {
        type: 'line',
        data: {
            labels: daysOfWeek,
            datasets: [{
                label: 'Study Sessions',
                data: studyData.weeklyPattern,
                backgroundColor: fillColor,
                borderColor: lineColor,
                borderWidth: 2,
                fill: true,
                tension: 0.4
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: true,
                    position: 'top',
                    labels: {
                        color: getComputedStyle(document.documentElement).getPropertyValue('--text'),
                        font: {
                            size: 12
                        }
                    }
                },
                tooltip: {
                    backgroundColor: getComputedStyle(document.documentElement).getPropertyValue('--card'),
                    titleColor: getComputedStyle(document.documentElement).getPropertyValue('--text'),
                    bodyColor: getComputedStyle(document.documentElement).getPropertyValue('--text-muted'),
                    borderColor: getComputedStyle(document.documentElement).getPropertyValue('--border'),
                    borderWidth: 1
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    grid: {
                        color: getComputedStyle(document.documentElement).getPropertyValue('--border') + '40'
                    },
                    ticks: {
                        color: getComputedStyle(document.documentElement).getPropertyValue('--text-muted'),
                        font: {
                            size: 11
                        }
                    },
                    title: {
                        display: true,
                        text: 'Sessions',
                        color: getComputedStyle(document.documentElement).getPropertyValue('--text-muted'),
                        font: {
                            size: 12
                        }
                    }
                },
                x: {
                    grid: {
                        color: getComputedStyle(document.documentElement).getPropertyValue('--border') + '40'
                    },
                    ticks: {
                        color: getComputedStyle(document.documentElement).getPropertyValue('--text-muted'),
                        font: {
                            size: 11
                        }
                    }
                }
            }
        }
    });
    
    // Update legend
    const legend = document.getElementById('weeklyLegend');
    if (legend) {
        legend.innerHTML = `
            <div class="legend-item">
                <div class="legend-color" style="background: ${lineColor};"></div>
                <span>Weekly Study Pattern</span>
            </div>
        `;
    }
}

function createAssignmentsChart() {
    const ctx = document.getElementById('assignmentsChart');
    if (!ctx) return;
    
    const today = new Date();
    today.setHours(0, 0, 0, 0);
    
    const overdue = assignments.filter(a => {
        const dueDate = new Date(a.dueDate);
        return dueDate < today && !a.completed;
    }).length;
    
    const dueToday = assignments.filter(a => {
        const dueDate = new Date(a.dueDate);
        dueDate.setHours(0, 0, 0, 0);
        return dueDate.getTime() === today.getTime() && !a.completed;
    }).length;
    
    const dueSoon = assignments.filter(a => {
        const dueDate = new Date(a.dueDate);
        const diffTime = dueDate - today;
        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
        return diffDays > 0 && diffDays <= 3 && !a.completed;
    }).length;
    
    const completed = assignments.filter(a => a.completed).length;
    const future = assignments.filter(a => {
        const dueDate = new Date(a.dueDate);
        const diffTime = dueDate - today;
        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
        return diffDays > 3 && !a.completed;
    }).length;
    
    // Theme-adaptive colors
    const colors = [
        getComputedStyle(document.documentElement).getPropertyValue('--danger'),
        getComputedStyle(document.documentElement).getPropertyValue('--warning'),
        getComputedStyle(document.documentElement).getPropertyValue('--info'),
        getComputedStyle(document.documentElement).getPropertyValue('--success'),
        getComputedStyle(document.documentElement).getPropertyValue('--text-muted')
    ];
    
    assignmentsChart = new Chart(ctx.getContext('2d'), {
        type: 'pie',
        data: {
            labels: ['Overdue', 'Due Today', 'Due Soon', 'Completed', 'Future'],
            datasets: [{
                data: [overdue, dueToday, dueSoon, completed, future],
                backgroundColor: colors.map(color => color + '80'),
                borderColor: colors,
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'bottom',
                    labels: {
                        color: getComputedStyle(document.documentElement).getPropertyValue('--text'),
                        font: {
                            size: 11
                        },
                        padding: 15
                    }
                },
                tooltip: {
                    backgroundColor: getComputedStyle(document.documentElement).getPropertyValue('--card'),
                    titleColor: getComputedStyle(document.documentElement).getPropertyValue('--text'),
                    bodyColor: getComputedStyle(document.documentElement).getPropertyValue('--text-muted'),
                    borderColor: getComputedStyle(document.documentElement).getPropertyValue('--border'),
                    borderWidth: 1
                }
            }
        }
    });
    
    // Update legend
    const legend = document.getElementById('assignmentsLegend');
    if (legend) {
        legend.innerHTML = colors.map((color, index) => {
            const labels = ['Overdue', 'Due Today', 'Due Soon', 'Completed', 'Future'];
            return `
                <div class="legend-item">
                    <div class="legend-color" style="background: ${color};"></div>
                    <span>${labels[index]}</span>
                </div>
            `;
        }).join('');
    }
}

function createStreakChart() {
    const ctx = document.getElementById('streakChart');
    if (!ctx) return;
    
    const last14Days = Array.from({length: 14}, (_, i) => {
        const date = new Date();
        date.setDate(date.getDate() - i);
        return date.toDateString();
    }).reverse();
    
    if (!studyData.streakHistory) studyData.streakHistory = [];
    
    const streakData = last14Days.map(day => {
        const streakEntry = studyData.streakHistory.find(s => s.date === day);
        return streakEntry ? streakEntry.streak : 0;
    });
    
    // Theme-adaptive colors
    const lineColor = getComputedStyle(document.documentElement).getPropertyValue('--warning');
    const fillColor = lineColor + '20';
    
    streakChart = new Chart(ctx.getContext('2d'), {
        type: 'line',
        data: {
            labels: last14Days.map(date => {
                const d = new Date(date);
                return d.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
            }),
            datasets: [{
                label: 'Streak Days',
                data: streakData,
                backgroundColor: fillColor,
                borderColor: lineColor,
                borderWidth: 2,
                fill: true,
                tension: 0.4,
                pointBackgroundColor: lineColor,
                pointBorderColor: getComputedStyle(document.documentElement).getPropertyValue('--card'),
                pointBorderWidth: 2
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: true,
                    position: 'top',
                    labels: {
                        color: getComputedStyle(document.documentElement).getPropertyValue('--text'),
                        font: {
                            size: 12
                        }
                    }
                },
                tooltip: {
                    backgroundColor: getComputedStyle(document.documentElement).getPropertyValue('--card'),
                    titleColor: getComputedStyle(document.documentElement).getPropertyValue('--text'),
                    bodyColor: getComputedStyle(document.documentElement).getPropertyValue('--text-muted'),
                    borderColor: getComputedStyle(document.documentElement).getPropertyValue('--border'),
                    borderWidth: 1
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    grid: {
                        color: getComputedStyle(document.documentElement).getPropertyValue('--border') + '40'
                    },
                    ticks: {
                        color: getComputedStyle(document.documentElement).getPropertyValue('--text-muted'),
                        font: {
                            size: 11
                        }
                    },
                    title: {
                        display: true,
                        text: 'Days',
                        color: getComputedStyle(document.documentElement).getPropertyValue('--text-muted'),
                        font: {
                            size: 12
                        }
                    }
                },
                x: {
                    grid: {
                        color: getComputedStyle(document.documentElement).getPropertyValue('--border') + '40'
                    },
                    ticks: {
                        color: getComputedStyle(document.documentElement).getPropertyValue('--text-muted'),
                        font: {
                            size: 11
                        }
                    }
                }
            }
        }
    });
    
    // Update legend
    const legend = document.getElementById('streakLegend');
    if (legend) {
        legend.innerHTML = `
            <div class="legend-item">
                <div class="legend-color" style="background: ${lineColor};"></div>
                <span>Daily Streak</span>
            </div>
        `;
    }
}

function createFocusChart() {
    const ctx = document.getElementById('focusChart');
    if (!ctx) return;
    
    const last7Days = Array.from({length: 7}, (_, i) => {
        const date = new Date();
        date.setDate(date.getDate() - i);
        return date.toDateString();
    }).reverse();
    
    if (!studyData.focusScores) studyData.focusScores = [];
    
    const focusData = last7Days.map(day => {
        const focusEntry = studyData.focusScores.find(s => s.date === day);
        return focusEntry ? focusEntry.score : 0;
    });
    
    // Theme-adaptive colors
    const lineColor = getComputedStyle(document.documentElement).getPropertyValue('--accent');
    const fillColor = lineColor + '20';
    
    focusChart = new Chart(ctx.getContext('2d'), {
        type: 'line',
        data: {
            labels: last7Days.map(date => {
                const d = new Date(date);
                return d.toLocaleDateString('en-US', { weekday: 'short' });
            }),
            datasets: [{
                label: 'Focus Score (%)',
                data: focusData,
                backgroundColor: fillColor,
                borderColor: lineColor,
                borderWidth: 2,
                fill: true,
                tension: 0.4,
                pointBackgroundColor: lineColor,
                pointBorderColor: getComputedStyle(document.documentElement).getPropertyValue('--card'),
                pointBorderWidth: 2
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: true,
                    position: 'top',
                    labels: {
                        color: getComputedStyle(document.documentElement).getPropertyValue('--text'),
                        font: {
                            size: 12
                        }
                    }
                },
                tooltip: {
                    backgroundColor: getComputedStyle(document.documentElement).getPropertyValue('--card'),
                    titleColor: getComputedStyle(document.documentElement).getPropertyValue('--text'),
                    bodyColor: getComputedStyle(document.documentElement).getPropertyValue('--text-muted'),
                    borderColor: getComputedStyle(document.documentElement).getPropertyValue('--border'),
                    borderWidth: 1
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    max: 100,
                    grid: {
                        color: getComputedStyle(document.documentElement).getPropertyValue('--border') + '40'
                    },
                    ticks: {
                        color: getComputedStyle(document.documentElement).getPropertyValue('--text-muted'),
                        font: {
                            size: 11
                        }
                    },
                    title: {
                        display: true,
                        text: 'Score (%)',
                        color: getComputedStyle(document.documentElement).getPropertyValue('--text-muted'),
                        font: {
                            size: 12
                        }
                    }
                },
                x: {
                    grid: {
                        color: getComputedStyle(document.documentElement).getPropertyValue('--border') + '40'
                    },
                    ticks: {
                        color: getComputedStyle(document.documentElement).getPropertyValue('--text-muted'),
                        font: {
                            size: 11
                        }
                    }
                }
            }
        }
    });
    
    // Update legend
    const legend = document.getElementById('focusLegend');
    if (legend) {
        legend.innerHTML = `
            <div class="legend-item">
                <div class="legend-color" style="background: ${lineColor};"></div>
                <span>Daily Focus Score</span>
            </div>
        `;
    }
}

function refreshCharts() {
    updateCharts();
    showNotification("Charts refreshed successfully!", "success");
}

function calculateFocusScore() {
    let score = 50;
    
    const streakBonus = Math.min((studyData.streak || 0) * 5, 30);
    score += streakBonus;
    
    if ((studyData.totalStudyDays || 0) > 7) score += 10;
    if ((studyData.totalStudyDays || 0) > 30) score += 10;
    
    const completionRate = tasks.length > 0 ? 
        (tasks.filter(t => t.completed).length / tasks.length) * 100 : 0;
    score += Math.min(completionRate * 0.2, 10);
    
    return Math.min(Math.max(Math.round(score), 0), 100);
}

function exportStatistics() {
    const statsData = {
        exportDate: new Date().toISOString(),
        summary: {
            totalHours: parseFloat(studyData.totalStudyHours || (studyData.totalMinutes / 60).toFixed(1) || 0),
            currentStreak: studyData.streak || 0,
            taskCompletionRate: tasks.length > 0 ? Math.round((tasks.filter(t => t.completed).length / tasks.length) * 100) : 0,
            focusScore: calculateFocusScore()
        },
        detailed: {
            totalSessions: studyData.studySessions ? studyData.studySessions.length : 0,
            avgDailyHours: (studyData.totalStudyDays || 0) > 0 ? (parseFloat(studyData.totalStudyHours || 0) / (studyData.totalStudyDays || 1)).toFixed(1) : 0,
            totalTasks: tasks.length,
            completedTasks: tasks.filter(t => t.completed).length,
            totalAssignments: assignments.length,
            completedAssignments: assignments.filter(a => a.completed).length,
            weeklyPattern: studyData.weeklyPattern || [0, 0, 0, 0, 0, 0, 0],
            streakHistory: studyData.streakHistory || [],
            dailyStats: studyData.dailyStats || []
        }
    };
    
    const dataStr = JSON.stringify(statsData, null, 2);
    const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
    const exportFileDefaultName = `student-stats-${new Date().toISOString().split('T')[0]}.json`;
    
    const linkElement = document.createElement('a');
    linkElement.setAttribute('href', dataUri);
    linkElement.setAttribute('download', exportFileDefaultName);
    linkElement.click();
    
    showNotification("Statistics exported successfully!", "success");
}

// ========== INSPIRING STORIES ==========
function loadInspiringStories() {
    const storiesList = document.getElementById('storiesList');
    if (!storiesList) return;
    
    const shuffledStories = [...inspiringStories].sort(() => 0.5 - Math.random()).slice(0, 3);
    
    storiesList.innerHTML = shuffledStories.map(story => `
        <div class="story-item" onclick="showStoryModal(${story.id})">
            <div class="story-name">
                ${story.icon} ${story.name}
            </div>
            <div class="story-quote">"${story.quote}"</div>
        </div>
    `).join('');
}

function showStoryModal(storyId) {
    const story = inspiringStories.find(s => s.id === storyId);
    if (!story) return;
    
    const modal = document.getElementById('storyModal');
    const title = document.getElementById('storyModalTitle');
    const content = document.getElementById('storyModalContent');
    
    title.textContent = `${story.icon} ${story.name}'s Story`;
    
    content.innerHTML = `
        <div style="margin-bottom: var(--spacing-lg);">
            <h3 style="color: var(--accent); margin-bottom: var(--spacing-sm);">Their Famous Quote:</h3>
            <div style="font-style: italic; font-size: 1.25rem; color: var(--text); padding: var(--spacing-md); background: var(--bg); border-radius: var(--radius); border-left: 4px solid var(--accent);">
                "${story.quote}"
            </div>
        </div>
        
        <div style="margin-bottom: var(--spacing-lg);">
            <h3 style="color: var(--accent); margin-bottom: var(--spacing-sm);">Their Journey:</h3>
            <p style="line-height: 1.6;">${story.story}</p>
        </div>
        
        <div style="margin-bottom: var(--spacing-lg);">
            <h3 style="color: var(--accent); margin-bottom: var(--spacing-sm);">Challenges They Overcame:</h3>
            <ul style="padding-left: var(--spacing-lg); line-height: 1.6;">
                ${story.struggles.map(s => `<li style="margin-bottom: var(--spacing-xs);">${s}</li>`).join('')}
        </ul>
        </div>
        
        <div style="padding: var(--spacing-lg); background: var(--accent-light); border-radius: var(--radius); border-left: 4px solid var(--accent);">
            <h3 style="color: var(--accent); margin-bottom: var(--spacing-sm);">ðŸ’¡ Key Lesson:</h3>
            <p style="font-weight: 600; color: var(--text);">${story.lessons}</p>
        </div>
    `;
    
    modal.style.display = 'flex';
}

function closeStoryModal() {
    document.getElementById('storyModal').style.display = 'none';
}

// ========== CLASS MANAGEMENT ==========
function updateClassSelector() {
    const selector = document.getElementById('classSelector');
    if (!selector) return;
    
    selector.innerHTML = '<option value="">Select a Class</option>';
    
    userClasses.forEach((classInfo, index) => {
        const option = document.createElement('option');
        option.value = index;
        option.textContent = `${classInfo.name || 'Class'} (${classInfo.code})`;
        if (index === selectedClassIndex) {
            option.selected = true;
        }
        selector.appendChild(option);
    });
}

async function switchClass(classIndex) {
    if (classIndex === "") return;
    
    classIndex = parseInt(classIndex);
    if (classIndex >= 0 && classIndex < userClasses.length) {
        selectedClassIndex = classIndex;
        currentClassCode = userClasses[classIndex].code;
        
        console.log(`ðŸ”„ Switched to class: ${currentClassCode}`);
        
        persistData();
        loadClassroomData();
        if (currentSection === 'classroom') {
            await loadTeacherContent();
            await loadClassLeaderboard();
        }
        
        showNotification(`Switched to ${userClasses[classIndex].name || 'Class'}`, "success");
    }
}

function showJoinClassForm() {
    const form = document.getElementById('joinClassForm');
    if (form) {
        form.style.display = 'block';
        document.getElementById('joinClassCode').focus();
    }
}

function hideJoinClassForm() {
    const form = document.getElementById('joinClassForm');
    if (form) form.style.display = 'none';
}

async function joinClass() {
    const classCodeInput = document.getElementById('joinClassCode');
    const classCode = classCodeInput.value.toUpperCase().trim();
    
    if (!classCode || classCode.length !== 6) {
        showNotification("Please enter a valid 6-digit class code", "error");
        return;
    }
    
    const joinBtn = event.target;
    const originalText = joinBtn.innerHTML;
    joinBtn.innerHTML = 'ðŸ”„ Joining...';
    joinBtn.disabled = true;
    
    try {
        console.log(`ðŸŽ“ Attempting to join class: ${classCode}`);
        
        if (userClasses.some(c => c.code === classCode)) {
            showNotification("You've already joined this class", "info");
            hideJoinClassForm();
            joinBtn.innerHTML = originalText;
            joinBtn.disabled = false;
            return;
        }
        
        let classData = null;
        try {
            classData = await firebaseGet('classCodes/' + classCode);
        } catch (error) {
            console.log("Trying alternative path...");
            classData = await firebaseGet('classes/' + classCode);
        }
        
        if (!classData) {
            showNotification("Class not found. Check the code and try again.", "error");
            joinBtn.innerHTML = originalText;
            joinBtn.disabled = false;
            return;
        }
        
        console.log("âœ… Class found:", classData);
        
        const studentData = {
            name: currentUserName || 'Student',
            userId: currentUserId,
            firebaseUid: currentUser ? currentUser.uid : null,
            streak: studyData.streak || 0,
            totalMinutes: studyData.totalMinutes || 0,
            totalStudyHours: (studyData.totalMinutes / 60).toFixed(1),
            points: Math.floor(studyData.totalMinutes / 60) * 100 || 0,
            lastActive: new Date().toISOString(),
            joinedAt: new Date().toISOString(),
            updatedAt: new Date().toISOString(),
            isStudentEntry: true,
            isTeacherAccount: false
        };
        
        console.log(`ðŸ“¤ Writing student data to class ${classCode}...`);
        
        let success = false;
        let errorMessages = [];
        
        try {
            await firebaseSet(`classes/${classCode}/students/${currentUserId}`, studentData);
            console.log(`âœ… Path 1 successful: classes/${classCode}/students/${currentUserId}`);
            success = true;
        } catch (error1) {
            errorMessages.push(`Path 1: ${error1.message}`);
            console.error(`âŒ Path 1 failed: ${error1.message}`);
        }
        
        if (!success) {
            try {
                await firebaseSet(`classStudents/${classCode}/${currentUserId}`, studentData);
                console.log(`âœ… Path 2 successful: classStudents/${classCode}/${currentUserId}`);
                success = true;
            } catch (error2) {
                errorMessages.push(`Path 2: ${error2.message}`);
                console.error(`âŒ Path 2 failed: ${error2.message}`);
            }
        }
        
        if (!success) {
            try {
                const simpleData = {
                    name: currentUserName || 'Student',
                    streak: studyData.streak || 0,
                    totalHours: (studyData.totalMinutes / 60).toFixed(1),
                    joined: new Date().toISOString()
                };
                
                await firebaseSet(`studentList/${classCode}/${currentUserId}`, simpleData);
                console.log(`âœ… Path 3 successful: studentList/${classCode}/${currentUserId}`);
                success = true;
            } catch (error3) {
                errorMessages.push(`Path 3: ${error3.message}`);
                console.error(`âŒ Path 3 failed: ${error3.message}`);
            }
        }
        
        if (!success) {
            console.error("All paths failed:", errorMessages);
            showNotification("Could not join class due to permissions. Try using incognito mode.", "error");
            
            console.log("Full error details:", {
                classCode,
                teacherId: classData.teacherId,
                currentUserId,
                currentUserUid: currentUser?.uid,
                errorMessages
            });
            
            joinBtn.innerHTML = originalText;
            joinBtn.disabled = false;
            return;
        }
        
        const newClass = {
            code: classCode,
            name: classData.name || 'Class ' + classCode,
            teacherId: classData.teacherId,
            joinedAt: new Date().toISOString()
        };
        
        userClasses.push(newClass);
        currentClassCode = classCode;
        selectedClassIndex = userClasses.length - 1;
        
        saveUserData();
        persistData();
        
        updateClassSelector();
        renderClassesList();
        loadClassroomData();
        
        classCodeInput.value = '';
        hideJoinClassForm();
        
        await saveStudyDataToFirebase();
        
        showNotification(`Successfully joined ${classData.name || 'the class'}!`, "success");
        
        if (currentSection === 'classroom') {
            await loadTeacherContent();
            await loadClassLeaderboard();
        }
        
    } catch (error) {
        console.error("âŒ Join class error:", error);
        console.error("Error stack:", error.stack);
        
        showNotification("Failed to join class: " + (error.message || "Unknown error"), "error");
    } finally {
        joinBtn.innerHTML = originalText;
        joinBtn.disabled = false;
    }
}

function renderClassesList() {
    const classesList = document.getElementById('classesList');
    const noClassesMessage = document.getElementById('noClassesMessage');
    
    if (!classesList) return;
    
    if (userClasses.length === 0) {
        classesList.innerHTML = '';
        if (noClassesMessage) noClassesMessage.style.display = 'block';
        return;
    }
    
    if (noClassesMessage) noClassesMessage.style.display = 'none';
    
    classesList.innerHTML = userClasses.map((classInfo, index) => {
        const isActive = index === selectedClassIndex;
        
        return `
            <div class="class-card ${isActive ? 'active' : ''}">
                <div class="class-card-header">
                    <div class="class-card-title">${classInfo.name || 'Class'}</div>
                    <div class="class-card-code">${classInfo.code}</div>
                </div>
                <div style="color: var(--text-muted); font-size: 0.875rem; margin-bottom: var(--spacing-sm);">
                    Joined: ${new Date(classInfo.joinedAt).toLocaleDateString()}
                </div>
                <div class="class-card-stats">
                    <div class="class-card-stat">
                        <div class="value">${studyData.streak || 0}</div>
                        <div class="label">Streak</div>
                    </div>
                    <div class="class-card-stat">
                        <div class="value">${(studyData.totalMinutes / 60).toFixed(1)}</div>
                        <div class="label">Hours</div>
                    </div>
                </div>
                <div class="class-card-actions">
                    <button class="btn ${isActive ? 'btn-primary' : 'btn-secondary'}" 
                            onclick="switchClass(${index})" style="flex: 1;">
                        ${isActive ? 'âœ“ Active' : 'Switch'}
                    </button>
                    <button class="btn btn-danger" onclick="leaveClassConfirm('${classInfo.code}')">
                        ðŸšª Leave
                    </button>
                </div>
            </div>
        `;
    }).join('');
}

function leaveClassConfirm(classCode) {
    if (confirm(`Are you sure you want to leave this class?`)) {
        leaveClass(classCode);
    }
}

async function leaveClass(classCodeToLeave = null) {
    const classCode = classCodeToLeave || currentClassCode;
    
    if (!classCode) {
        showNotification("No class to leave", "error");
        return;
    }
    
    const classIndex = userClasses.findIndex(c => c.code === classCode);
    if (classIndex === -1) {
        showNotification("Class not found in your list", "error");
        return;
    }
    
    const className = userClasses[classIndex].name || 'Class';
    
    try {
        await firebaseRemove(`classes/${classCode}/students/${currentUserId}`);
        console.log(`âœ… Student removed from class: ${classCode}`);
    } catch (error) {
        console.error("Error removing student from Firebase:", error);
    }
    
    userClasses.splice(classIndex, 1);
    
    if (classCode === currentClassCode) {
        if (userClasses.length > 0) {
            selectedClassIndex = 0;
            currentClassCode = userClasses[0].code;
        } else {
            currentClassCode = null;
            selectedClassIndex = -1;
        }
    }
    
    saveUserData();
    persistData();
    
    updateClassSelector();
    renderClassesList();
    loadClassroomData();
    
    if (currentSection === 'classroom') {
        await loadTeacherContent();
        await loadClassLeaderboard();
    }
    
    showNotification(`You have left ${className}`, "success");
}

// ========== CLASSROOM MANAGEMENT ==========
function loadClassroomData() {
    const notInClassView = document.getElementById('notInClassView');
    const inClassView = document.getElementById('inClassView');
    
    if (currentClassCode && userClasses.length > 0) {
        notInClassView.style.display = 'none';
        inClassView.style.display = 'block';
        
        const codeElement = document.getElementById('currentClassCode');
        if (codeElement) codeElement.textContent = currentClassCode;
        
        loadTeacherContent();
        loadClassLeaderboard();
    } else {
        if (notInClassView) notInClassView.style.display = 'block';
        if (inClassView) inClassView.style.display = 'none';
    }
}

async function loadTeacherContent() {
    if (!currentClassCode) {
        console.log("âŒ Cannot load teacher content: No class selected");
        return;
    }
    
    console.log(`ðŸ“¢ Loading teacher content for class: ${currentClassCode}`);
    
    try {
        const announcements = await firebaseGet(`announcements/${currentClassCode}`);
        const announcementsDiv = document.getElementById('teacherAnnouncements');
        
        if (announcements && announcementsDiv) {
            const announcementList = Object.entries(announcements).map(([id, ann]) => ({
                id,
                ...ann
            }));
            
            announcementList.sort((a, b) => {
                const dateA = new Date(a.createdAt || a.date || 0);
                const dateB = new Date(b.createdAt || b.date || 0);
                return dateB - dateA;
            });
            
            if (announcementList.length === 0) {
                announcementsDiv.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ðŸ“¢</div>
                        <div class="empty-state-title">No announcements yet</div>
                        <div class="empty-state-description">Check back later for updates from your teacher</div>
                    </div>
                `;
            } else {
                announcementsDiv.innerHTML = announcementList.map((ann, index) => `
                    <div class="classroom-item">
                        <div class="classroom-item-header">
                            <div class="classroom-item-title">${ann.title || 'Announcement'}</div>
                            <div class="classroom-item-date">
                                ðŸ“… ${new Date(ann.createdAt || ann.date || Date.now()).toLocaleDateString()}
                            </div>
                        </div>
                        <div class="classroom-item-content">
                            <p>${ann.content || ''}</p>
                        </div>
                    </div>
                `).join('');
            }
            
            const countElement = document.getElementById('announcementCount');
            if (countElement) countElement.textContent = announcementList.length;
        } else {
            if (announcementsDiv) {
                announcementsDiv.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ðŸ“¢</div>
                        <div class="empty-state-title">No announcements yet</div>
                        <div class="empty-state-description">Check back later for updates from your teacher</div>
                    </div>
                `;
                const countElement = document.getElementById('announcementCount');
                if (countElement) countElement.textContent = '0';
            }
        }
    } catch (error) {
        console.error("âŒ Error loading announcements:", error);
        const announcementsDiv = document.getElementById('teacherAnnouncements');
        if (announcementsDiv) {
            announcementsDiv.innerHTML = `
                <div class="empty-state">
                    <div class="empty-state-icon">âŒ</div>
                    <div class="empty-state-title">Error loading announcements</div>
                    <div class="empty-state-description">You may need to refresh or check your connection</div>
                </div>
            `;
        }
    }
    
    try {
        const resources = await firebaseGet(`resources/${currentClassCode}`);
        const resourcesDiv = document.getElementById('teacherResources');
        
        if (resources && resourcesDiv) {
            const resourceList = Object.entries(resources).map(([id, res]) => ({
                id,
                ...res
            }));
            
            if (resourceList.length === 0) {
                resourcesDiv.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ðŸ“š</div>
                        <div class="empty-state-title">No resources yet</div>
                        <div class="empty-state-description">Your teacher will add resources here</div>
                    </div>
                `;
            } else {
                resourcesDiv.innerHTML = resourceList.map((res, index) => `
                    <div class="classroom-item">
                        <div class="classroom-item-header">
                            <div class="classroom-item-title">${res.title || 'Resource'}</div>
                            <div class="classroom-item-date">
                                ðŸ“… ${new Date(res.createdAt || res.date || Date.now()).toLocaleDateString()}
                            </div>
                        </div>
                        <div class="classroom-item-content">
                            ${res.description ? `<p>${res.description}</p>` : ''}
                            ${res.url ? `
                                <a href="${res.url}" target="_blank" class="classroom-item-link">
                                    ðŸ“Ž ${res.url}
                                </a>
                            ` : ''}
                        </div>
                    </div>
                `).join('');
            }
            
            const countElement = document.getElementById('resourceCount');
            if (countElement) countElement.textContent = resourceList.length;
        } else {
            if (resourcesDiv) {
                resourcesDiv.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ðŸ“š</div>
                        <div class="empty-state-title">No resources yet</div>
                        <div class="empty-state-description">Your teacher will add resources here</div>
                    </div>
                `;
                const countElement = document.getElementById('resourceCount');
                if (countElement) countElement.textContent = '0';
            }
        }
    } catch (error) {
        console.error("âŒ Error loading resources:", error);
        const resourcesDiv = document.getElementById('teacherResources');
        if (resourcesDiv) {
            resourcesDiv.innerHTML = `
                <div class="empty-state">
                    <div class="empty-state-icon">âŒ</div>
                    <div class="empty-state-title">Error loading resources</div>
                    <div class="empty-state-description">You may need to refresh or check your connection</div>
                </div>
            `;
        }
    }
}

async function loadClassLeaderboard() {
    if (!currentClassCode) {
        console.log("âŒ Cannot load leaderboard: No class selected");
        showLeaderboardError("Not connected to a class");
        return;
    }
    
    console.log(`ðŸ“Š Loading leaderboard for class: ${currentClassCode}`);
    
    const leaderboardDiv = document.getElementById('classLeaderboard');
    if (leaderboardDiv) {
        leaderboardDiv.innerHTML = `
            <div class="loading">
                <div>Loading leaderboard...</div>
            </div>
        `;
    }
    
    try {
        const students = await firebaseGet(`classes/${currentClassCode}/students`);
        
        if (!students) {
            showLeaderboardEmpty();
            return;
        }
        
        const studentList = Object.entries(students).map(([id, studentData]) => {
            const totalStudyHours = studentData.totalStudyHours || (studentData.totalMinutes / 60).toFixed(1) || 0;
            
            return {
                id,
                name: studentData.name || 'Student ' + id.substr(0, 6),
                totalStudyHours: parseFloat(totalStudyHours),
                streak: studentData.streak || 0,
                points: studentData.points || Math.floor(totalStudyHours * 100) || 0,
                lastActive: studentData.lastActive || 'Unknown',
                isTeacherAccount: id.includes('teacher') || studentData.name?.includes('Teacher')
            };
        });
        
        const filteredStudents = studentList.filter(s => !s.isTeacherAccount);
        filteredStudents.sort((a, b) => b.totalStudyHours - a.totalStudyHours);
        
        renderLeaderboard(filteredStudents);
        
    } catch (error) {
        console.error("âŒ Error loading leaderboard:", error);
        showLeaderboardError("Failed to load leaderboard. Please try again.");
    }
}

function renderLeaderboard(students) {
    const leaderboardDiv = document.getElementById('classLeaderboard');
    if (!leaderboardDiv) return;
    
    if (students.length === 0) {
        showLeaderboardEmpty();
        return;
    }
    
    const totalStudents = students.length;
    const totalHours = students.reduce((sum, student) => sum + student.totalStudyHours, 0);
    const avgHours = totalStudents > 0 ? totalHours / totalStudents : 0;
    const topStudent = students.length > 0 ? students[0] : null;
    
    leaderboardDiv.innerHTML = `
        <div class="leaderboard-stats">
            <div class="leaderboard-stat">
                <div class="value">${totalStudents}</div>
                <div class="label">Students</div>
            </div>
            <div class="leaderboard-stat">
                <div class="value">${totalHours.toFixed(1)}</div>
                <div class="label">Total Hours</div>
            </div>
            <div class="leaderboard-stat">
                <div class="value">${avgHours.toFixed(1)}</div>
                <div class="label">Avg/Student</div>
            </div>
            <div class="leaderboard-stat">
                <div class="value">${topStudent ? topStudent.totalStudyHours.toFixed(1) : '0.0'}</div>
                <div class="label">Top Score</div>
            </div>
        </div>
        
        <div class="leaderboard-list">
            ${students.map((student, index) => {
                const isCurrentUser = student.id === currentUserId;
                const rankClass = `rank-${index + 1}`;
                const isTopThree = index < 3;
                
                const initials = student.name.split(' ').map(n => n[0]).join('').toUpperCase().substring(0, 2);
                
                let lastActiveText = 'Never';
                if (student.lastActive && student.lastActive !== 'Unknown') {
                    const lastActive = new Date(student.lastActive);
                    const now = new Date();
                    const diffDays = Math.floor((now - lastActive) / (1000 * 60 * 60 * 24));
                    
                    if (diffDays === 0) lastActiveText = 'Today';
                    else if (diffDays === 1) lastActiveText = 'Yesterday';
                    else if (diffDays < 7) lastActiveText = `${diffDays}d ago`;
                    else if (diffDays < 30) lastActiveText = `${Math.floor(diffDays/7)}w ago`;
                    else lastActiveText = lastActive.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                }
                
                return `
                    <div class="leaderboard-item ${rankClass} ${isCurrentUser ? 'you' : ''}">
                        <div class="leaderboard-rank">
                            ${isTopThree ? ['ðŸ¥‡', 'ðŸ¥ˆ', 'ðŸ¥‰'][index] : `#${index + 1}`}
                        </div>
                        <div class="leaderboard-avatar">
                            ${initials}
                        </div>
                        <div class="leaderboard-info">
                            <div class="leaderboard-name">
                                ${student.name} ${isCurrentUser ? '(You)' : ''}
                            </div>
                            <div class="leaderboard-subtitle">
                                Last active: ${lastActiveText}
                            </div>
                            <div class="leaderboard-stats-row">
                                <span class="stats-badge fire">ðŸ”¥ ${student.streak || 0}</span>
                                <span class="stats-badge time">â° ${student.totalStudyHours.toFixed(1)}h</span>
                                <span class="stats-badge points">â­ ${student.points || 0}</span>
                            </div>
                        </div>
                        <div class="leaderboard-score">
                            ${student.totalStudyHours.toFixed(1)}h
                        </div>
                    </div>
                `;
            }).join('')}
        </div>
    `;
}

function showLeaderboardEmpty() {
    const leaderboardDiv = document.getElementById('classLeaderboard');
    if (leaderboardDiv) {
        leaderboardDiv.innerHTML = `
            <div class="leaderboard-empty">
                <div style="font-size: 4rem; margin-bottom: var(--spacing-md);">ðŸ†</div>
                <h3>No Students Yet</h3>
                <p>Be the first to join and start studying!</p>
            </div>
        `;
    }
}

function showLeaderboardError(message) {
    const leaderboardDiv = document.getElementById('classLeaderboard');
    if (leaderboardDiv) {
        leaderboardDiv.innerHTML = `
            <div class="leaderboard-empty">
                <div style="font-size: 4rem; margin-bottom: var(--spacing-md);">âŒ</div>
                <h3>Error Loading Leaderboard</h3>
                <p>${message}</p>
                <button class="btn btn-primary" onclick="loadClassLeaderboard()" style="margin-top: var(--spacing-md);">
                    ðŸ”„ Retry
                </button>
            </div>
        `;
    }
}

function refreshLeaderboard() {
    updateSyncStatus("Refreshing leaderboard...", "syncing");
    loadClassLeaderboard();
    setTimeout(() => {
        updateSyncStatus("Leaderboard refreshed", "success");
    }, 500);
}

function copyClassCode() {
    if (!currentClassCode) return;
    
    navigator.clipboard.writeText(currentClassCode).then(() => {
        showNotification("Class code copied to clipboard!", "success");
    });
}

async function refreshClassroom() {
    updateSyncStatus("Refreshing...", "syncing");
    await loadTeacherContent();
    await loadClassLeaderboard();
    setTimeout(() => {
        showNotification("Classroom data refreshed", "success");
        updateSyncStatus("Refreshed", "success");
    }, 500);
}

// ========== STATISTICS & UI UPDATES ==========
function updateAllStatistics() {
    updateUI();
    updateTaskStats();
    updateSidebarStats();
    
    if (currentSection === 'statistics') {
        updateCharts();
    }
    
    persistData();
}

function updateUI() {
    const streakDisplay = document.getElementById('streakDisplay');
    const streakNumber = document.getElementById('streakNumber');
    if (streakDisplay) streakDisplay.textContent = studyData.streak || 0;
    if (streakNumber) streakNumber.textContent = studyData.streak || 0;
    
    const totalHoursDisplay = document.getElementById('totalHoursDisplay');
    const hours = studyData.totalStudyHours || (studyData.totalMinutes / 60).toFixed(1) || 0;
    if (totalHoursDisplay) totalHoursDisplay.textContent = parseFloat(hours).toFixed(1);
    
    const tasksCompleted = tasks.filter(t => t.completed).length;
    const tasksCompletedDisplay = document.getElementById('tasksCompletedDisplay');
    if (tasksCompletedDisplay) tasksCompletedDisplay.textContent = tasksCompleted;
    
    const focusScore = calculateFocusScore();
    const focusScoreDisplay = document.getElementById('focusScoreDisplay');
    if (focusScoreDisplay) focusScoreDisplay.textContent = `${focusScore}%`;
    
    updateSidebarStats();
    updateStreakUI();
}

function updateSidebarStats() {
    const sidebarStreak = document.getElementById('sidebarStreak');
    const sidebarHours = document.getElementById('sidebarHours');
    const sidebarTasks = document.getElementById('sidebarTasks');
    const sidebarFocus = document.getElementById('sidebarFocus');
    
    if (sidebarStreak) sidebarStreak.textContent = studyData.streak || 0;
    if (sidebarHours) {
        const hours = studyData.totalStudyHours || (studyData.totalMinutes / 60).toFixed(1) || 0;
        sidebarHours.textContent = parseFloat(hours).toFixed(1);
    }
    if (sidebarTasks) {
        const completedTasks = tasks.filter(t => t.completed).length;
        sidebarTasks.textContent = completedTasks;
    }
    if (sidebarFocus) {
        const focusScore = calculateFocusScore();
        sidebarFocus.textContent = `${focusScore}%`;
    }
}

// ========== PROFILE MANAGEMENT ==========
async function saveProfile() {
    const name = document.getElementById('studentName').value.trim();
    const email = document.getElementById('studentEmail').value.trim();
    const bio = document.getElementById('studentBio').value.trim();
    
    if (!name) {
        showNotification("Please enter your name", "error");
        return;
    }
    
    currentUserName = name;
    saveUserData();
    
    if (currentUserId) {
        try {
            await firebaseUpdate(`users/${currentUserId}`, {
                name: currentUserName,
                email: email,
                bio: bio,
                updatedAt: new Date().toISOString()
            });
            
            await saveStudyDataToFirebase();
            
        } catch (error) {
            console.error("âŒ Error saving profile to Firebase:", error);
        }
    }
    
    showNotification("Profile saved successfully!", "success");
}

async function saveProfileSettings() {
    const name = document.getElementById('profileName').value.trim();
    const email = document.getElementById('profileEmail').value.trim();
    const bio = document.getElementById('profileBio').value.trim();
    
    if (!name) {
        showNotification("Please enter your name", "error");
        return;
    }
    
    currentUserName = name;
    saveUserData();
    
    document.getElementById('studentName').value = name;
    document.getElementById('studentEmail').value = email;
    document.getElementById('studentBio').value = bio;
    
    if (currentUserId) {
        try {
            await firebaseUpdate(`users/${currentUserId}`, {
                name: currentUserName,
                email: email,
                bio: bio,
                updatedAt: new Date().toISOString()
            });
            
            await saveStudyDataToFirebase();
            
        } catch (error) {
            console.error("âŒ Error saving profile to Firebase:", error);
        }
    }
    
    showNotification("Profile settings saved successfully!", "success");
}

// ========== NAVIGATION ==========
function showSection(sectionId) {
    currentSection = sectionId;
    persistData();
    
    document.querySelectorAll('.nav-item').forEach(item => {
        item.classList.remove('active');
    });
    
    const navItems = document.querySelectorAll('.nav-item');
    for (let item of navItems) {
        if (item.textContent.includes(getNavItemText(sectionId))) {
            item.classList.add('active');
            break;
        }
    }
    
    document.querySelectorAll('.dashboard-content').forEach(section => {
        section.style.display = 'none';
    });
    
    const sectionElement = document.getElementById(sectionId);
    if (sectionElement) {
        sectionElement.style.display = 'block';
    }
    
    updateDashboardHeader(sectionId);
    
    if (sectionId === 'statistics') {
        setTimeout(updateCharts, 100);
    }
}

function getNavItemText(sectionId) {
    const navTexts = {
        'dashboard': 'ðŸ“Š',
        'tasks': 'ðŸ“',
        'assignments': 'ðŸ“š',
        'classroom': 'ðŸ«',
        'myclasses': 'ðŸŽ“',
        'statistics': 'ðŸ“ˆ',
        'tools': 'ðŸ› ï¸',
        'ai': 'ðŸ¤–',
        'profile': 'ðŸ‘¤'
    };
    return navTexts[sectionId] || '';
}

function updateDashboardHeader(sectionId) {
    const header = document.getElementById('dashboardHeader');
    const subtitle = document.getElementById('dashboardSubtitle');
    
    if (!header || !subtitle) return;
    
    switch(sectionId) {
        case 'dashboard':
            header.querySelector('h1').textContent = 'Welcome to Your Learning Dashboard';
            subtitle.textContent = 'Track your progress, manage tasks, and achieve your study goals';
            break;
        case 'tasks':
            header.querySelector('h1').textContent = 'Task Manager';
            subtitle.textContent = 'Organize and track your daily tasks';
            renderTasks();
            break;
        case 'assignments':
            header.querySelector('h1').textContent = 'Assignment Tracker';
            subtitle.textContent = 'Manage your school assignments and deadlines';
            renderAssignments();
            break;
        case 'classroom':
            header.querySelector('h1').textContent = 'Classroom';
            subtitle.textContent = 'Connect with your teacher and classmates';
            loadClassroomData();
            break;
        case 'myclasses':
            header.querySelector('h1').textContent = 'My Classes';
            subtitle.textContent = 'Manage your classrooms and join new ones';
            renderClassesList();
            break;
        case 'statistics':
            header.querySelector('h1').textContent = 'Learning Statistics';
            subtitle.textContent = 'Visualize your progress with charts and insights';
            break;
        case 'tools':
            header.querySelector('h1').textContent = 'Study Tools';
            subtitle.textContent = 'Tools and resources to enhance your learning';
            break;
        case 'ai':
            header.querySelector('h1').textContent = 'AI Learning Resources';
            subtitle.textContent = 'AI-powered tools and educational resources';
            break;
        case 'profile':
            header.querySelector('h1').textContent = 'Profile Settings';
            subtitle.textContent = 'Manage your profile and preferences';
            break;
    }
}

// ========== UTILITY FUNCTIONS ==========
function initUI() {
    const savedTheme = localStorage.getItem('studentTheme') || 'light';
    document.body.className = savedTheme;
    const themeSelector = document.querySelector('.theme-selector');
    if (themeSelector) themeSelector.value = savedTheme;
    
    loadMotivationalQuote();
    loadInspiringStories();
    
    const nameField = document.getElementById('studentName');
    if (nameField && currentUserName) nameField.value = currentUserName;
    
    const profileNameField = document.getElementById('profileName');
    if (profileNameField && currentUserName) profileNameField.value = currentUserName;
    
    showSection(currentSection);
    
    console.log("ðŸŽ¨ UI initialized with theme:", savedTheme);
}

function setupEventListeners() {
    const taskInput = document.getElementById('taskInput');
    if (taskInput) {
        taskInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') addTask();
        });
    }
    
    const taskInputFull = document.getElementById('taskInputFull');
    if (taskInputFull) {
        taskInputFull.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') addTask();
        });
    }
    
    const hoursInput = document.getElementById('hoursInput');
    if (hoursInput) {
        hoursInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') addStudyHours();
        });
    }
    
    document.getElementById('storyModal').addEventListener('click', function(e) {
        if (e.target === this) {
            closeStoryModal();
        }
    });
    
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
            closeStoryModal();
        }
    });
}

function loadAllData() {
    renderTasks();
    renderDashboardTasks();
    renderAssignments();
    renderDashboardAssignments();
    loadClassroomData();
    loadMotivationalQuote();
    loadInspiringStories();
    updateClassSelector();
    renderClassesList();
    
    const savedProfile = localStorage.getItem('studentProfile');
    if (savedProfile) {
        const profile = JSON.parse(savedProfile);
        document.getElementById('studentName').value = profile.name || '';
        document.getElementById('studentEmail').value = profile.email || '';
        document.getElementById('studentBio').value = profile.bio || '';
        document.getElementById('profileName').value = profile.name || '';
        document.getElementById('profileEmail').value = profile.email || '';
        document.getElementById('profileBio').value = profile.bio || '';
        currentUserName = profile.name || 'Student';
    }
}

// ========== MOTIVATIONAL QUOTES ==========
function loadMotivationalQuote() {
    const randomQuote = inspiringQuotes[Math.floor(Math.random() * inspiringQuotes.length)];
    document.getElementById('dailyQuote').textContent = `"${randomQuote.text}"`;
    document.getElementById('quoteAuthor').textContent = `â€” ${randomQuote.author}`;
}

function newQuote() {
    loadMotivationalQuote();
    showNotification("New inspiration loaded! ðŸ’«", "info");
}

// ========== NOTIFICATION SYSTEM ==========
function showNotification(message, type = 'info') {
    const container = document.getElementById('toastContainer');
    const toast = document.createElement('div');
    toast.className = `toast ${type}`;
    
    let icon = 'ðŸ’¡';
    if (type === 'success') icon = 'âœ…';
    if (type === 'error') icon = 'âŒ';
    if (type === 'warning') icon = 'âš ï¸';
    if (type === 'info') icon = 'â„¹ï¸';
    
    toast.innerHTML = `
        <span style="font-size: 1.5rem;">${icon}</span>
        <div style="flex: 1;">
            <div style="font-weight: 700;">${message}</div>
            <div style="font-size: 0.875rem; opacity: 0.8;">${new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</div>
        </div>
    `;
    
    container.appendChild(toast);
    
    setTimeout(() => {
        toast.style.opacity = '0';
        toast.style.transform = 'translateX(100%)';
        setTimeout(() => toast.remove(), 300);
    }, 4000);
}

function updateSyncStatus(text, type = "info") {
    const syncStatus = document.getElementById('syncStatus');
    const syncIcon = syncStatus.querySelector('.sync-icon');
    const syncText = syncStatus.querySelector('.sync-text');
    
    if (!syncStatus) return;
    
    syncStatus.style.display = 'flex';
    syncStatus.className = `sync-status ${type}`;
    syncText.textContent = text;
    
    let icon = 'â³';
    if (type === 'success') icon = 'âœ…';
    if (type === 'error') icon = 'âŒ';
    if (type === 'warning') icon = 'âš ï¸';
    if (type === 'info') icon = 'â„¹ï¸';
    
    syncIcon.textContent = icon;
    
    if (type === 'success') {
        setTimeout(() => {
            syncStatus.style.opacity = '0';
            setTimeout(() => {
                syncStatus.style.display = 'none';
                syncStatus.style.opacity = '1';
            }, 300);
        }, 2000);
    }
}

// ========== THEME MANAGEMENT ==========
function changeTheme(theme) {
    document.body.className = theme;
    localStorage.setItem('studentTheme', theme);
    
    // Recreate charts with new theme colors
    if (currentSection === 'statistics') {
        setTimeout(updateCharts, 100);
    }
    
    showNotification(`Switched to ${theme} theme`, "success");
}

// ========== DATA IMPORT/EXPORT ==========
function exportData() {
    const allData = {
        exportDate: new Date().toISOString(),
        version: "2.5",
        user: {
            id: currentUserId,
            name: currentUserName,
            classes: userClasses
        },
        studyData: studyData,
        tasks: tasks,
        assignments: assignments,
        profile: JSON.parse(localStorage.getItem('studentProfile') || '{}')
    };
    
    const dataStr = JSON.stringify(allData, null, 2);
    const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
    const exportFileDefaultName = `student-data-${new Date().toISOString().split('T')[0]}.json`;
    
    const linkElement = document.createElement('a');
    linkElement.setAttribute('href', dataUri);
    linkElement.setAttribute('download', exportFileDefaultName);
    linkElement.click();
    
    showNotification("All data exported successfully", "success");
}

function clearAllData() {
    if (confirm("âš ï¸ This will delete ALL your data including tasks, assignments, study history, and profile. This cannot be undone! Continue?")) {
        localStorage.removeItem('studentPersistentData');
        localStorage.removeItem('studentTasks');
        localStorage.removeItem('studentAssignments');
        localStorage.removeItem('studentStudyData');
        localStorage.removeItem('studentProfile');
        localStorage.removeItem('studentUserClasses');
        localStorage.removeItem('studentUserId');
        localStorage.removeItem('studentName');
        localStorage.removeItem('studentTheme');
        
        tasks = [];
        assignments = [];
        studyData = {
            streak: 0,
            lastStudyDate: "",
            totalMinutes: 0,
            totalStudyDays: 0,
            totalStudyHours: 0,
            studySessions: [],
            weeklyPattern: [0, 0, 0, 0, 0, 0, 0],
            streakHistory: [],
            streakMilestones: [3, 7, 14, 30, 60, 90],
            currentMilestone: 0,
            dailyStats: [],
            focusScores: [],
            consistencyScores: []
        };
        userClasses = [];
        currentClassCode = null;
        selectedClassIndex = -1;
        currentUserId = `student_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
        currentUserName = 'Student';
        
        document.getElementById('studentName').value = '';
        document.getElementById('studentEmail').value = '';
        document.getElementById('studentBio').value = '';
        document.getElementById('profileName').value = '';
        document.getElementById('profileEmail').value = '';
        document.getElementById('profileBio').value = '';
        document.getElementById('hoursInput').value = '';
        
        localStorage.setItem('studentUserId', currentUserId);
        
        loadAllData();
        updateAllStatistics();
        
        showNotification("All data cleared", "info");
    }
}

// ========== AUTOSAVE AND REFRESH ==========
function refreshData() {
    const refreshBtn = event.target;
    const originalText = refreshBtn.innerHTML;
    
    refreshBtn.innerHTML = 'ðŸ”„ Refreshing...';
    refreshBtn.disabled = true;
    
    loadAllData();
    updateAllStatistics();
    
    if (currentSection === 'statistics') {
        updateCharts();
    }
    
    setTimeout(() => {
        refreshBtn.innerHTML = originalText;
        refreshBtn.disabled = false;
        showNotification("All data refreshed", "success");
    }, 1000);
}

// ========== INITIALIZATION COMPLETE ==========
console.log("âœ… Student Mode initialized successfully!");
</script>

</body>
</html>
